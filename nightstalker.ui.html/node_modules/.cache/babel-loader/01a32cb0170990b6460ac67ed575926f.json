{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Desktop, Device, PopupBlockerHandler, scout } from '../index';\nimport $ from 'jquery';\n\nvar OpenUriHandler = /*#__PURE__*/function () {\n  function OpenUriHandler() {\n    _classCallCheck(this, OpenUriHandler);\n  }\n\n  _createClass(OpenUriHandler, [{\n    key: \"init\",\n    value: function init(model) {\n      this.session = model.session;\n    }\n  }, {\n    key: \"openUri\",\n    value: function openUri(uri, action) {\n      $.log.isDebugEnabled() && $.log.debug('(OpenUriHandler#openUri) uri=' + uri + ' action=' + action);\n\n      if (!uri) {\n        return;\n      }\n\n      action = scout.nvl(action, Desktop.UriAction.OPEN);\n\n      if (action === Desktop.UriAction.DOWNLOAD) {\n        this.handleUriActionDownload(uri);\n      } else if (action === Desktop.UriAction.OPEN) {\n        this.handleUriActionOpen(uri);\n      } else if (action === Desktop.UriAction.NEW_WINDOW) {\n        this.handleUriActionNewWindow(uri);\n      } else if (action === Desktop.UriAction.POPUP_WINDOW) {\n        this.handleUriActionPopupWindow(uri);\n      } else if (action === Desktop.UriAction.SAME_WINDOW) {\n        this.handleUriActionSameWindow(uri);\n      }\n    }\n  }, {\n    key: \"handleUriActionDownload\",\n    value: function handleUriActionDownload(uri) {\n      if (Device.get().isIos()) {\n        // The iframe trick does not work for ios\n        // Since the file cannot be stored on the file system it will be shown in the browser if possible\n        // -> create a new window to not replace the existing content.\n        // Drawback: Popup-Blocker will show up\n        // Opening in new window does not work in standalone mode because the window will be opened in safari which creates a new http session.\n        // Because the downloads are linked to the http session they cannot be downloaded using safari\n        if (Device.get().isStandalone()) {\n          this.openUriInSameWindow(uri);\n        } else {\n          this.openUriAsNewWindow(uri);\n        }\n      } else if (Device.get().browser === Device.Browser.CHROME) {\n        // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n        this.openUriInSameWindow(uri);\n      } else {\n        this.openUriInIFrame(uri);\n      }\n    }\n  }, {\n    key: \"isUriWithExternallyHandledProtocol\",\n    value: function isUriWithExternallyHandledProtocol(uri) {\n      return /^(callto|facetime|fax|geo|mailto|maps|notes|sip|skype|tel|google.navigation):/.test(uri);\n    }\n  }, {\n    key: \"handleUriActionOpen\",\n    value: function handleUriActionOpen(uri) {\n      if (Device.get().isIos()) {\n        // Open in same window.\n        // Don't call _openUriInIFrame here, if action is set to open, an url is expected to be opened in the same window\n        // Additionally, some url types require to be opened in the same window like tel or mailto, at least on mobile devices\n        this.openUriInSameWindow(uri);\n      } else if (this.isUriWithExternallyHandledProtocol(uri)) {\n        if (Device.get().browser === Device.Browser.CHROME) {\n          // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n          this.openUriInSameWindow(uri);\n        } else {\n          // do not use sameWindow since the poller would be disconnected in firefox\n          this.openUriInIFrame(uri);\n        }\n      } else {\n        this.openUriAsNewWindow(uri);\n      }\n    }\n  }, {\n    key: \"handleUriActionNewWindow\",\n    value: function handleUriActionNewWindow(uri) {\n      this.openUriAsNewWindow(uri);\n    }\n  }, {\n    key: \"handleUriActionPopupWindow\",\n    value: function handleUriActionPopupWindow(uri) {\n      this.openUriAsPopupWindow(uri);\n    }\n  }, {\n    key: \"handleUriActionSameWindow\",\n    value: function handleUriActionSameWindow(uri) {\n      this.openUriInSameWindow(uri);\n    }\n  }, {\n    key: \"openUriInSameWindow\",\n    value: function openUriInSameWindow(uri) {\n      window.location.assign(uri);\n    }\n  }, {\n    key: \"openUriInIFrame\",\n    value: function openUriInIFrame(uri) {\n      // Create a hidden iframe and set the URI as src attribute value\n      var $iframe = this.session.$entryPoint.appendElement('<iframe>', 'download-frame').attr('tabindex', -1).attr('src', uri); // Remove the iframe again after 10s (should be enough to get the download started)\n\n      setTimeout(function () {\n        $iframe.remove();\n      }, 10 * 1000);\n    }\n  }, {\n    key: \"openUriAsNewWindow\",\n    value: function openUriAsNewWindow(uri) {\n      var popupBlockerHandler = new PopupBlockerHandler(this.session);\n\n      if (Device.get().isInternetExplorer()) {\n        popupBlockerHandler.openWindow(uri, null, 'location=yes,toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes');\n      } else {\n        popupBlockerHandler.openWindow(uri);\n      }\n    }\n  }, {\n    key: \"openUriAsPopupWindow\",\n    value: function openUriAsPopupWindow(uri) {\n      var popupBlockerHandler = new PopupBlockerHandler(this.session);\n      popupBlockerHandler.openWindow(uri, null, 'location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes');\n    }\n  }]);\n\n  return OpenUriHandler;\n}();\n\nexport { OpenUriHandler as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/desktop/OpenUriHandler.js"],"names":["Desktop","Device","PopupBlockerHandler","scout","$","OpenUriHandler","model","session","uri","action","log","isDebugEnabled","debug","nvl","UriAction","OPEN","DOWNLOAD","handleUriActionDownload","handleUriActionOpen","NEW_WINDOW","handleUriActionNewWindow","POPUP_WINDOW","handleUriActionPopupWindow","SAME_WINDOW","handleUriActionSameWindow","get","isIos","isStandalone","openUriInSameWindow","openUriAsNewWindow","browser","Browser","CHROME","openUriInIFrame","test","isUriWithExternallyHandledProtocol","openUriAsPopupWindow","window","location","assign","$iframe","$entryPoint","appendElement","attr","setTimeout","remove","popupBlockerHandler","isInternetExplorer","openWindow"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAQA,OAAR,EAAiBC,MAAjB,EAAyBC,mBAAzB,EAA8CC,KAA9C,QAA0D,UAA1D;AACA,OAAOC,CAAP,MAAc,QAAd;;IAEqBC,c;;;;;;;yBAEdC,K,EAAO;AACV,WAAKC,OAAL,GAAeD,KAAK,CAACC,OAArB;AACD;;;4BAEOC,G,EAAKC,M,EAAQ;AACnBL,MAAAA,CAAC,CAACM,GAAF,CAAMC,cAAN,MAA0BP,CAAC,CAACM,GAAF,CAAME,KAAN,CAAY,kCAAkCJ,GAAlC,GAAwC,UAAxC,GAAqDC,MAAjE,CAA1B;;AACA,UAAI,CAACD,GAAL,EAAU;AACR;AACD;;AACDC,MAAAA,MAAM,GAAGN,KAAK,CAACU,GAAN,CAAUJ,MAAV,EAAkBT,OAAO,CAACc,SAAR,CAAkBC,IAApC,CAAT;;AAEA,UAAIN,MAAM,KAAKT,OAAO,CAACc,SAAR,CAAkBE,QAAjC,EAA2C;AACzC,aAAKC,uBAAL,CAA6BT,GAA7B;AACD,OAFD,MAEO,IAAIC,MAAM,KAAKT,OAAO,CAACc,SAAR,CAAkBC,IAAjC,EAAuC;AAC5C,aAAKG,mBAAL,CAAyBV,GAAzB;AACD,OAFM,MAEA,IAAIC,MAAM,KAAKT,OAAO,CAACc,SAAR,CAAkBK,UAAjC,EAA6C;AAClD,aAAKC,wBAAL,CAA8BZ,GAA9B;AACD,OAFM,MAEA,IAAIC,MAAM,KAAKT,OAAO,CAACc,SAAR,CAAkBO,YAAjC,EAA+C;AACpD,aAAKC,0BAAL,CAAgCd,GAAhC;AACD,OAFM,MAEA,IAAIC,MAAM,KAAKT,OAAO,CAACc,SAAR,CAAkBS,WAAjC,EAA8C;AACnD,aAAKC,yBAAL,CAA+BhB,GAA/B;AACD;AACF;;;4CAEuBA,G,EAAK;AAC3B,UAAIP,MAAM,CAACwB,GAAP,GAAaC,KAAb,EAAJ,EAA0B;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,YAAIzB,MAAM,CAACwB,GAAP,GAAaE,YAAb,EAAJ,EAAiC;AAC/B,eAAKC,mBAAL,CAAyBpB,GAAzB;AACD,SAFD,MAEO;AACL,eAAKqB,kBAAL,CAAwBrB,GAAxB;AACD;AACF,OAZD,MAYO,IAAIP,MAAM,CAACwB,GAAP,GAAaK,OAAb,KAAyB7B,MAAM,CAAC8B,OAAP,CAAeC,MAA5C,EAAoD;AACzD;AACA,aAAKJ,mBAAL,CAAyBpB,GAAzB;AACD,OAHM,MAGA;AACL,aAAKyB,eAAL,CAAqBzB,GAArB;AACD;AACF;;;uDAEkCA,G,EAAK;AACtC,aAAO,gFAAgF0B,IAAhF,CAAqF1B,GAArF,CAAP;AACD;;;wCAEmBA,G,EAAK;AACvB,UAAIP,MAAM,CAACwB,GAAP,GAAaC,KAAb,EAAJ,EAA0B;AACxB;AACA;AACA;AACA,aAAKE,mBAAL,CAAyBpB,GAAzB;AACD,OALD,MAKO,IAAI,KAAK2B,kCAAL,CAAwC3B,GAAxC,CAAJ,EAAkD;AACvD,YAAIP,MAAM,CAACwB,GAAP,GAAaK,OAAb,KAAyB7B,MAAM,CAAC8B,OAAP,CAAeC,MAA5C,EAAoD;AAClD;AACA,eAAKJ,mBAAL,CAAyBpB,GAAzB;AACD,SAHD,MAGO;AACL;AACA,eAAKyB,eAAL,CAAqBzB,GAArB;AACD;AACF,OARM,MAQA;AACL,aAAKqB,kBAAL,CAAwBrB,GAAxB;AACD;AACF;;;6CAEwBA,G,EAAK;AAC5B,WAAKqB,kBAAL,CAAwBrB,GAAxB;AACD;;;+CAE0BA,G,EAAK;AAC9B,WAAK4B,oBAAL,CAA0B5B,GAA1B;AACD;;;8CAEyBA,G,EAAK;AAC7B,WAAKoB,mBAAL,CAAyBpB,GAAzB;AACD;;;wCAEmBA,G,EAAK;AACvB6B,MAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB/B,GAAvB;AACD;;;oCAEeA,G,EAAK;AACnB;AACA,UAAIgC,OAAO,GAAG,KAAKjC,OAAL,CAAakC,WAAb,CAAyBC,aAAzB,CAAuC,UAAvC,EAAmD,gBAAnD,EACXC,IADW,CACN,UADM,EACM,CAAC,CADP,EAEXA,IAFW,CAEN,KAFM,EAECnC,GAFD,CAAd,CAFmB,CAMnB;;AACAoC,MAAAA,UAAU,CAAC,YAAW;AACpBJ,QAAAA,OAAO,CAACK,MAAR;AACD,OAFS,EAEP,KAAK,IAFE,CAAV;AAGD;;;uCAEkBrC,G,EAAK;AACtB,UAAIsC,mBAAmB,GAAG,IAAI5C,mBAAJ,CAAwB,KAAKK,OAA7B,CAA1B;;AACA,UAAIN,MAAM,CAACwB,GAAP,GAAasB,kBAAb,EAAJ,EAAuC;AACrCD,QAAAA,mBAAmB,CAACE,UAApB,CAA+BxC,GAA/B,EAAoC,IAApC,EAA0C,mEAA1C;AACD,OAFD,MAEO;AACLsC,QAAAA,mBAAmB,CAACE,UAApB,CAA+BxC,GAA/B;AACD;AACF;;;yCAEoBA,G,EAAK;AACxB,UAAIsC,mBAAmB,GAAG,IAAI5C,mBAAJ,CAAwB,KAAKK,OAA7B,CAA1B;AACAuC,MAAAA,mBAAmB,CAACE,UAApB,CAA+BxC,GAA/B,EAAoC,IAApC,EAA0C,gEAA1C;AACD;;;;;;SA9GkBH,c","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Desktop, Device, PopupBlockerHandler, scout} from '../index';\nimport $ from 'jquery';\n\nexport default class OpenUriHandler {\n\n  init(model) {\n    this.session = model.session;\n  }\n\n  openUri(uri, action) {\n    $.log.isDebugEnabled() && $.log.debug('(OpenUriHandler#openUri) uri=' + uri + ' action=' + action);\n    if (!uri) {\n      return;\n    }\n    action = scout.nvl(action, Desktop.UriAction.OPEN);\n\n    if (action === Desktop.UriAction.DOWNLOAD) {\n      this.handleUriActionDownload(uri);\n    } else if (action === Desktop.UriAction.OPEN) {\n      this.handleUriActionOpen(uri);\n    } else if (action === Desktop.UriAction.NEW_WINDOW) {\n      this.handleUriActionNewWindow(uri);\n    } else if (action === Desktop.UriAction.POPUP_WINDOW) {\n      this.handleUriActionPopupWindow(uri);\n    } else if (action === Desktop.UriAction.SAME_WINDOW) {\n      this.handleUriActionSameWindow(uri);\n    }\n  }\n\n  handleUriActionDownload(uri) {\n    if (Device.get().isIos()) {\n      // The iframe trick does not work for ios\n      // Since the file cannot be stored on the file system it will be shown in the browser if possible\n      // -> create a new window to not replace the existing content.\n      // Drawback: Popup-Blocker will show up\n      // Opening in new window does not work in standalone mode because the window will be opened in safari which creates a new http session.\n      // Because the downloads are linked to the http session they cannot be downloaded using safari\n      if (Device.get().isStandalone()) {\n        this.openUriInSameWindow(uri);\n      } else {\n        this.openUriAsNewWindow(uri);\n      }\n    } else if (Device.get().browser === Device.Browser.CHROME) {\n      // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n      this.openUriInSameWindow(uri);\n    } else {\n      this.openUriInIFrame(uri);\n    }\n  }\n\n  isUriWithExternallyHandledProtocol(uri) {\n    return /^(callto|facetime|fax|geo|mailto|maps|notes|sip|skype|tel|google.navigation):/.test(uri);\n  }\n\n  handleUriActionOpen(uri) {\n    if (Device.get().isIos()) {\n      // Open in same window.\n      // Don't call _openUriInIFrame here, if action is set to open, an url is expected to be opened in the same window\n      // Additionally, some url types require to be opened in the same window like tel or mailto, at least on mobile devices\n      this.openUriInSameWindow(uri);\n    } else if (this.isUriWithExternallyHandledProtocol(uri)) {\n      if (Device.get().browser === Device.Browser.CHROME) {\n        // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n        this.openUriInSameWindow(uri);\n      } else {\n        // do not use sameWindow since the poller would be disconnected in firefox\n        this.openUriInIFrame(uri);\n      }\n    } else {\n      this.openUriAsNewWindow(uri);\n    }\n  }\n\n  handleUriActionNewWindow(uri) {\n    this.openUriAsNewWindow(uri);\n  }\n\n  handleUriActionPopupWindow(uri) {\n    this.openUriAsPopupWindow(uri);\n  }\n\n  handleUriActionSameWindow(uri) {\n    this.openUriInSameWindow(uri);\n  }\n\n  openUriInSameWindow(uri) {\n    window.location.assign(uri);\n  }\n\n  openUriInIFrame(uri) {\n    // Create a hidden iframe and set the URI as src attribute value\n    var $iframe = this.session.$entryPoint.appendElement('<iframe>', 'download-frame')\n      .attr('tabindex', -1)\n      .attr('src', uri);\n\n    // Remove the iframe again after 10s (should be enough to get the download started)\n    setTimeout(function() {\n      $iframe.remove();\n    }, 10 * 1000);\n  }\n\n  openUriAsNewWindow(uri) {\n    var popupBlockerHandler = new PopupBlockerHandler(this.session);\n    if (Device.get().isInternetExplorer()) {\n      popupBlockerHandler.openWindow(uri, null, 'location=yes,toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes');\n    } else {\n      popupBlockerHandler.openWindow(uri);\n    }\n  }\n\n  openUriAsPopupWindow(uri) {\n    var popupBlockerHandler = new PopupBlockerHandler(this.session);\n    popupBlockerHandler.openWindow(uri, null, 'location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes');\n  }\n}\n"]},"metadata":{},"sourceType":"module"}