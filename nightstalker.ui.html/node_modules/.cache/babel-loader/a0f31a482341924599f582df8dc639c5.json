{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { graphics, HtmlComponent, NullLayout, Point, Popup, PopupWithHeadLayout, scout, scrollbars } from '../index';\nimport $ from 'jquery';\n\nvar PopupWithHead = /*#__PURE__*/function (_Popup) {\n  _inherits(PopupWithHead, _Popup);\n\n  var _super = _createSuper(PopupWithHead);\n\n  function PopupWithHead() {\n    var _this;\n\n    _classCallCheck(this, PopupWithHead);\n\n    _this = _super.call(this);\n    _this.$head;\n    _this.$body;\n    _this.$deco;\n    _this.$parent;\n    _this.horizontalSwitch = true;\n    _this.verticalSwitch = true;\n    _this._headVisible = true;\n    _this.windowResizeType = 'remove';\n    return _this;\n  }\n\n  _createClass(PopupWithHead, [{\n    key: \"_createLayout\",\n    value: function _createLayout() {\n      return new PopupWithHeadLayout(this);\n    }\n  }, {\n    key: \"_init\",\n    value: function _init(options) {\n      _get(_getPrototypeOf(PopupWithHead.prototype), \"_init\", this).call(this, options); // Compared to a regular popup, the popup is aligned with the head and either opened left or right,\n      // -> the width should be adjusted as well if it does not fit into the window\n\n\n      this.trimWidth = scout.nvl(options.trimWidth, this._headVisible);\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      _get(_getPrototypeOf(PopupWithHead.prototype), \"_render\", this).call(this);\n\n      this._$createBody();\n\n      if (this._headVisible) {\n        this._renderHead();\n      }\n    }\n  }, {\n    key: \"_postRender\",\n    value: function _postRender() {\n      _get(_getPrototypeOf(PopupWithHead.prototype), \"_postRender\", this).call(this);\n\n      scrollbars.update(this.$body);\n    }\n  }, {\n    key: \"_$createBody\",\n    value: function _$createBody() {\n      this.$body = this.$container.appendDiv('popup-body'); // Complete the layout hierarchy between the popup and the menu items\n\n      var htmlBody = HtmlComponent.install(this.$body, this.session);\n      htmlBody.setLayout(this._createBodyLayout());\n\n      this._modifyBody();\n    }\n  }, {\n    key: \"_createBodyLayout\",\n    value: function _createBodyLayout() {\n      return new NullLayout();\n    }\n  }, {\n    key: \"rerenderHead\",\n    value: function rerenderHead() {\n      this._removeHead();\n\n      this._renderHead();\n    }\n    /**\n     * Copies html from this.$headBlueprint, if set.\n     */\n\n  }, {\n    key: \"_renderHead\",\n    value: function _renderHead() {\n      this.$deco = this.$container.makeDiv('popup-deco');\n      this.$head = this.$container.makeDiv('popup-head menu-item').on('mousedown', '', this._onHeadMouseDown.bind(this));\n      this.$container.prepend(this.$head).append(this.$deco);\n\n      if (this.$headBlueprint) {\n        this.$head.html(this.$headBlueprint.html());\n\n        this._copyStyleToHeadChildren();\n      }\n    }\n    /**\n     * Sets CSS classes or CSS-properties on the body.\n     */\n\n  }, {\n    key: \"_modifyBody\",\n    value: function _modifyBody() {// NOP\n    }\n  }, {\n    key: \"_removeHead\",\n    value: function _removeHead() {\n      if (this.$head) {\n        this.$head.remove();\n      }\n\n      if (this.$deco) {\n        this.$deco.remove();\n      }\n    }\n  }, {\n    key: \"_copyCssClassToHead\",\n    value: function _copyCssClassToHead(className) {\n      if (this.$headBlueprint && this.$headBlueprint.hasClass(className)) {\n        this.$head.addClass(className);\n      }\n    }\n  }, {\n    key: \"_copyStyleToHeadChildren\",\n    value: function _copyStyleToHeadChildren() {\n      var $blueprintChildren = this.$headBlueprint.children();\n      this.$head.children().each(function (i) {\n        var $headChild = $(this);\n        var $blueprintChild = $blueprintChildren.eq(i);\n        $headChild.copyCss($blueprintChild, 'margin padding line-height border vertical-align font-size display width height');\n      });\n    }\n  }, {\n    key: \"_onHeadMouseDown\",\n    value: function _onHeadMouseDown(event) {\n      if (this.$head && this.$head.isOrHas(event.target)) {\n        this.close();\n      }\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"_isMouseDownOutside\",\n    value: function _isMouseDownOutside(event) {\n      if (this.$headBlueprint && this.$headBlueprint.isOrHas(event.target)) {\n        // click on the head still belongs to the popup -> not an outside click -> do not close popup\n        return false;\n      }\n\n      return _get(_getPrototypeOf(PopupWithHead.prototype), \"_isMouseDownOutside\", this).call(this, event);\n    }\n  }, {\n    key: \"appendToBody\",\n    value: function appendToBody($element) {\n      this.$body.append($element);\n    }\n  }, {\n    key: \"addClassToBody\",\n    value: function addClassToBody(clazz) {\n      this.$body.addClass(clazz);\n    }\n    /**\n     * @override Popup.js\n     */\n\n  }, {\n    key: \"_position\",\n    value: function _position(switchIfNecessary) {\n      var $container = this.$container;\n\n      if (!$container) {\n        // When layouting the menu bar, menus are removed at first and then added anew.\n        return;\n      }\n\n      var horizontalAlignment, verticalAlignment, overlap, pos;\n\n      if (!this._headVisible) {\n        // If head is not visible, use default implementation and adjust $body to $container\n        _get(_getPrototypeOf(PopupWithHead.prototype), \"_position\", this).call(this, switchIfNecessary);\n\n        this.$body.removeClass(this._alignClasses());\n        verticalAlignment = Popup.Alignment.TOP;\n\n        if ($container.hasClass(Popup.Alignment.BOTTOM)) {\n          verticalAlignment = Popup.Alignment.BOTTOM;\n        }\n\n        horizontalAlignment = Popup.Alignment.LEFTEDGE;\n\n        if ($container.hasClass(Popup.Alignment.RIGHTEDGE)) {\n          horizontalAlignment = Popup.Alignment.RIGHTEDGE;\n        }\n\n        this.$body.addClass(verticalAlignment + ' ' + horizontalAlignment);\n        return;\n      }\n\n      this._positionImpl();\n\n      var horizontalSwitch = scout.nvl(switchIfNecessary, this.horizontalSwitch);\n      var verticalSwitch = scout.nvl(switchIfNecessary, this.verticalSwitch);\n\n      if (horizontalSwitch || verticalSwitch) {\n        pos = $container.offset();\n        overlap = this.overlap({\n          x: pos.left,\n          y: pos.top\n        }, false); // this.$parent might not be at (0,0) of the document\n\n        var parentOffset = this.$parent.offset();\n        overlap.x -= parentOffset.left;\n        overlap.y -= parentOffset.top;\n\n        if (overlap.y > 0 && verticalSwitch) {\n          // switch opening direction\n          verticalAlignment = Popup.Alignment.TOP;\n        }\n\n        if (overlap.x > 0 && horizontalSwitch) {\n          // switch opening direction\n          horizontalAlignment = Popup.Alignment.RIGHTEDGE;\n        }\n\n        if (horizontalAlignment || verticalAlignment) {\n          // Align again if openingDirection has to be switched\n          this._positionImpl(horizontalAlignment, verticalAlignment);\n        }\n      }\n    }\n  }, {\n    key: \"_positionImpl\",\n    value: function _positionImpl(horizontalAlignment, verticalAlignment) {\n      var pos,\n          headSize,\n          bodySize,\n          bodyWidth,\n          widthDiff,\n          left,\n          top,\n          headInsets,\n          menuInsets,\n          bodyTop = 0,\n          headTop = 0,\n          decoTop = 0;\n      horizontalAlignment = horizontalAlignment || this.horizontalAlignment;\n      verticalAlignment = verticalAlignment || this.verticalAlignment;\n      this.$container.removeClass(this._alignClasses());\n      this.$body.removeClass(this._alignClasses());\n      this.$container.addClass(verticalAlignment + ' ' + horizontalAlignment);\n      this.$body.addClass(verticalAlignment + ' ' + horizontalAlignment); // Make sure the elements inside the header have the same style as to blueprint (menu)\n      // This makes it possible to position the content in the header (icon, text) exactly on top of the content of the blueprint\n\n      this.$head.copyCssIfGreater(this.$headBlueprint, 'padding');\n      this.$head.copyCss(this.$headBlueprint, 'line-height');\n      this.$head.height(this.$headBlueprint.height());\n      this.$head.width(this.$headBlueprint.width());\n\n      this._copyStyleToHeadChildren();\n\n      headSize = graphics.size(this.$head, true);\n      bodySize = graphics.size(this.$body, true);\n      bodySize.width = Math.max(bodySize.width, headSize.width);\n      bodyWidth = bodySize.width;\n      pos = this.$headBlueprint.offset(); // this.$parent might not be at (0,0) of the document\n\n      var parentOffset = this.$parent.offset();\n      pos.left -= parentOffset.left;\n      pos.top -= parentOffset.top;\n      left = pos.left;\n      headInsets = graphics.insets(this.$head);\n      menuInsets = graphics.insets(this.$headBlueprint);\n      top = pos.top - headInsets.top + menuInsets.top;\n\n      if (verticalAlignment === Popup.Alignment.TOP) {\n        top -= bodySize.height;\n        headTop = bodyTop + bodySize.height;\n        decoTop = headTop - 1; // -1 is body border (the purpose of deco is to hide the body border)\n\n        this.$container.cssMarginBottom(headSize.height);\n        this.$container.css('margin-top', '');\n      } else if (verticalAlignment === Popup.Alignment.BOTTOM) {\n        headTop -= headSize.height;\n        this.$container.cssMarginTop(headSize.height);\n        this.$container.css('margin-bottom', '');\n      }\n\n      $.log.isTraceEnabled() && $.log.trace('bodyWidth=' + bodyWidth + ' pos=[left=' + pos.left + ' top=' + pos.top + '] headSize=' + headSize + ' headInsets=' + headInsets + ' left=' + left + ' top=' + top);\n      this.$head.cssTop(headTop);\n      this.$body.cssTop(bodyTop);\n      this.$deco.cssTop(decoTop);\n\n      if (horizontalAlignment === Popup.Alignment.RIGHTEDGE) {\n        widthDiff = bodyWidth - headSize.width;\n        left -= widthDiff + headInsets.left - menuInsets.left;\n        this.$head.cssLeft(widthDiff);\n        this.$body.cssLeft(0);\n        this.$deco.cssLeft(widthDiff + this.$head.cssBorderLeftWidth()).width(headSize.width - this.$head.cssBorderWidthX());\n      } else {\n        left = left - headInsets.left + menuInsets.left;\n        this.$head.cssLeft(0);\n        this.$deco.cssLeft(1).width(headSize.width - 2);\n      }\n\n      this.horizontalAlignment = horizontalAlignment;\n      this.verticalAlignment = verticalAlignment;\n      this.setLocation(new Point(left, top)); // Explicitly write the (rounded, by jQuery) sizes to the elements to prevent rounding issues\n\n      graphics.setSize(this.$head, headSize);\n      graphics.setSize(this.$body, bodySize);\n    }\n  }, {\n    key: \"_glassPaneTargets\",\n    value: function _glassPaneTargets() {\n      return [this.$container, this.$head];\n    }\n  }]);\n\n  return PopupWithHead;\n}(Popup);\n\nexport { PopupWithHead as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/popup/PopupWithHead.js"],"names":["graphics","HtmlComponent","NullLayout","Point","Popup","PopupWithHeadLayout","scout","scrollbars","$","PopupWithHead","$head","$body","$deco","$parent","horizontalSwitch","verticalSwitch","_headVisible","windowResizeType","options","trimWidth","nvl","_$createBody","_renderHead","update","$container","appendDiv","htmlBody","install","session","setLayout","_createBodyLayout","_modifyBody","_removeHead","makeDiv","on","_onHeadMouseDown","bind","prepend","append","$headBlueprint","html","_copyStyleToHeadChildren","remove","className","hasClass","addClass","$blueprintChildren","children","each","i","$headChild","$blueprintChild","eq","copyCss","event","isOrHas","target","close","$element","clazz","switchIfNecessary","horizontalAlignment","verticalAlignment","overlap","pos","removeClass","_alignClasses","Alignment","TOP","BOTTOM","LEFTEDGE","RIGHTEDGE","_positionImpl","offset","x","left","y","top","parentOffset","headSize","bodySize","bodyWidth","widthDiff","headInsets","menuInsets","bodyTop","headTop","decoTop","copyCssIfGreater","height","width","size","Math","max","insets","cssMarginBottom","css","cssMarginTop","log","isTraceEnabled","trace","cssTop","cssLeft","cssBorderLeftWidth","cssBorderWidthX","setLocation","setSize"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {graphics, HtmlComponent, NullLayout, Point, Popup, PopupWithHeadLayout, scout, scrollbars} from '../index';\nimport $ from 'jquery';\n\nexport default class PopupWithHead extends Popup {\n\n  constructor() {\n    super();\n    this.$head;\n    this.$body;\n    this.$deco;\n    this.$parent;\n    this.horizontalSwitch = true;\n    this.verticalSwitch = true;\n    this._headVisible = true;\n    this.windowResizeType = 'remove';\n  }\n\n  _createLayout() {\n    return new PopupWithHeadLayout(this);\n  }\n\n  _init(options) {\n    super._init(options);\n\n    // Compared to a regular popup, the popup is aligned with the head and either opened left or right,\n    // -> the width should be adjusted as well if it does not fit into the window\n    this.trimWidth = scout.nvl(options.trimWidth, this._headVisible);\n  }\n\n  _render() {\n    super._render();\n\n    this._$createBody();\n\n    if (this._headVisible) {\n      this._renderHead();\n    }\n  }\n\n  _postRender() {\n    super._postRender();\n    scrollbars.update(this.$body);\n  }\n\n  _$createBody() {\n    this.$body = this.$container.appendDiv('popup-body');\n    // Complete the layout hierarchy between the popup and the menu items\n    var htmlBody = HtmlComponent.install(this.$body, this.session);\n    htmlBody.setLayout(this._createBodyLayout());\n\n    this._modifyBody();\n  }\n\n  _createBodyLayout() {\n    return new NullLayout();\n  }\n\n  rerenderHead() {\n    this._removeHead();\n    this._renderHead();\n  }\n\n  /**\n   * Copies html from this.$headBlueprint, if set.\n   */\n  _renderHead() {\n    this.$deco = this.$container.makeDiv('popup-deco');\n    this.$head = this.$container\n      .makeDiv('popup-head menu-item')\n      .on('mousedown', '', this._onHeadMouseDown.bind(this));\n    this.$container\n      .prepend(this.$head)\n      .append(this.$deco);\n    if (this.$headBlueprint) {\n      this.$head.html(this.$headBlueprint.html());\n      this._copyStyleToHeadChildren();\n    }\n  }\n\n  /**\n   * Sets CSS classes or CSS-properties on the body.\n   */\n  _modifyBody() {\n    // NOP\n  }\n\n  _removeHead() {\n    if (this.$head) {\n      this.$head.remove();\n    }\n    if (this.$deco) {\n      this.$deco.remove();\n    }\n  }\n\n  _copyCssClassToHead(className) {\n    if (this.$headBlueprint && this.$headBlueprint.hasClass(className)) {\n      this.$head.addClass(className);\n    }\n  }\n\n  _copyStyleToHeadChildren() {\n    var $blueprintChildren = this.$headBlueprint.children();\n    this.$head.children().each(function(i) {\n      var $headChild = $(this);\n      var $blueprintChild = $blueprintChildren.eq(i);\n      $headChild.copyCss($blueprintChild, 'margin padding line-height border vertical-align font-size display width height');\n    });\n  }\n\n  _onHeadMouseDown(event) {\n    if (this.$head && this.$head.isOrHas(event.target)) {\n      this.close();\n    }\n  }\n\n  /**\n   * @override\n   */\n  _isMouseDownOutside(event) {\n    if (this.$headBlueprint && this.$headBlueprint.isOrHas(event.target)) {\n      // click on the head still belongs to the popup -> not an outside click -> do not close popup\n      return false;\n    }\n\n    return super._isMouseDownOutside(event);\n  }\n\n  appendToBody($element) {\n    this.$body.append($element);\n  }\n\n  addClassToBody(clazz) {\n    this.$body.addClass(clazz);\n  }\n\n  /**\n   * @override Popup.js\n   */\n  _position(switchIfNecessary) {\n    var $container = this.$container;\n    if (!$container) {\n      // When layouting the menu bar, menus are removed at first and then added anew.\n      return;\n    }\n    var horizontalAlignment, verticalAlignment, overlap, pos;\n    if (!this._headVisible) {\n      // If head is not visible, use default implementation and adjust $body to $container\n      super._position(switchIfNecessary);\n      this.$body.removeClass(this._alignClasses());\n      verticalAlignment = Popup.Alignment.TOP;\n      if ($container.hasClass(Popup.Alignment.BOTTOM)) {\n        verticalAlignment = Popup.Alignment.BOTTOM;\n      }\n      horizontalAlignment = Popup.Alignment.LEFTEDGE;\n      if ($container.hasClass(Popup.Alignment.RIGHTEDGE)) {\n        horizontalAlignment = Popup.Alignment.RIGHTEDGE;\n      }\n      this.$body.addClass(verticalAlignment + ' ' + horizontalAlignment);\n      return;\n    }\n    this._positionImpl();\n\n    var horizontalSwitch = scout.nvl(switchIfNecessary, this.horizontalSwitch);\n    var verticalSwitch = scout.nvl(switchIfNecessary, this.verticalSwitch);\n    if (horizontalSwitch || verticalSwitch) {\n      pos = $container.offset();\n      overlap = this.overlap({\n        x: pos.left,\n        y: pos.top\n      }, false);\n      // this.$parent might not be at (0,0) of the document\n      var parentOffset = this.$parent.offset();\n      overlap.x -= parentOffset.left;\n      overlap.y -= parentOffset.top;\n      if (overlap.y > 0 && verticalSwitch) {\n        // switch opening direction\n        verticalAlignment = Popup.Alignment.TOP;\n      }\n      if (overlap.x > 0 && horizontalSwitch) {\n        // switch opening direction\n        horizontalAlignment = Popup.Alignment.RIGHTEDGE;\n      }\n      if (horizontalAlignment || verticalAlignment) {\n        // Align again if openingDirection has to be switched\n        this._positionImpl(horizontalAlignment, verticalAlignment);\n      }\n    }\n  }\n\n  _positionImpl(horizontalAlignment, verticalAlignment) {\n    var pos, headSize, bodySize, bodyWidth, widthDiff, left, top, headInsets, menuInsets,\n      bodyTop = 0,\n      headTop = 0,\n      decoTop = 0;\n\n    horizontalAlignment = horizontalAlignment || this.horizontalAlignment;\n    verticalAlignment = verticalAlignment || this.verticalAlignment;\n    this.$container.removeClass(this._alignClasses());\n    this.$body.removeClass(this._alignClasses());\n    this.$container.addClass(verticalAlignment + ' ' + horizontalAlignment);\n    this.$body.addClass(verticalAlignment + ' ' + horizontalAlignment);\n\n    // Make sure the elements inside the header have the same style as to blueprint (menu)\n    // This makes it possible to position the content in the header (icon, text) exactly on top of the content of the blueprint\n    this.$head.copyCssIfGreater(this.$headBlueprint, 'padding');\n    this.$head.copyCss(this.$headBlueprint, 'line-height');\n    this.$head.height(this.$headBlueprint.height());\n    this.$head.width(this.$headBlueprint.width());\n\n    this._copyStyleToHeadChildren();\n\n    headSize = graphics.size(this.$head, true);\n    bodySize = graphics.size(this.$body, true);\n    bodySize.width = Math.max(bodySize.width, headSize.width);\n    bodyWidth = bodySize.width;\n\n    pos = this.$headBlueprint.offset();\n    // this.$parent might not be at (0,0) of the document\n    var parentOffset = this.$parent.offset();\n    pos.left -= parentOffset.left;\n    pos.top -= parentOffset.top;\n\n    left = pos.left;\n    headInsets = graphics.insets(this.$head);\n    menuInsets = graphics.insets(this.$headBlueprint);\n    top = pos.top - headInsets.top + menuInsets.top;\n\n    if (verticalAlignment === Popup.Alignment.TOP) {\n      top -= bodySize.height;\n      headTop = bodyTop + bodySize.height;\n      decoTop = headTop - 1; // -1 is body border (the purpose of deco is to hide the body border)\n      this.$container.cssMarginBottom(headSize.height);\n      this.$container.css('margin-top', '');\n    } else if (verticalAlignment === Popup.Alignment.BOTTOM) {\n      headTop -= headSize.height;\n      this.$container.cssMarginTop(headSize.height);\n      this.$container.css('margin-bottom', '');\n    }\n\n    $.log.isTraceEnabled() && $.log.trace('bodyWidth=' + bodyWidth + ' pos=[left=' + pos.left + ' top=' + pos.top + '] headSize=' + headSize +\n      ' headInsets=' + headInsets + ' left=' + left + ' top=' + top);\n    this.$head.cssTop(headTop);\n    this.$body.cssTop(bodyTop);\n    this.$deco.cssTop(decoTop);\n\n    if (horizontalAlignment === Popup.Alignment.RIGHTEDGE) {\n      widthDiff = bodyWidth - headSize.width;\n      left -= widthDiff + headInsets.left - menuInsets.left;\n      this.$head.cssLeft(widthDiff);\n      this.$body.cssLeft(0);\n      this.$deco.cssLeft(widthDiff + this.$head.cssBorderLeftWidth())\n        .width(headSize.width - this.$head.cssBorderWidthX());\n    } else {\n      left = left - headInsets.left + menuInsets.left;\n      this.$head.cssLeft(0);\n      this.$deco.cssLeft(1)\n        .width(headSize.width - 2);\n    }\n\n    this.horizontalAlignment = horizontalAlignment;\n    this.verticalAlignment = verticalAlignment;\n    this.setLocation(new Point(left, top));\n\n    // Explicitly write the (rounded, by jQuery) sizes to the elements to prevent rounding issues\n    graphics.setSize(this.$head, headSize);\n    graphics.setSize(this.$body, bodySize);\n  }\n\n  _glassPaneTargets() {\n    return [this.$container, this.$head];\n  }\n}\n"]},"metadata":{},"sourceType":"module"}