{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { AbstractLayout, arrays, Dimension, graphics, HtmlComponent, MenuBar, scout } from '../../index';\n\nvar MenuBarLayout = /*#__PURE__*/function (_AbstractLayout) {\n  _inherits(MenuBarLayout, _AbstractLayout);\n\n  var _super = _createSuper(MenuBarLayout);\n\n  function MenuBarLayout(menuBar) {\n    var _this;\n\n    _classCallCheck(this, MenuBarLayout);\n\n    _this = _super.call(this);\n    _this._menuBar = menuBar;\n    _this._overflowMenuItems = [];\n    _this._visibleMenuItems = [];\n    _this._ellipsis = null;\n    _this.collapsed = false;\n    return _this;\n  }\n\n  _createClass(MenuBarLayout, [{\n    key: \"layout\",\n    value: function layout($container) {\n      var menuItems = this._menuBar.orderedMenuItems.left.concat(this._menuBar.orderedMenuItems.right),\n          htmlContainer = HtmlComponent.get($container),\n          ellipsis;\n\n      this.undoShrink(menuItems);\n      ellipsis = arrays.find(menuItems, function (menuItem) {\n        return menuItem.ellipsis;\n      });\n      this.preferredLayoutSize($container, {\n        widthHint: htmlContainer.availableSize().width\n      }); // first set visible to ensure the correct menu gets the tabindex. Therefore the ellipsis visibility is split.\n\n      if (ellipsis && this._overflowMenuItems.length > 0) {\n        ellipsis.setHidden(false);\n      }\n\n      this._visibleMenuItems.forEach(function (menuItem) {\n        menuItem._setOverflown(false);\n      }, this);\n\n      this._overflowMenuItems.forEach(function (menuItem) {\n        menuItem._setOverflown(true);\n      });\n\n      if (ellipsis && this._overflowMenuItems.length === 0) {\n        ellipsis.setHidden(true);\n      } // remove all separators\n\n\n      this._overflowMenuItems = this._overflowMenuItems.filter(function (menuItem) {\n        return !menuItem.separator;\n      }); // set childActions to empty array to prevent the menuItems from calling remove.\n\n      if (ellipsis) {\n        ellipsis._closePopup();\n\n        ellipsis.setChildActions(this._overflowMenuItems);\n      } // trigger menu items layout\n\n\n      this._visibleMenuItems.forEach(function (menuItem) {\n        menuItem.validateLayout();\n      });\n\n      this._visibleMenuItems.forEach(function (menuItem) {\n        // Make sure open popups are at the correct position after layouting\n        if (menuItem.popup) {\n          menuItem.popup.position();\n        }\n      });\n    }\n  }, {\n    key: \"preferredLayoutSize\",\n    value: function preferredLayoutSize($container, options) {\n      this._overflowMenuItems = [];\n\n      if (!this._menuBar.isVisible()) {\n        return new Dimension(0, 0);\n      }\n\n      var visibleMenuItems = this._menuBar.orderedMenuItems.all.filter(function (menuItem) {\n        return menuItem.visible;\n      }, this),\n          overflowMenuItems = visibleMenuItems.filter(function (menuItem) {\n        var overflown = menuItem.overflown;\n\n        menuItem._setOverflown(false);\n\n        return overflown;\n      }),\n          overflowableIndexes = [],\n          htmlComp = HtmlComponent.get($container),\n          prefSize = new Dimension(0, 0),\n          prefWidth = Number.MAX_VALUE; // consider avoid falsy 0 in tabboxes a 0 withHint will be used to calculate the minimum width\n\n\n      if (options.widthHint === 0 || options.widthHint) {\n        prefWidth = options.widthHint - htmlComp.insets().horizontal();\n      } // shortcut for minimum size.\n\n\n      if (prefWidth <= 0) {\n        // reset overflown\n        overflowMenuItems.forEach(function (menuItem) {\n          menuItem._setOverflown(true);\n        });\n        return this._minSize(visibleMenuItems);\n      }\n\n      prefSize = this._prefSize(visibleMenuItems);\n\n      if (prefSize.width > prefWidth) {\n        this.shrink(visibleMenuItems);\n      } // fill overflowable indexes\n\n\n      visibleMenuItems.forEach(function (menuItem, index) {\n        if (menuItem.stackable) {\n          overflowableIndexes.push(index);\n        }\n      });\n      var overflowIndex = -1;\n\n      this._setFirstLastMenuMarker(visibleMenuItems);\n\n      prefSize = this._prefSize(visibleMenuItems);\n\n      while (prefSize.width > prefWidth && overflowableIndexes.length > 0) {\n        if (this._menuBar.ellipsisPosition === MenuBar.EllipsisPosition.RIGHT) {\n          overflowIndex = overflowableIndexes.splice(-1)[0];\n        } else {\n          overflowIndex = overflowableIndexes.splice(0, 1)[0] - this._overflowMenuItems.length;\n        }\n\n        this._overflowMenuItems.splice(0, 0, visibleMenuItems[overflowIndex]);\n\n        visibleMenuItems.splice(overflowIndex, 1);\n\n        this._setFirstLastMenuMarker(visibleMenuItems);\n\n        prefSize = this._prefSize(visibleMenuItems);\n      } // reset overflown\n\n\n      overflowMenuItems.forEach(function (menuItem) {\n        menuItem._setOverflown(true);\n      });\n      this._visibleMenuItems = visibleMenuItems;\n      return prefSize.add(htmlComp.insets());\n    }\n  }, {\n    key: \"_minSize\",\n    value: function _minSize(visibleMenuItems) {\n      var prefSize,\n          minVisibleMenuItems = visibleMenuItems.filter(function (menuItem) {\n        return menuItem.ellisis || !menuItem.stackable;\n      }, this);\n\n      this._setFirstLastMenuMarker(minVisibleMenuItems, true);\n\n      prefSize = this._prefSize(minVisibleMenuItems, true);\n      return prefSize;\n    }\n  }, {\n    key: \"_prefSize\",\n    value: function _prefSize(menuItems, considerEllipsis) {\n      var prefSize = new Dimension(0, 0),\n          itemSize = new Dimension(0, 0);\n      considerEllipsis = scout.nvl(considerEllipsis, this._overflowMenuItems.length > 0);\n      menuItems.forEach(function (menuItem) {\n        itemSize = new Dimension(0, 0);\n\n        if (menuItem.ellipsis) {\n          if (considerEllipsis) {\n            itemSize = this._menuItemSize(menuItem);\n          }\n        } else {\n          itemSize = this._menuItemSize(menuItem);\n        }\n\n        prefSize.height = Math.max(prefSize.height, itemSize.height);\n        prefSize.width += itemSize.width;\n      }, this);\n      return prefSize;\n    }\n  }, {\n    key: \"_menuItemSize\",\n    value: function _menuItemSize(menuItem) {\n      var prefSize,\n          classList = menuItem.$container.attr('class');\n      menuItem.$container.removeClass('overflown');\n      menuItem.$container.removeClass('hidden');\n      menuItem.htmlComp.invalidateLayout();\n      prefSize = menuItem.htmlComp.prefSize({\n        useCssSize: true,\n        exact: true\n      }).add(graphics.margins(menuItem.$container));\n      menuItem.$container.attrOrRemove('class', classList);\n      return prefSize;\n    }\n  }, {\n    key: \"_setFirstLastMenuMarker\",\n    value: function _setFirstLastMenuMarker(visibleMenuItems, considerEllipsis) {\n      var menuItems = visibleMenuItems;\n      considerEllipsis = scout.nvl(considerEllipsis, this._overflowMenuItems.length > 0); // reset\n\n      this._menuBar.orderedMenuItems.all.forEach(function (menuItem) {\n        menuItem.$container.removeClass('first last');\n      }); // set first and last\n\n\n      if (!considerEllipsis) {\n        // remove ellipsis\n        menuItems = menuItems.filter(function (menuItem) {\n          return !menuItem.ellipsis;\n        });\n      }\n\n      if (menuItems.length > 0) {\n        menuItems[0].$container.addClass('first');\n        menuItems[menuItems.length - 1].$container.addClass('last');\n      }\n    }\n    /**\n     * Makes the text invisible of all shrinkable menus with an icon\n     */\n\n  }, {\n    key: \"shrink\",\n    value: function shrink(menus) {\n      menus.forEach(function (menu) {\n        if (menu.textVisibleOrig !== undefined) {\n          // already done\n          return;\n        }\n\n        if (menu.shrinkable && menu.icon) {\n          menu.textVisibleOrig = menu.textVisible;\n          menu.htmlComp.suppressInvalidate = true;\n          menu.setTextVisible(false);\n          menu.htmlComp.suppressInvalidate = false;\n        }\n      }, this);\n    }\n  }, {\n    key: \"undoShrink\",\n    value: function undoShrink(menus) {\n      menus.forEach(function (menu) {\n        if (menu.textVisibleOrig === undefined) {\n          return;\n        } // Restore old text visible state\n\n\n        menu.htmlComp.suppressInvalidate = true;\n        menu.setTextVisible(menu.textVisibleOrig);\n        menu.htmlComp.suppressInvalidate = false;\n        menu.textVisibleOrig = undefined;\n      }, this);\n    }\n    /* --- STATIC HELPERS ------------------------------------------------------------- */\n\n    /**\n     * @memberOf MenuBarLayout\n     */\n\n  }], [{\n    key: \"size\",\n    value: function size(htmlMenuBar, containerSize) {\n      var menuBarSize = htmlMenuBar.prefSize();\n      menuBarSize.width = containerSize.width;\n      menuBarSize = menuBarSize.subtract(htmlMenuBar.margins());\n      return menuBarSize;\n    }\n  }]);\n\n  return MenuBarLayout;\n}(AbstractLayout);\n\nexport { MenuBarLayout as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/menu/menubar/MenuBarLayout.js"],"names":["AbstractLayout","arrays","Dimension","graphics","HtmlComponent","MenuBar","scout","MenuBarLayout","menuBar","_menuBar","_overflowMenuItems","_visibleMenuItems","_ellipsis","collapsed","$container","menuItems","orderedMenuItems","left","concat","right","htmlContainer","get","ellipsis","undoShrink","find","menuItem","preferredLayoutSize","widthHint","availableSize","width","length","setHidden","forEach","_setOverflown","filter","separator","_closePopup","setChildActions","validateLayout","popup","position","options","isVisible","visibleMenuItems","all","visible","overflowMenuItems","overflown","overflowableIndexes","htmlComp","prefSize","prefWidth","Number","MAX_VALUE","insets","horizontal","_minSize","_prefSize","shrink","index","stackable","push","overflowIndex","_setFirstLastMenuMarker","ellipsisPosition","EllipsisPosition","RIGHT","splice","add","minVisibleMenuItems","ellisis","considerEllipsis","itemSize","nvl","_menuItemSize","height","Math","max","classList","attr","removeClass","invalidateLayout","useCssSize","exact","margins","attrOrRemove","addClass","menus","menu","textVisibleOrig","undefined","shrinkable","icon","textVisible","suppressInvalidate","setTextVisible","htmlMenuBar","containerSize","menuBarSize","subtract"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {AbstractLayout, arrays, Dimension, graphics, HtmlComponent, MenuBar, scout} from '../../index';\n\nexport default class MenuBarLayout extends AbstractLayout {\n\n  constructor(menuBar) {\n    super();\n    this._menuBar = menuBar;\n\n    this._overflowMenuItems = [];\n    this._visibleMenuItems = [];\n    this._ellipsis = null;\n    this.collapsed = false;\n  }\n\n  layout($container) {\n    var menuItems = this._menuBar.orderedMenuItems.left.concat(this._menuBar.orderedMenuItems.right),\n      htmlContainer = HtmlComponent.get($container),\n      ellipsis;\n\n    this.undoShrink(menuItems);\n\n    ellipsis = arrays.find(menuItems, function(menuItem) {\n      return menuItem.ellipsis;\n    });\n\n    this.preferredLayoutSize($container, {\n      widthHint: htmlContainer.availableSize().width\n    });\n\n    // first set visible to ensure the correct menu gets the tabindex. Therefore the ellipsis visibility is split.\n    if (ellipsis && this._overflowMenuItems.length > 0) {\n      ellipsis.setHidden(false);\n    }\n    this._visibleMenuItems.forEach(function(menuItem) {\n      menuItem._setOverflown(false);\n    }, this);\n\n    this._overflowMenuItems.forEach(function(menuItem) {\n      menuItem._setOverflown(true);\n    });\n    if (ellipsis && this._overflowMenuItems.length === 0) {\n      ellipsis.setHidden(true);\n    }\n    // remove all separators\n    this._overflowMenuItems = this._overflowMenuItems.filter(function(menuItem) {\n      return !menuItem.separator;\n    });\n\n    // set childActions to empty array to prevent the menuItems from calling remove.\n    if (ellipsis) {\n      ellipsis._closePopup();\n      ellipsis.setChildActions(this._overflowMenuItems);\n    }\n\n    // trigger menu items layout\n    this._visibleMenuItems.forEach(function(menuItem) {\n      menuItem.validateLayout();\n    });\n\n    this._visibleMenuItems.forEach(function(menuItem) {\n      // Make sure open popups are at the correct position after layouting\n      if (menuItem.popup) {\n        menuItem.popup.position();\n      }\n    });\n  }\n\n  preferredLayoutSize($container, options) {\n    this._overflowMenuItems = [];\n    if (!this._menuBar.isVisible()) {\n      return new Dimension(0, 0);\n    }\n    var visibleMenuItems = this._menuBar.orderedMenuItems.all.filter(function(menuItem) {\n        return menuItem.visible;\n      }, this),\n      overflowMenuItems = visibleMenuItems.filter(function(menuItem) {\n        var overflown = menuItem.overflown;\n        menuItem._setOverflown(false);\n        return overflown;\n      }),\n      overflowableIndexes = [],\n      htmlComp = HtmlComponent.get($container),\n      prefSize = new Dimension(0, 0),\n      prefWidth = Number.MAX_VALUE;\n\n    // consider avoid falsy 0 in tabboxes a 0 withHint will be used to calculate the minimum width\n    if (options.widthHint === 0 || options.widthHint) {\n      prefWidth = options.widthHint - htmlComp.insets().horizontal();\n    }\n    // shortcut for minimum size.\n    if (prefWidth <= 0) {\n      // reset overflown\n      overflowMenuItems.forEach(function(menuItem) {\n        menuItem._setOverflown(true);\n      });\n      return this._minSize(visibleMenuItems);\n    }\n\n    prefSize = this._prefSize(visibleMenuItems);\n    if (prefSize.width > prefWidth) {\n      this.shrink(visibleMenuItems);\n    }\n\n    // fill overflowable indexes\n    visibleMenuItems.forEach(function(menuItem, index) {\n      if (menuItem.stackable) {\n        overflowableIndexes.push(index);\n      }\n    });\n\n    var overflowIndex = -1;\n    this._setFirstLastMenuMarker(visibleMenuItems);\n    prefSize = this._prefSize(visibleMenuItems);\n    while (prefSize.width > prefWidth && overflowableIndexes.length > 0) {\n      if (this._menuBar.ellipsisPosition === MenuBar.EllipsisPosition.RIGHT) {\n        overflowIndex = overflowableIndexes.splice(-1)[0];\n      } else {\n        overflowIndex = overflowableIndexes.splice(0, 1)[0] - this._overflowMenuItems.length;\n      }\n      this._overflowMenuItems.splice(0, 0, visibleMenuItems[overflowIndex]);\n      visibleMenuItems.splice(overflowIndex, 1);\n      this._setFirstLastMenuMarker(visibleMenuItems);\n      prefSize = this._prefSize(visibleMenuItems);\n    }\n\n    // reset overflown\n    overflowMenuItems.forEach(function(menuItem) {\n      menuItem._setOverflown(true);\n    });\n\n    this._visibleMenuItems = visibleMenuItems;\n    return prefSize.add(htmlComp.insets());\n  }\n\n  _minSize(visibleMenuItems) {\n    var prefSize,\n      minVisibleMenuItems = visibleMenuItems.filter(function(menuItem) {\n        return menuItem.ellisis || !menuItem.stackable;\n      }, this);\n    this._setFirstLastMenuMarker(minVisibleMenuItems, true);\n    prefSize = this._prefSize(minVisibleMenuItems, true);\n    return prefSize;\n  }\n\n  _prefSize(menuItems, considerEllipsis) {\n    var prefSize = new Dimension(0, 0),\n      itemSize = new Dimension(0, 0);\n    considerEllipsis = scout.nvl(considerEllipsis, this._overflowMenuItems.length > 0);\n    menuItems.forEach(function(menuItem) {\n      itemSize = new Dimension(0, 0);\n      if (menuItem.ellipsis) {\n        if (considerEllipsis) {\n          itemSize = this._menuItemSize(menuItem);\n        }\n      } else {\n        itemSize = this._menuItemSize(menuItem);\n      }\n      prefSize.height = Math.max(prefSize.height, itemSize.height);\n      prefSize.width += itemSize.width;\n    }, this);\n    return prefSize;\n  }\n\n  _menuItemSize(menuItem) {\n    var prefSize,\n      classList = menuItem.$container.attr('class');\n\n    menuItem.$container.removeClass('overflown');\n    menuItem.$container.removeClass('hidden');\n\n    menuItem.htmlComp.invalidateLayout();\n    prefSize = menuItem.htmlComp.prefSize({\n      useCssSize: true,\n      exact: true\n    }).add(graphics.margins(menuItem.$container));\n\n    menuItem.$container.attrOrRemove('class', classList);\n    return prefSize;\n  }\n\n  _setFirstLastMenuMarker(visibleMenuItems, considerEllipsis) {\n    var menuItems = visibleMenuItems;\n    considerEllipsis = scout.nvl(considerEllipsis, this._overflowMenuItems.length > 0);\n\n    // reset\n    this._menuBar.orderedMenuItems.all.forEach(function(menuItem) {\n      menuItem.$container.removeClass('first last');\n    });\n\n    // set first and last\n    if (!considerEllipsis) {\n      // remove ellipsis\n      menuItems = menuItems.filter(function(menuItem) {\n        return !menuItem.ellipsis;\n      });\n    }\n    if (menuItems.length > 0) {\n      menuItems[0].$container.addClass('first');\n      menuItems[menuItems.length - 1].$container.addClass('last');\n    }\n  }\n\n  /**\n   * Makes the text invisible of all shrinkable menus with an icon\n   */\n  shrink(menus) {\n    menus.forEach(function(menu) {\n      if (menu.textVisibleOrig !== undefined) {\n        // already done\n        return;\n      }\n      if (menu.shrinkable && menu.icon) {\n        menu.textVisibleOrig = menu.textVisible;\n        menu.htmlComp.suppressInvalidate = true;\n        menu.setTextVisible(false);\n        menu.htmlComp.suppressInvalidate = false;\n      }\n    }, this);\n  }\n\n  undoShrink(menus) {\n    menus.forEach(function(menu) {\n      if (menu.textVisibleOrig === undefined) {\n        return;\n      }\n      // Restore old text visible state\n      menu.htmlComp.suppressInvalidate = true;\n      menu.setTextVisible(menu.textVisibleOrig);\n      menu.htmlComp.suppressInvalidate = false;\n      menu.textVisibleOrig = undefined;\n    }, this);\n  }\n\n  /* --- STATIC HELPERS ------------------------------------------------------------- */\n\n  /**\n   * @memberOf MenuBarLayout\n   */\n  static size(htmlMenuBar, containerSize) {\n    var menuBarSize = htmlMenuBar.prefSize();\n    menuBarSize.width = containerSize.width;\n    menuBarSize = menuBarSize.subtract(htmlMenuBar.margins());\n    return menuBarSize;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}