{"ast":null,"code":"/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { EventSupport, router, strings } from '../index';\nimport $ from 'jquery';\nvar routes = []; // array with Routes\n\nvar events = new EventSupport();\nvar currentRoute = null;\nvar defaultLocation = null;\n/**\n * Default location is used, when no route is set in the URL when routes are activated initially.\n * Typically this points to your 'home' page.\n */\n\nexport function setDefaultLocation(location) {\n  defaultLocation = '#' + location;\n}\nexport function prepare($a, location) {\n  if (!strings.startsWith(location, '#')) {\n    location = '#' + location;\n  }\n\n  $a.attr('href', location).on('mousedown', function (event) {\n    activate(location);\n    return false; // prevent default\n  });\n}\nexport function activate(location) {\n  if (!location) {\n    var regexp = new RegExp('[^/]*$'); // match everything after last slash\n\n    var matches = regexp.exec(document.location.href);\n    location = matches[0];\n  } // no route is set in the URL\n\n\n  if (strings.empty(location) || '/' === location) {\n    location = defaultLocation;\n  }\n\n  var i,\n      route = null;\n\n  for (i = 0; i < routes.length; i++) {\n    route = routes[i];\n\n    if (route.matches(location)) {\n      if (route === currentRoute && route.location === location) {\n        $.log.isDebugEnabled() && $.log.debug('Route has not changed - do not activate route');\n        return;\n      } // deactivate old route\n\n\n      if (currentRoute) {\n        currentRoute.deactivate();\n      } // activate new route\n\n\n      currentRoute = route;\n      currentRoute.activate(location);\n      window.location.replace(location);\n      $.log.isInfoEnabled() && $.log.info('router: activated route for location=', location);\n      events.trigger('routeChange', {\n        route: route\n      });\n      return;\n    }\n  }\n\n  $.log.warn('router: no route registered for location=', location);\n}\nexport function register(route) {\n  routes.push(route);\n}\nexport function on(event, handler) {\n  events.on(event, handler);\n}\n/**\n * Updates the location (URL) field in the browser.\n *\n * @param {string} routeRef a string which identifies a route.\n */\n\nexport function updateLocation(routeRef) {\n  var location = '#' + routeRef;\n  window.location.replace(location);\n}\nexport default {\n  activate: activate,\n  currentRoute: currentRoute,\n  defaultLocation: defaultLocation,\n  events: events,\n  on: on,\n  prepare: prepare,\n  register: register,\n  routes: routes,\n  setDefaultLocation: setDefaultLocation,\n  updateLocation: updateLocation\n};\nwindow.addEventListener('popstate', function (event) {\n  router.activate(null);\n  return false;\n});","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/router/router.js"],"names":["EventSupport","router","strings","$","routes","events","currentRoute","defaultLocation","setDefaultLocation","location","prepare","$a","startsWith","attr","on","event","activate","regexp","RegExp","matches","exec","document","href","empty","i","route","length","log","isDebugEnabled","debug","deactivate","window","replace","isInfoEnabled","info","trigger","warn","register","push","handler","updateLocation","routeRef","addEventListener"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {EventSupport, router, strings} from '../index';\nimport $ from 'jquery';\n\nlet routes = []; // array with Routes\nlet events = new EventSupport();\nlet currentRoute = null;\nlet defaultLocation = null;\n\n/**\n * Default location is used, when no route is set in the URL when routes are activated initially.\n * Typically this points to your 'home' page.\n */\nexport function setDefaultLocation(location) {\n  defaultLocation = '#' + location;\n}\n\nexport function prepare($a, location) {\n  if (!strings.startsWith(location, '#')) {\n    location = '#' + location;\n  }\n  $a\n    .attr('href', location)\n    .on('mousedown', function(event) {\n      activate(location);\n      return false; // prevent default\n    });\n\n}\n\nexport function activate(location) {\n  if (!location) {\n    var regexp = new RegExp('[^/]*$'); // match everything after last slash\n    var matches = regexp.exec(document.location.href);\n    location = matches[0];\n  }\n\n  // no route is set in the URL\n  if (strings.empty(location) || '/' === location) {\n    location = defaultLocation;\n  }\n\n  var i, route = null;\n  for (i = 0; i < routes.length; i++) {\n    route = routes[i];\n    if (route.matches(location)) {\n\n      if (route === currentRoute && route.location === location) {\n        $.log.isDebugEnabled() && $.log.debug('Route has not changed - do not activate route');\n        return;\n      }\n\n      // deactivate old route\n      if (currentRoute) {\n        currentRoute.deactivate();\n      }\n\n      // activate new route\n      currentRoute = route;\n      currentRoute.activate(location);\n\n      window.location.replace(location);\n      $.log.isInfoEnabled() && $.log.info('router: activated route for location=', location);\n\n      events.trigger('routeChange', {\n        route: route\n      });\n      return;\n    }\n  }\n  $.log.warn('router: no route registered for location=', location);\n}\n\nexport function register(route) {\n  routes.push(route);\n}\n\nexport function on(event, handler) {\n  events.on(event, handler);\n}\n\n/**\n * Updates the location (URL) field in the browser.\n *\n * @param {string} routeRef a string which identifies a route.\n */\nexport function updateLocation(routeRef) {\n  var location = '#' + routeRef;\n  window.location.replace(location);\n}\n\nexport default {\n  activate,\n  currentRoute,\n  defaultLocation,\n  events,\n  on,\n  prepare,\n  register,\n  routes,\n  setDefaultLocation,\n  updateLocation\n};\n\nwindow.addEventListener('popstate', function(event) {\n  router.activate(null);\n  return false;\n});\n"]},"metadata":{},"sourceType":"module"}