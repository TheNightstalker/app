{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { AbstractLayout, Dimension, graphics, HtmlComponent, scout, TabArea } from '../../../index';\nimport $ from 'jquery';\n\nvar TabAreaLayout = /*#__PURE__*/function (_AbstractLayout) {\n  _inherits(TabAreaLayout, _AbstractLayout);\n\n  var _super = _createSuper(TabAreaLayout);\n\n  function TabAreaLayout(tabArea) {\n    var _this;\n\n    _classCallCheck(this, TabAreaLayout);\n\n    _this = _super.call(this);\n    _this.tabArea = tabArea;\n    _this.overflowTabs = [];\n    _this.visibleTabs = [];\n    _this._tabAreaPropertyChangeHandler = _this._onTabAreaPropertyChange.bind(_assertThisInitialized(_this));\n\n    _this.tabArea.on('propertyChange', _this._tabAreaPropertyChangeHandler);\n\n    _this.tabArea.one('remove', function () {\n      this.tabArea.off('propertyChange', this._tabAreaPropertyChangeHandler);\n    }.bind(_assertThisInitialized(_this)));\n\n    return _this;\n  }\n\n  _createClass(TabAreaLayout, [{\n    key: \"layout\",\n    value: function layout($container) {\n      var ellipsis = this.tabArea.ellipsis,\n          htmlContainer = HtmlComponent.get($container),\n          containerSize = htmlContainer.availableSize().subtract(htmlContainer.insets()); // compute visible and overflown tabs\n\n      this.preferredLayoutSize($container, {\n        widthHint: containerSize.width\n      });\n\n      if (this.overflowTabs.length > 0) {\n        ellipsis.setHidden(false);\n      }\n\n      this.visibleTabs.forEach(function (tabItem) {\n        tabItem.setOverflown(false);\n      });\n      this.overflowTabs.forEach(function (tabItem) {\n        tabItem.setOverflown(true);\n      });\n\n      if (this.overflowTabs.length === 0) {\n        ellipsis.setHidden(true);\n      }\n\n      ellipsis.setText(this.overflowTabs.length + '');\n      ellipsis.setChildActions(this.overflowTabs.map(function (tab) {\n        var menu = scout.create('Menu', {\n          parent: ellipsis,\n          text: tab.label,\n          tab: tab,\n          visible: tab.visible\n        });\n        menu.on('action', function (event) {\n          $.log.isDebugEnabled() && $.log.debug('(TabAreaLayout#_onClickEllipsis) tabItem=' + tab); // first close popup to ensure the focus is handled in the correct focus context.\n\n          ellipsis.popup.close();\n          tab.select();\n          tab.focus();\n        });\n        return menu;\n      }, this));\n\n      this._layoutSelectionMarker();\n    }\n  }, {\n    key: \"_layoutSelectionMarker\",\n    value: function _layoutSelectionMarker() {\n      var $selectionMarker = this.tabArea.$selectionMarker,\n          selectedTab = this.tabArea.selectedTab,\n          selectedItemBounds;\n\n      if (selectedTab) {\n        $selectionMarker.setVisible(true);\n        selectedItemBounds = graphics.bounds(selectedTab.$container);\n        $selectionMarker.cssLeft(selectedItemBounds.x);\n        $selectionMarker.cssWidth(selectedItemBounds.width);\n      } else {\n        $selectionMarker.setVisible(false);\n      }\n    }\n  }, {\n    key: \"preferredLayoutSize\",\n    value: function preferredLayoutSize($container, options) {\n      var htmlComp = HtmlComponent.get($container),\n          prefSize = new Dimension(0, 0),\n          prefWidth = Number.MAX_VALUE,\n          visibleTabItems = this.tabArea.tabs.filter(function (tabItem) {\n        return tabItem.isVisible();\n      }),\n          overflowableIndexes = visibleTabItems.map(function (tabItem, index) {\n        if (tabItem.selected) {\n          return -1;\n        }\n\n        return index;\n      }).filter(function (index) {\n        return index >= 0;\n      });\n      this.overflowTabs = []; // consider avoid falsy 0 in tabboxes a 0 withHint will be used to calculate the minimum width\n\n      if (options.widthHint === 0 || options.widthHint) {\n        prefWidth = options.widthHint - htmlComp.insets().horizontal();\n      } // shortcut for minimum size.\n\n\n      if (prefWidth <= 0) {\n        return this._minSize(visibleTabItems).add(htmlComp.insets());\n      }\n\n      var overflowIndex = -1;\n\n      this._setFirstLastMarker(visibleTabItems);\n\n      prefSize = this._prefSize(visibleTabItems);\n\n      while (prefSize.width > prefWidth && overflowableIndexes.length > 0) {\n        overflowIndex = overflowableIndexes.splice(-1)[0];\n        this.overflowTabs.splice(0, 0, visibleTabItems[overflowIndex]);\n        visibleTabItems.splice(overflowIndex, 1);\n\n        this._setFirstLastMarker(visibleTabItems);\n\n        prefSize = this._prefSize(visibleTabItems);\n      }\n\n      this.visibleTabs = visibleTabItems; // Use the total available space if spreading tabs evenly.\n\n      if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n        return graphics.prefSize($container, options);\n      }\n\n      return graphics.exactPrefSize(prefSize.add(htmlComp.insets()), options);\n    }\n  }, {\n    key: \"_minSize\",\n    value: function _minSize(tabItems) {\n      var visibleTabItems = [],\n          prefSize;\n      this.overflowTabs = tabItems.filter(function (tabItem) {\n        if (tabItem.selected) {\n          visibleTabItems.push(tabItem);\n          return false;\n        }\n\n        return true;\n      }, this);\n      this.visibleTabs = visibleTabItems;\n\n      this._setFirstLastMarker(visibleTabItems);\n\n      prefSize = this._prefSize(visibleTabItems);\n      return prefSize;\n    }\n  }, {\n    key: \"_prefSize\",\n    value: function _prefSize(tabItems, considerEllipsis) {\n      var prefSize = tabItems.map(function (tabItem) {\n        return this._tabItemSize(tabItem.htmlComp);\n      }, this).reduce(function (prefSize, itemSize) {\n        prefSize.height = Math.max(prefSize.height, itemSize.height);\n        prefSize.width += itemSize.width;\n        return prefSize;\n      }, new Dimension(0, 0)),\n          ellipsisSize = new Dimension(0, 0);\n      considerEllipsis = scout.nvl(considerEllipsis, this.overflowTabs.length > 0);\n\n      if (considerEllipsis) {\n        ellipsisSize = this._tabItemSize(this.tabArea.ellipsis.htmlComp);\n        prefSize.height = Math.max(prefSize.height, ellipsisSize.height);\n        prefSize.width += ellipsisSize.width;\n      }\n\n      return prefSize;\n    }\n  }, {\n    key: \"_setFirstLastMarker\",\n    value: function _setFirstLastMarker(tabItems, considerEllipsis) {\n      considerEllipsis = scout.nvl(considerEllipsis, this.overflowTabs.length > 0); // reset\n\n      this.tabArea.tabs.forEach(function (tabItem) {\n        tabItem.htmlComp.$comp.removeClass('first last');\n      });\n      this.tabArea.ellipsis.$container.removeClass('first last'); // set first and last\n\n      if (tabItems.length > 0) {\n        tabItems[0].$container.addClass('first');\n\n        if (considerEllipsis) {\n          this.tabArea.ellipsis.$container.addClass('last');\n        } else {\n          tabItems[tabItems.length - 1].$container.addClass('last');\n        }\n      }\n    }\n  }, {\n    key: \"_tabItemSize\",\n    value: function _tabItemSize(htmlComp) {\n      var prefSize,\n          classList = htmlComp.$comp.attr('class'); // temporarly revert display style to default. otherwise the pref size of the tab item will be the size of the container.\n\n      if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n        this.tabArea.$container.removeClass('spread-even');\n      }\n\n      htmlComp.$comp.removeClass('overflown');\n      htmlComp.$comp.removeClass('hidden');\n      prefSize = htmlComp.prefSize({\n        useCssSize: true,\n        exact: true\n      }).add(graphics.margins(htmlComp.$comp));\n      htmlComp.$comp.attrOrRemove('class', classList);\n\n      if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n        this.tabArea.$container.addClass('spread-even');\n      }\n\n      return prefSize;\n    }\n  }, {\n    key: \"_onTabAreaPropertyChange\",\n    value: function _onTabAreaPropertyChange(event) {\n      if (event.propertyName === 'selectedTab') {\n        this._layoutSelectionMarker();\n      }\n    }\n  }]);\n\n  return TabAreaLayout;\n}(AbstractLayout);\n\nexport { TabAreaLayout as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/form/fields/tabbox/TabAreaLayout.js"],"names":["AbstractLayout","Dimension","graphics","HtmlComponent","scout","TabArea","$","TabAreaLayout","tabArea","overflowTabs","visibleTabs","_tabAreaPropertyChangeHandler","_onTabAreaPropertyChange","bind","on","one","off","$container","ellipsis","htmlContainer","get","containerSize","availableSize","subtract","insets","preferredLayoutSize","widthHint","width","length","setHidden","forEach","tabItem","setOverflown","setText","setChildActions","map","tab","menu","create","parent","text","label","visible","event","log","isDebugEnabled","debug","popup","close","select","focus","_layoutSelectionMarker","$selectionMarker","selectedTab","selectedItemBounds","setVisible","bounds","cssLeft","x","cssWidth","options","htmlComp","prefSize","prefWidth","Number","MAX_VALUE","visibleTabItems","tabs","filter","isVisible","overflowableIndexes","index","selected","horizontal","_minSize","add","overflowIndex","_setFirstLastMarker","_prefSize","splice","displayStyle","DisplayStyle","SPREAD_EVEN","exactPrefSize","tabItems","push","considerEllipsis","_tabItemSize","reduce","itemSize","height","Math","max","ellipsisSize","nvl","$comp","removeClass","addClass","classList","attr","useCssSize","exact","margins","attrOrRemove","propertyName"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {AbstractLayout, Dimension, graphics, HtmlComponent, scout, TabArea} from '../../../index';\nimport $ from 'jquery';\n\nexport default class TabAreaLayout extends AbstractLayout {\n\n  constructor(tabArea) {\n    super();\n    this.tabArea = tabArea;\n    this.overflowTabs = [];\n    this.visibleTabs = [];\n    this._tabAreaPropertyChangeHandler = this._onTabAreaPropertyChange.bind(this);\n\n    this.tabArea.on('propertyChange', this._tabAreaPropertyChangeHandler);\n    this.tabArea.one('remove', function() {\n      this.tabArea.off('propertyChange', this._tabAreaPropertyChangeHandler);\n    }.bind(this));\n  }\n\n  layout($container) {\n    var ellipsis = this.tabArea.ellipsis,\n      htmlContainer = HtmlComponent.get($container),\n      containerSize = htmlContainer.availableSize().subtract(htmlContainer.insets());\n\n    // compute visible and overflown tabs\n    this.preferredLayoutSize($container, {\n      widthHint: containerSize.width\n    });\n\n    if (this.overflowTabs.length > 0) {\n      ellipsis.setHidden(false);\n    }\n\n    this.visibleTabs.forEach(function(tabItem) {\n      tabItem.setOverflown(false);\n    });\n\n    this.overflowTabs.forEach(function(tabItem) {\n      tabItem.setOverflown(true);\n    });\n\n    if (this.overflowTabs.length === 0) {\n      ellipsis.setHidden(true);\n    }\n\n    ellipsis.setText(this.overflowTabs.length + '');\n\n    ellipsis.setChildActions(this.overflowTabs.map(function(tab) {\n      var menu = scout.create('Menu', {\n        parent: ellipsis,\n        text: tab.label,\n        tab: tab,\n        visible: tab.visible\n      });\n      menu.on('action', function(event) {\n        $.log.isDebugEnabled() && $.log.debug('(TabAreaLayout#_onClickEllipsis) tabItem=' + tab);\n        // first close popup to ensure the focus is handled in the correct focus context.\n        ellipsis.popup.close();\n        tab.select();\n        tab.focus();\n      });\n      return menu;\n    }, this));\n\n    this._layoutSelectionMarker();\n  }\n\n  _layoutSelectionMarker() {\n    var $selectionMarker = this.tabArea.$selectionMarker,\n      selectedTab = this.tabArea.selectedTab,\n      selectedItemBounds;\n\n    if (selectedTab) {\n      $selectionMarker.setVisible(true);\n      selectedItemBounds = graphics.bounds(selectedTab.$container);\n      $selectionMarker.cssLeft(selectedItemBounds.x);\n      $selectionMarker.cssWidth(selectedItemBounds.width);\n    } else {\n      $selectionMarker.setVisible(false);\n    }\n  }\n\n  preferredLayoutSize($container, options) {\n    var htmlComp = HtmlComponent.get($container),\n      prefSize = new Dimension(0, 0),\n      prefWidth = Number.MAX_VALUE,\n      visibleTabItems = this.tabArea.tabs.filter(function(tabItem) {\n        return tabItem.isVisible();\n      }),\n      overflowableIndexes = visibleTabItems.map(function(tabItem, index) {\n        if (tabItem.selected) {\n          return -1;\n        }\n        return index;\n      }).filter(function(index) {\n        return index >= 0;\n      });\n\n    this.overflowTabs = [];\n\n    // consider avoid falsy 0 in tabboxes a 0 withHint will be used to calculate the minimum width\n    if (options.widthHint === 0 || options.widthHint) {\n      prefWidth = options.widthHint - htmlComp.insets().horizontal();\n    }\n\n    // shortcut for minimum size.\n    if (prefWidth <= 0) {\n      return this._minSize(visibleTabItems).add(htmlComp.insets());\n    }\n\n    var overflowIndex = -1;\n    this._setFirstLastMarker(visibleTabItems);\n    prefSize = this._prefSize(visibleTabItems);\n    while (prefSize.width > prefWidth && overflowableIndexes.length > 0) {\n      overflowIndex = overflowableIndexes.splice(-1)[0];\n      this.overflowTabs.splice(0, 0, visibleTabItems[overflowIndex]);\n      visibleTabItems.splice(overflowIndex, 1);\n      this._setFirstLastMarker(visibleTabItems);\n      prefSize = this._prefSize(visibleTabItems);\n    }\n\n    this.visibleTabs = visibleTabItems;\n\n    // Use the total available space if spreading tabs evenly.\n    if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n      return graphics.prefSize($container, options);\n    }\n\n    return graphics.exactPrefSize(prefSize.add(htmlComp.insets()), options);\n  }\n\n  _minSize(tabItems) {\n    var visibleTabItems = [],\n      prefSize;\n    this.overflowTabs = tabItems.filter(function(tabItem) {\n      if (tabItem.selected) {\n        visibleTabItems.push(tabItem);\n        return false;\n      }\n      return true;\n    }, this);\n\n    this.visibleTabs = visibleTabItems;\n    this._setFirstLastMarker(visibleTabItems);\n    prefSize = this._prefSize(visibleTabItems);\n\n    return prefSize;\n  }\n\n  _prefSize(tabItems, considerEllipsis) {\n    var prefSize = tabItems.map(function(tabItem) {\n        return this._tabItemSize(tabItem.htmlComp);\n      }, this).reduce(function(prefSize, itemSize) {\n        prefSize.height = Math.max(prefSize.height, itemSize.height);\n        prefSize.width += itemSize.width;\n        return prefSize;\n      }, new Dimension(0, 0)),\n      ellipsisSize = new Dimension(0, 0);\n\n    considerEllipsis = scout.nvl(considerEllipsis, this.overflowTabs.length > 0);\n    if (considerEllipsis) {\n      ellipsisSize = this._tabItemSize(this.tabArea.ellipsis.htmlComp);\n      prefSize.height = Math.max(prefSize.height, ellipsisSize.height);\n      prefSize.width += ellipsisSize.width;\n    }\n    return prefSize;\n  }\n\n  _setFirstLastMarker(tabItems, considerEllipsis) {\n    considerEllipsis = scout.nvl(considerEllipsis, this.overflowTabs.length > 0);\n\n    // reset\n    this.tabArea.tabs.forEach(function(tabItem) {\n      tabItem.htmlComp.$comp.removeClass('first last');\n    });\n    this.tabArea.ellipsis.$container.removeClass('first last');\n\n    // set first and last\n    if (tabItems.length > 0) {\n      tabItems[0].$container.addClass('first');\n      if (considerEllipsis) {\n        this.tabArea.ellipsis.$container.addClass('last');\n      } else {\n        tabItems[tabItems.length - 1].$container.addClass('last');\n      }\n    }\n  }\n\n  _tabItemSize(htmlComp) {\n    var prefSize,\n      classList = htmlComp.$comp.attr('class');\n\n    // temporarly revert display style to default. otherwise the pref size of the tab item will be the size of the container.\n    if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n      this.tabArea.$container.removeClass('spread-even');\n    }\n\n    htmlComp.$comp.removeClass('overflown');\n    htmlComp.$comp.removeClass('hidden');\n\n    prefSize = htmlComp.prefSize({\n      useCssSize: true,\n      exact: true\n    }).add(graphics.margins(htmlComp.$comp));\n\n    htmlComp.$comp.attrOrRemove('class', classList);\n\n    if (this.tabArea.displayStyle === TabArea.DisplayStyle.SPREAD_EVEN) {\n      this.tabArea.$container.addClass('spread-even');\n    }\n    return prefSize;\n  }\n\n  _onTabAreaPropertyChange(event) {\n    if (event.propertyName === 'selectedTab') {\n      this._layoutSelectionMarker();\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}