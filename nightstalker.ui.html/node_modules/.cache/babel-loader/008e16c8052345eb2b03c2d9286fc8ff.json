{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, DateFormat, dates, Device, events, graphics, HtmlComponent, objects, scout, Widget } from '../index';\nimport $ from 'jquery';\n\nvar DatePicker = /*#__PURE__*/function (_Widget) {\n  _inherits(DatePicker, _Widget);\n\n  var _super = _createSuper(DatePicker);\n\n  function DatePicker() {\n    var _this;\n\n    _classCallCheck(this, DatePicker);\n\n    _this = _super.call(this); // Preselected date can only be set if selectedDate is null. The preselected date is rendered differently, but\n    // has no function otherwise. (It is used to indicate the day that will be selected when the user presses\n    // the UP or DOWN key while no date is selected.)\n\n    _this.preselectedDate = null;\n    _this.selectedDate = null;\n    _this.dateFormat = null;\n    _this.viewDate = null;\n    _this.allowedDates = null;\n    _this.currentMonth = null;\n    _this.$scrollable = null; // Contains the months to be rendered.\n    // Only the this.currentMonth is visible, the others are needed for the swipe animation.\n    // The month is an object with the properties viewDate, rendered and $container\n\n    _this.months = [];\n    _this.touch = Device.get().supportsOnlyTouch();\n    return _this;\n  }\n\n  _createClass(DatePicker, [{\n    key: \"_init\",\n    value: function _init(options) {\n      _get(_getPrototypeOf(DatePicker.prototype), \"_init\", this).call(this, options);\n\n      this._setDateFormat(this.dateFormat);\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      this.$container = this.$parent.appendDiv('date-picker').toggleClass('touch', this.touch);\n      this.htmlComp = HtmlComponent.install(this.$container, this.session);\n      this._$header = this._append$Header();\n\n      this._$header.find('.date-picker-left-y, .date-picker-left-m, .date-picker-right-m, .date-picker-right-y').mousedown(this._onNavigationMouseDown.bind(this));\n\n      this.$container.appendDiv('date-picker-separator');\n      this.$scrollable = this.$container.appendDiv('date-picker-scrollable');\n\n      this._registerSwipeHandlers();\n    }\n  }, {\n    key: \"_setDateFormat\",\n    value: function _setDateFormat(dateFormat) {\n      if (!dateFormat) {\n        dateFormat = this.session.locale.dateFormatPatternDefault;\n      }\n\n      dateFormat = DateFormat.ensure(this.session.locale, dateFormat);\n\n      this._setProperty('dateFormat', dateFormat);\n    }\n  }, {\n    key: \"prependMonth\",\n    value: function prependMonth(month) {\n      var months = this.months.slice();\n      arrays.insert(months, month, 0);\n      this.setMonths(months);\n    }\n  }, {\n    key: \"appendMonth\",\n    value: function appendMonth(month) {\n      var months = this.months.slice();\n      months.push(month);\n      this.setMonths(months);\n    }\n    /**\n     * Resets the month boxes. Always render 3 months to make swiping more smooth (especially on mobile devices).\n     */\n\n  }, {\n    key: \"resetMonths\",\n    value: function resetMonths(viewDate) {\n      viewDate = viewDate || this.viewDate;\n      var prevDate = dates.shift(viewDate, 0, -1, 0);\n      var nextDate = dates.shift(viewDate, 0, 1, 0);\n      this.setMonths([prevDate, viewDate, nextDate]);\n    }\n  }, {\n    key: \"setMonths\",\n    value: function setMonths(months) {\n      months = arrays.ensure(months);\n      months = months.map(function (month) {\n        var viewDate = month;\n\n        if (!(month instanceof Date)) {\n          viewDate = month.viewDate;\n        } // Use existing month object (so that $container won't be removed, see below)\n\n\n        var existingMonth = this._findMonthByViewDate(viewDate);\n\n        if (existingMonth) {\n          return existingMonth;\n        }\n\n        return {\n          rendered: false,\n          viewDate: viewDate,\n          $container: undefined\n        };\n      }, this); // Remove the obsolete months\n\n      if (this.rendered) {\n        this.months.forEach(function (month) {\n          if (months.indexOf(month) < 0 && month.rendered) {\n            month.$container.remove();\n          }\n        }, this);\n      }\n\n      this.setProperty('months', months);\n    }\n  }, {\n    key: \"_renderMonths\",\n    value: function _renderMonths() {\n      // Render the months if needed\n      this.months.forEach(function (month) {\n        if (!month.rendered) {\n          this._renderMonth(month); // move month to correct position in DOM.\n          // Current month must not be moved, otherwise click event gets lost.\n\n\n          if (this.currentMonth && dates.compare(month.viewDate, this.currentMonth.viewDate) < 0) {\n            month.$container.insertBefore(this.currentMonth.$container);\n          }\n        }\n      }, this); // Adjust size and position of the scrollable\n\n      var scrollableWidth = this.months.length * this._boxWidth;\n      this.$scrollable.width(scrollableWidth);\n\n      if (this.currentMonth) {\n        this.$scrollable.cssLeft(this._scrollableLeftForMonth(this.currentMonth));\n      }\n    }\n  }, {\n    key: \"_findMonthByViewDate\",\n    value: function _findMonthByViewDate(viewDate) {\n      return arrays.find(this.months, function (month) {\n        return dates.compareMonths(month.viewDate, viewDate) === 0;\n      });\n    }\n    /**\n     * @returns {number} the x coordinate of the scrollable if the given month should be displayed\n     */\n\n  }, {\n    key: \"_scrollableLeftForMonth\",\n    value: function _scrollableLeftForMonth(month) {\n      var scrollableInsets = graphics.insets(this.$scrollable);\n      var monthMargins = graphics.margins(month.$container);\n      return -1 * (month.$container.position().left - monthMargins.left - scrollableInsets.left);\n    }\n  }, {\n    key: \"_renderMonth\",\n    value: function _renderMonth(month) {\n      if (month.rendered) {\n        return;\n      }\n\n      var $box = this.$parent.makeDiv('date-picker-month-box');\n\n      this._build$DateBox(month.viewDate).appendTo($box);\n\n      $box.on('DOMMouseScroll mousewheel', this._onMouseWheel.bind(this)).appendTo(this.$scrollable); // Fix the size of the box\n\n      if (!this._boxWidth) {\n        this._boxWidth = $box.width();\n      }\n\n      $box.width(this._boxWidth);\n      month.$container = $box;\n      month.rendered = true;\n    }\n    /**\n     * @internal, use showDate, selectDate, shiftViewDate, etc. to change the view date\n     */\n\n  }, {\n    key: \"setViewDate\",\n    value: function setViewDate(viewDate, animated) {\n      if (objects.equals(this.viewDate, viewDate)) {\n        return;\n      }\n\n      this._setProperty('viewDate', viewDate);\n\n      if (this.rendered) {\n        this._renderViewDate(animated);\n      }\n    }\n  }, {\n    key: \"_renderViewDate\",\n    value: function _renderViewDate(animated) {\n      var month = this._findMonthByViewDate(this.viewDate);\n\n      var newLeft = this._scrollableLeftForMonth(month);\n\n      if (!this.currentMonth) {\n        // The first time a month is rendered, revalidate the layout.\n        // Reason: When the popup opens, the datepicker is not rendered yet, thus the preferred size cannot be determined\n        this.revalidateLayoutTree();\n      }\n\n      this.currentMonth = month;\n\n      this._updateHeader(this.viewDate);\n\n      animated = scout.nvl(animated, true);\n\n      if (!animated) {\n        this.$scrollable.cssLeft(newLeft);\n        this.resetMonths();\n      } else {\n        // Animate\n        // At first: stop existing animation when shifting multiple dates in a row (e.g. with mouse wheel)\n        this.$scrollable.stop(true).animate({\n          left: newLeft\n        }, 300, function () {\n          this.resetMonths();\n        }.bind(this));\n      }\n    }\n  }, {\n    key: \"preselectDate\",\n    value: function preselectDate(date, animated) {\n      this.showDate(date, animated);\n\n      if (date) {\n        // Clear selection when a date is preselected\n        this.setSelectedDate(null);\n      }\n\n      this.setPreselectedDate(date);\n    }\n    /**\n     * @internal, use preselectDate to preselect a date\n     */\n\n  }, {\n    key: \"setPreselectedDate\",\n    value: function setPreselectedDate(preselectedDate) {\n      this.setProperty('preselectedDate', preselectedDate);\n    }\n  }, {\n    key: \"_renderPreselectedDate\",\n    value: function _renderPreselectedDate() {\n      if (!this.currentMonth) {\n        return;\n      }\n\n      var $box = this.currentMonth.$container;\n      $box.find('.date-picker-day').each(function (i, elem) {\n        var $day = $(elem);\n        $day.removeClass('preselected');\n\n        if (dates.isSameDay(this.preselectedDate, $day.data('date'))) {\n          $day.addClass('preselected');\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"selectDate\",\n    value: function selectDate(date, animated) {\n      this.showDate(date, animated);\n\n      if (date) {\n        // Clear preselection when a date is selected\n        this.setPreselectedDate(null);\n      }\n\n      this.setSelectedDate(date);\n    }\n    /**\n     * @internal, use selectDate to select a date\n     */\n\n  }, {\n    key: \"setSelectedDate\",\n    value: function setSelectedDate(selectedDate) {\n      this.setProperty('selectedDate', selectedDate);\n    }\n  }, {\n    key: \"_renderSelectedDate\",\n    value: function _renderSelectedDate() {\n      if (!this.currentMonth) {\n        return;\n      }\n\n      var $box = this.currentMonth.$container;\n      $box.find('.date-picker-day').each(function (i, elem) {\n        var $day = $(elem);\n        $day.removeClass('selected');\n\n        if (dates.isSameDay(this.selectedDate, $day.data('date'))) {\n          $day.addClass('selected');\n        }\n      }.bind(this));\n    }\n    /**\n     * Shows the month which contains the given date.\n     * @param {Date} date\n     * @param {boolean} [animated] - Default is true\n     */\n\n  }, {\n    key: \"showDate\",\n    value: function showDate(viewDate, animated) {\n      var viewDateDiff = 0;\n\n      if (this.viewDate) {\n        viewDateDiff = dates.compareMonths(viewDate, this.viewDate);\n      }\n\n      if (this.currentMonth && viewDateDiff) {\n        if (viewDateDiff < 0) {\n          this.prependMonth(viewDate);\n        } else {\n          this.appendMonth(viewDate);\n        }\n      } else {\n        if (!this.currentMonth) {\n          // Initially (when the popup is opened), don't reset, just display one month.\n          // Reason: _renderMonths may not determine the proper scroll left yet\n          this.setMonths([viewDate]);\n        } else {\n          this.resetMonths(viewDate);\n        }\n      }\n\n      this.setViewDate(viewDate, animated);\n    }\n  }, {\n    key: \"shiftViewDate\",\n    value: function shiftViewDate(years, months, days) {\n      var date = this.viewDate;\n      date = dates.shift(date, years, months, days);\n      this.showDate(date);\n    }\n  }, {\n    key: \"shiftSelectedDate\",\n    value: function shiftSelectedDate(years, months, days) {\n      var date = this.preselectedDate;\n\n      if (this.selectedDate) {\n        if (this.allowedDates) {\n          date = this._findNextAllowedDate(years, months, days);\n        } else {\n          date = dates.shift(this.selectedDate, years, months, days);\n        }\n      }\n\n      if (!date) {\n        return; // do nothing when no date was found\n      }\n\n      this.selectDate(date, true);\n    }\n  }, {\n    key: \"_findNextAllowedDate\",\n    value: function _findNextAllowedDate(years, months, days) {\n      var i,\n          date,\n          sum = years + months + days,\n          dir = sum > 0 ? 1 : -1,\n          now = this.selectedDate || dates.trunc(new Date()); // if we shift by year or month, shift the 'now' date and then use that date as starting point\n      // to find the next allowed date.\n\n      if (years !== 0) {\n        now = dates.shift(now, years, 0, 0);\n      } else if (months !== 0) {\n        now = dates.shift(now, 0, months, 0);\n      }\n\n      if (dir === 1) {\n        // find next allowed date, starting from currently selected date\n        for (i = 0; i < this.allowedDates.length; i++) {\n          date = this.allowedDates[i];\n\n          if (dates.compare(now, date) < 0) {\n            return date;\n          }\n        }\n      } else if (dir === -1) {\n        // find previous allowed date, starting from currently selected date\n        for (i = this.allowedDates.length - 1; i >= 0; i--) {\n          date = this.allowedDates[i];\n\n          if (dates.compare(now, date) > 0) {\n            return date;\n          }\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"_isDateAllowed\",\n    value: function _isDateAllowed(date) {\n      // when allowedDates is empty or not set, any date is allowed\n      if (!this.allowedDates || this.allowedDates.length === 0) {\n        return true;\n      } // when allowedDates is set, only dates contained in this array are allowed\n\n\n      var allowedDateAsTimestamp,\n          dateAsTimestamp = date.getTime();\n      return this.allowedDates.some(function (allowedDate) {\n        allowedDateAsTimestamp = allowedDate.getTime();\n        return allowedDateAsTimestamp === dateAsTimestamp;\n      });\n    }\n  }, {\n    key: \"_build$DateBox\",\n    value: function _build$DateBox(viewDate) {\n      var cl,\n          i,\n          day,\n          dayEnabled,\n          dayInMonth,\n          $day,\n          now = new Date(),\n          start = new Date(viewDate),\n          weekdays = this.dateFormat.symbols.weekdaysShortOrdered;\n      var $box = this.$container.makeDiv('date-picker-month').data('viewDate', viewDate); // Create weekday header\n\n      var $weekdays = $box.appendDiv('date-picker-weekdays');\n      weekdays.forEach(function (weekday) {\n        $weekdays.appendDiv('date-picker-weekday', weekday);\n      }); // Find start date (-1)\n\n      var $week;\n\n      for (var offset = 0; offset < 42; offset++) {\n        start.setDate(start.getDate() - 1);\n        var diff = new Date(start.getYear(), viewDate.getMonth(), 0).getDate() - start.getDate();\n\n        if (start.getDay() === 0 && start.getMonth() !== viewDate.getMonth() && diff > 1) {\n          break;\n        }\n      } // Create days\n\n\n      for (i = 0; i < 42; i++) {\n        if (i % 7 === 0) {\n          $week = $box.appendDiv('date-picker-week');\n        }\n\n        start.setDate(start.getDate() + 1);\n        dayInMonth = start.getDate();\n\n        if (start.getDay() === 6 || start.getDay() === 0) {\n          cl = start.getMonth() !== viewDate.getMonth() ? ' date-picker-out-weekend' : ' date-picker-weekend';\n        } else {\n          cl = start.getMonth() !== viewDate.getMonth() ? ' date-picker-out' : '';\n        }\n\n        if (dates.isSameDay(start, now)) {\n          cl += ' date-picker-now';\n        }\n\n        if (dates.isSameDay(this.selectedDate, start)) {\n          cl += ' selected';\n        }\n\n        if (dates.isSameDay(this.preselectedDate, start)) {\n          cl += ' preselected';\n        } // helps to center days between 10 and 19 nicer (especially when website is zoomed > 100%)\n\n\n        if (dayInMonth > 9 && dayInMonth < 20) {\n          cl += ' ten';\n        }\n\n        dayEnabled = this._isDateAllowed(start);\n\n        if (!dayEnabled) {\n          cl += ' disabled';\n        }\n\n        day = dayInMonth <= 9 ? '0' + dayInMonth : dayInMonth;\n        $day = $week.appendDiv('date-picker-day' + cl).data('dayInMonth', dayInMonth).data('date', new Date(start));\n        $day.appendSpan('text', day);\n\n        if (dayEnabled) {\n          $day.on('click', this._onDayClick.bind(this));\n        }\n      }\n\n      return $box;\n    }\n  }, {\n    key: \"_append$Header\",\n    value: function _append$Header() {\n      var headerHtml = '<div class=\"date-picker-header\">' + '  <div class=\"date-picker-left-y\" data-shift=\"-12\"></div>' + '  <div class=\"date-picker-left-m\" data-shift=\"-1\"></div>' + '  <div class=\"date-picker-right-y\" data-shift=\"12\"></div>' + '  <div class=\"date-picker-right-m\" data-shift=\"1\"></div>' + '  <div class=\"date-picker-header-month\"></div>' + '</div>';\n      return this.$container.appendElement(headerHtml).toggleClass('touch', this.touch);\n    }\n  }, {\n    key: \"_updateHeader\",\n    value: function _updateHeader(viewDate) {\n      this._$header.find('.date-picker-header-month').text(this._createHeaderText(viewDate));\n    }\n  }, {\n    key: \"_createHeaderText\",\n    value: function _createHeaderText(viewDate) {\n      var months = this.dateFormat.symbols.months;\n      return months[viewDate.getMonth()] + ' ' + viewDate.getFullYear();\n    }\n  }, {\n    key: \"_registerSwipeHandlers\",\n    value: function _registerSwipeHandlers() {\n      var $window = this.$scrollable.window();\n      this.$scrollable.on('touchmove', function (event) {\n        // prevent scrolling the background when swiping the date picker (iOS)\n        event.preventDefault();\n      });\n      this.$scrollable.on('remove', function (event) {\n        $window.off('.datepickerDrag');\n      });\n      this.$scrollable.on(events.touchdown(this.touch), function (event) {\n        var origPageX = events.pageX(event);\n        var moveX = 0; // stop pending animations, otherwise the months may be removed by the animation stop handler before touchend is executed\n\n        this.$scrollable.stop(true); // Prepare months. On the first swipe the 3 boxes are already rendered, so nothing happens when setMonths is called.\n        // But on a subsequent swipe (while the pane is still moving) the next month needs to be rendered.\n\n        var prevDate = dates.shift(this.viewDate, 0, -1, 0);\n        var nextDate = dates.shift(this.viewDate, 0, 1, 0);\n        this.setMonths([prevDate, this.viewDate, nextDate]);\n        var scrollableLeft = this.$scrollable.position().left;\n        this.swiped = false;\n        var started = true;\n        $window.on(events.touchmove(this.touch, 'datepickerDrag'), function (event) {\n          var pageX = events.pageX(event);\n          moveX = pageX - origPageX;\n          var newScrollableLeft = scrollableLeft + moveX;\n          var minX = this.$container.width() - this.$scrollable.outerWidth(); // limit the drag range\n\n          newScrollableLeft = Math.max(Math.min(newScrollableLeft, 0), minX); // set the new position\n\n          if (newScrollableLeft !== scrollableLeft) {\n            this.$scrollable.cssLeft(newScrollableLeft);\n          }\n        }.bind(this));\n        $window.on(events.touchendcancel(this.touch, 'datepickerDrag'), function (event) {\n          $window.off('.datepickerDrag');\n\n          if (!started) {\n            // On iOS touchcancel and touchend are fired right after each other when swiping twice very fast -> Ignore the second event\n            return;\n          }\n\n          started = false; // If the movement is less than this value (in px), the swipe won't happen. Instead, the value is selected.\n\n          var minMove = 5;\n          var viewDate = this.viewDate; // Detect in which direction the swipe happened\n\n          if (moveX < -minMove) {\n            // dragged left -> use next month\n            viewDate = nextDate;\n          } else if (moveX > minMove) {\n            // dragged right -> use previous month\n            viewDate = prevDate;\n          }\n\n          if (this.viewDate !== viewDate) {\n            this.swiped = true;\n            this.setViewDate(viewDate);\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  }, {\n    key: \"_onNavigationMouseDown\",\n    value: function _onNavigationMouseDown(event) {\n      var $target = $(event.currentTarget);\n      var diff = $target.data('shift');\n      this.shiftViewDate(0, diff, 0);\n    }\n  }, {\n    key: \"_onDayClick\",\n    value: function _onDayClick(event) {\n      if (this.swiped) {\n        // Don't handle on a swipe action\n        return;\n      }\n\n      var $target = $(event.currentTarget);\n      var date = $target.data('date');\n      this.selectDate(date);\n      this.trigger('dateSelect', {\n        date: date\n      });\n    }\n  }, {\n    key: \"_onMouseWheel\",\n    value: function _onMouseWheel(event) {\n      event = event.originalEvent || this.$container.window(true).event.originalEvent;\n      var wheelData = event.wheelDelta ? event.wheelDelta / 10 : -event.detail * 3;\n      var diff = wheelData >= 0 ? -1 : 1;\n      this.shiftViewDate(0, diff, 0);\n      event.preventDefault();\n    }\n  }]);\n\n  return DatePicker;\n}(Widget);\n\nexport { DatePicker as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/datepicker/DatePicker.js"],"names":["arrays","DateFormat","dates","Device","events","graphics","HtmlComponent","objects","scout","Widget","$","DatePicker","preselectedDate","selectedDate","dateFormat","viewDate","allowedDates","currentMonth","$scrollable","months","touch","get","supportsOnlyTouch","options","_setDateFormat","$container","$parent","appendDiv","toggleClass","htmlComp","install","session","_$header","_append$Header","find","mousedown","_onNavigationMouseDown","bind","_registerSwipeHandlers","locale","dateFormatPatternDefault","ensure","_setProperty","month","slice","insert","setMonths","push","prevDate","shift","nextDate","map","Date","existingMonth","_findMonthByViewDate","rendered","undefined","forEach","indexOf","remove","setProperty","_renderMonth","compare","insertBefore","scrollableWidth","length","_boxWidth","width","cssLeft","_scrollableLeftForMonth","compareMonths","scrollableInsets","insets","monthMargins","margins","position","left","$box","makeDiv","_build$DateBox","appendTo","on","_onMouseWheel","animated","equals","_renderViewDate","newLeft","revalidateLayoutTree","_updateHeader","nvl","resetMonths","stop","animate","date","showDate","setSelectedDate","setPreselectedDate","each","i","elem","$day","removeClass","isSameDay","data","addClass","viewDateDiff","prependMonth","appendMonth","setViewDate","years","days","_findNextAllowedDate","selectDate","sum","dir","now","trunc","allowedDateAsTimestamp","dateAsTimestamp","getTime","some","allowedDate","cl","day","dayEnabled","dayInMonth","start","weekdays","symbols","weekdaysShortOrdered","$weekdays","weekday","$week","offset","setDate","getDate","diff","getYear","getMonth","getDay","_isDateAllowed","appendSpan","_onDayClick","headerHtml","appendElement","text","_createHeaderText","getFullYear","$window","window","event","preventDefault","off","touchdown","origPageX","pageX","moveX","scrollableLeft","swiped","started","touchmove","newScrollableLeft","minX","outerWidth","Math","max","min","touchendcancel","minMove","$target","currentTarget","shiftViewDate","trigger","originalEvent","wheelData","wheelDelta","detail"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, DateFormat, dates, Device, events, graphics, HtmlComponent, objects, scout, Widget} from '../index';\nimport $ from 'jquery';\n\nexport default class DatePicker extends Widget {\n\n  constructor() {\n    super();\n\n    // Preselected date can only be set if selectedDate is null. The preselected date is rendered differently, but\n    // has no function otherwise. (It is used to indicate the day that will be selected when the user presses\n    // the UP or DOWN key while no date is selected.)\n    this.preselectedDate = null;\n    this.selectedDate = null;\n    this.dateFormat = null;\n    this.viewDate = null;\n    this.allowedDates = null;\n    this.currentMonth = null;\n    this.$scrollable = null;\n    // Contains the months to be rendered.\n    // Only the this.currentMonth is visible, the others are needed for the swipe animation.\n    // The month is an object with the properties viewDate, rendered and $container\n    this.months = [];\n    this.touch = Device.get().supportsOnlyTouch();\n  }\n\n  _init(options) {\n    super._init(options);\n    this._setDateFormat(this.dateFormat);\n  }\n\n  _render() {\n    this.$container = this.$parent\n      .appendDiv('date-picker')\n      .toggleClass('touch', this.touch);\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n\n    this._$header = this._append$Header();\n    this._$header\n      .find('.date-picker-left-y, .date-picker-left-m, .date-picker-right-m, .date-picker-right-y')\n      .mousedown(this._onNavigationMouseDown.bind(this));\n\n    this.$container.appendDiv('date-picker-separator');\n    this.$scrollable = this.$container.appendDiv('date-picker-scrollable');\n    this._registerSwipeHandlers();\n  }\n\n  _setDateFormat(dateFormat) {\n    if (!dateFormat) {\n      dateFormat = this.session.locale.dateFormatPatternDefault;\n    }\n    dateFormat = DateFormat.ensure(this.session.locale, dateFormat);\n    this._setProperty('dateFormat', dateFormat);\n  }\n\n  prependMonth(month) {\n    var months = this.months.slice();\n    arrays.insert(months, month, 0);\n    this.setMonths(months);\n  }\n\n  appendMonth(month) {\n    var months = this.months.slice();\n    months.push(month);\n    this.setMonths(months);\n  }\n\n  /**\n   * Resets the month boxes. Always render 3 months to make swiping more smooth (especially on mobile devices).\n   */\n  resetMonths(viewDate) {\n    viewDate = viewDate || this.viewDate;\n    var prevDate = dates.shift(viewDate, 0, -1, 0);\n    var nextDate = dates.shift(viewDate, 0, 1, 0);\n    this.setMonths([prevDate, viewDate, nextDate]);\n  }\n\n  setMonths(months) {\n    months = arrays.ensure(months);\n    months = months.map(function(month) {\n      var viewDate = month;\n      if (!(month instanceof Date)) {\n        viewDate = month.viewDate;\n      }\n      // Use existing month object (so that $container won't be removed, see below)\n      var existingMonth = this._findMonthByViewDate(viewDate);\n      if (existingMonth) {\n        return existingMonth;\n      }\n      return {\n        rendered: false,\n        viewDate: viewDate,\n        $container: undefined\n      };\n    }, this);\n\n    // Remove the obsolete months\n    if (this.rendered) {\n      this.months.forEach(function(month) {\n        if (months.indexOf(month) < 0 && month.rendered) {\n          month.$container.remove();\n        }\n      }, this);\n    }\n    this.setProperty('months', months);\n  }\n\n  _renderMonths() {\n    // Render the months if needed\n    this.months.forEach(function(month) {\n      if (!month.rendered) {\n        this._renderMonth(month);\n\n        // move month to correct position in DOM.\n        // Current month must not be moved, otherwise click event gets lost.\n        if (this.currentMonth && dates.compare(month.viewDate, this.currentMonth.viewDate) < 0) {\n          month.$container.insertBefore(this.currentMonth.$container);\n        }\n      }\n    }, this);\n\n    // Adjust size and position of the scrollable\n    var scrollableWidth = this.months.length * this._boxWidth;\n    this.$scrollable.width(scrollableWidth);\n    if (this.currentMonth) {\n      this.$scrollable.cssLeft(this._scrollableLeftForMonth(this.currentMonth));\n    }\n  }\n\n  _findMonthByViewDate(viewDate) {\n    return arrays.find(this.months, function(month) {\n      return dates.compareMonths(month.viewDate, viewDate) === 0;\n    });\n  }\n\n  /**\n   * @returns {number} the x coordinate of the scrollable if the given month should be displayed\n   */\n  _scrollableLeftForMonth(month) {\n    var scrollableInsets = graphics.insets(this.$scrollable);\n    var monthMargins = graphics.margins(month.$container);\n    return -1 * (month.$container.position().left - monthMargins.left - scrollableInsets.left);\n  }\n\n  _renderMonth(month) {\n    if (month.rendered) {\n      return;\n    }\n\n    var $box = this.$parent.makeDiv('date-picker-month-box');\n    this._build$DateBox(month.viewDate).appendTo($box);\n    $box.on('DOMMouseScroll mousewheel', this._onMouseWheel.bind(this))\n      .appendTo(this.$scrollable);\n\n    // Fix the size of the box\n    if (!this._boxWidth) {\n      this._boxWidth = $box.width();\n    }\n    $box.width(this._boxWidth);\n\n    month.$container = $box;\n    month.rendered = true;\n  }\n\n  /**\n   * @internal, use showDate, selectDate, shiftViewDate, etc. to change the view date\n   */\n  setViewDate(viewDate, animated) {\n    if (objects.equals(this.viewDate, viewDate)) {\n      return;\n    }\n    this._setProperty('viewDate', viewDate);\n    if (this.rendered) {\n      this._renderViewDate(animated);\n    }\n  }\n\n  _renderViewDate(animated) {\n    var month = this._findMonthByViewDate(this.viewDate);\n    var newLeft = this._scrollableLeftForMonth(month);\n    if (!this.currentMonth) {\n      // The first time a month is rendered, revalidate the layout.\n      // Reason: When the popup opens, the datepicker is not rendered yet, thus the preferred size cannot be determined\n      this.revalidateLayoutTree();\n    }\n    this.currentMonth = month;\n    this._updateHeader(this.viewDate);\n\n    animated = scout.nvl(animated, true);\n    if (!animated) {\n      this.$scrollable.cssLeft(newLeft);\n      this.resetMonths();\n    } else {\n      // Animate\n      // At first: stop existing animation when shifting multiple dates in a row (e.g. with mouse wheel)\n      this.$scrollable\n        .stop(true)\n        .animate({\n          left: newLeft\n        }, 300, function() {\n          this.resetMonths();\n        }.bind(this));\n    }\n  }\n\n  preselectDate(date, animated) {\n    this.showDate(date, animated);\n    if (date) {\n      // Clear selection when a date is preselected\n      this.setSelectedDate(null);\n    }\n    this.setPreselectedDate(date);\n  }\n\n  /**\n   * @internal, use preselectDate to preselect a date\n   */\n  setPreselectedDate(preselectedDate) {\n    this.setProperty('preselectedDate', preselectedDate);\n  }\n\n  _renderPreselectedDate() {\n    if (!this.currentMonth) {\n      return;\n    }\n    var $box = this.currentMonth.$container;\n    $box.find('.date-picker-day').each(function(i, elem) {\n      var $day = $(elem);\n      $day.removeClass('preselected');\n      if (dates.isSameDay(this.preselectedDate, $day.data('date'))) {\n        $day.addClass('preselected');\n      }\n    }.bind(this));\n  }\n\n  selectDate(date, animated) {\n    this.showDate(date, animated);\n    if (date) {\n      // Clear preselection when a date is selected\n      this.setPreselectedDate(null);\n    }\n    this.setSelectedDate(date);\n  }\n\n  /**\n   * @internal, use selectDate to select a date\n   */\n  setSelectedDate(selectedDate) {\n    this.setProperty('selectedDate', selectedDate);\n  }\n\n  _renderSelectedDate() {\n    if (!this.currentMonth) {\n      return;\n    }\n    var $box = this.currentMonth.$container;\n    $box.find('.date-picker-day').each(function(i, elem) {\n      var $day = $(elem);\n      $day.removeClass('selected');\n      if (dates.isSameDay(this.selectedDate, $day.data('date'))) {\n        $day.addClass('selected');\n      }\n    }.bind(this));\n  }\n\n  /**\n   * Shows the month which contains the given date.\n   * @param {Date} date\n   * @param {boolean} [animated] - Default is true\n   */\n  showDate(viewDate, animated) {\n    var viewDateDiff = 0;\n    if (this.viewDate) {\n      viewDateDiff = dates.compareMonths(viewDate, this.viewDate);\n    }\n\n    if (this.currentMonth && viewDateDiff) {\n      if (viewDateDiff < 0) {\n        this.prependMonth(viewDate);\n      } else {\n        this.appendMonth(viewDate);\n      }\n    } else {\n      if (!this.currentMonth) {\n        // Initially (when the popup is opened), don't reset, just display one month.\n        // Reason: _renderMonths may not determine the proper scroll left yet\n        this.setMonths([viewDate]);\n      } else {\n        this.resetMonths(viewDate);\n      }\n    }\n    this.setViewDate(viewDate, animated);\n  }\n\n  shiftViewDate(years, months, days) {\n    var date = this.viewDate;\n    date = dates.shift(date, years, months, days);\n    this.showDate(date);\n  }\n\n  shiftSelectedDate(years, months, days) {\n    var date = this.preselectedDate;\n\n    if (this.selectedDate) {\n      if (this.allowedDates) {\n        date = this._findNextAllowedDate(years, months, days);\n      } else {\n        date = dates.shift(this.selectedDate, years, months, days);\n      }\n    }\n\n    if (!date) {\n      return; // do nothing when no date was found\n    }\n\n    this.selectDate(date, true);\n  }\n\n  _findNextAllowedDate(years, months, days) {\n    var i, date,\n      sum = years + months + days,\n      dir = sum > 0 ? 1 : -1,\n      now = this.selectedDate || dates.trunc(new Date());\n\n    // if we shift by year or month, shift the 'now' date and then use that date as starting point\n    // to find the next allowed date.\n    if (years !== 0) {\n      now = dates.shift(now, years, 0, 0);\n    } else if (months !== 0) {\n      now = dates.shift(now, 0, months, 0);\n    }\n\n    if (dir === 1) { // find next allowed date, starting from currently selected date\n      for (i = 0; i < this.allowedDates.length; i++) {\n        date = this.allowedDates[i];\n        if (dates.compare(now, date) < 0) {\n          return date;\n        }\n      }\n    } else if (dir === -1) { // find previous allowed date, starting from currently selected date\n      for (i = this.allowedDates.length - 1; i >= 0; i--) {\n        date = this.allowedDates[i];\n        if (dates.compare(now, date) > 0) {\n          return date;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  _isDateAllowed(date) {\n    // when allowedDates is empty or not set, any date is allowed\n    if (!this.allowedDates || this.allowedDates.length === 0) {\n      return true;\n    }\n    // when allowedDates is set, only dates contained in this array are allowed\n    var allowedDateAsTimestamp,\n      dateAsTimestamp = date.getTime();\n    return this.allowedDates.some(function(allowedDate) {\n      allowedDateAsTimestamp = allowedDate.getTime();\n      return allowedDateAsTimestamp === dateAsTimestamp;\n    });\n  }\n\n  _build$DateBox(viewDate) {\n    var cl, i, day, dayEnabled, dayInMonth, $day,\n      now = new Date(),\n      start = new Date(viewDate),\n      weekdays = this.dateFormat.symbols.weekdaysShortOrdered;\n\n    var $box = this.$container\n      .makeDiv('date-picker-month')\n      .data('viewDate', viewDate);\n\n    // Create weekday header\n    var $weekdays = $box.appendDiv('date-picker-weekdays');\n    weekdays.forEach(function(weekday) {\n      $weekdays.appendDiv('date-picker-weekday', weekday);\n    });\n\n    // Find start date (-1)\n    var $week;\n    for (var offset = 0; offset < 42; offset++) {\n      start.setDate(start.getDate() - 1);\n      var diff = new Date(start.getYear(), viewDate.getMonth(), 0).getDate() - start.getDate();\n      if ((start.getDay() === 0) && (start.getMonth() !== viewDate.getMonth()) && (diff > 1)) {\n        break;\n      }\n    }\n\n    // Create days\n    for (i = 0; i < 42; i++) {\n      if (i % 7 === 0) {\n        $week = $box.appendDiv('date-picker-week');\n      }\n\n      start.setDate(start.getDate() + 1);\n      dayInMonth = start.getDate();\n\n      if ((start.getDay() === 6) || (start.getDay() === 0)) {\n        cl = (start.getMonth() !== viewDate.getMonth() ? ' date-picker-out-weekend' : ' date-picker-weekend');\n      } else {\n        cl = (start.getMonth() !== viewDate.getMonth() ? ' date-picker-out' : '');\n      }\n\n      if (dates.isSameDay(start, now)) {\n        cl += ' date-picker-now';\n      }\n\n      if (dates.isSameDay(this.selectedDate, start)) {\n        cl += ' selected';\n      }\n\n      if (dates.isSameDay(this.preselectedDate, start)) {\n        cl += ' preselected';\n      }\n\n      // helps to center days between 10 and 19 nicer (especially when website is zoomed > 100%)\n      if (dayInMonth > 9 && dayInMonth < 20) {\n        cl += ' ten';\n      }\n\n      dayEnabled = this._isDateAllowed(start);\n      if (!dayEnabled) {\n        cl += ' disabled';\n      }\n\n      day = (dayInMonth <= 9 ? '0' + dayInMonth : dayInMonth);\n      $day = $week\n        .appendDiv('date-picker-day' + cl)\n        .data('dayInMonth', dayInMonth)\n        .data('date', new Date(start));\n      $day.appendSpan('text', day);\n\n      if (dayEnabled) {\n        $day.on('click', this._onDayClick.bind(this));\n      }\n    }\n\n    return $box;\n  }\n\n  _append$Header() {\n    var headerHtml =\n      '<div class=\"date-picker-header\">' +\n      '  <div class=\"date-picker-left-y\" data-shift=\"-12\"></div>' +\n      '  <div class=\"date-picker-left-m\" data-shift=\"-1\"></div>' +\n      '  <div class=\"date-picker-right-y\" data-shift=\"12\"></div>' +\n      '  <div class=\"date-picker-right-m\" data-shift=\"1\"></div>' +\n      '  <div class=\"date-picker-header-month\"></div>' +\n      '</div>';\n    return this.$container\n      .appendElement(headerHtml)\n      .toggleClass('touch', this.touch);\n  }\n\n  _updateHeader(viewDate) {\n    this._$header.find('.date-picker-header-month').text(this._createHeaderText(viewDate));\n  }\n\n  _createHeaderText(viewDate) {\n    var months = this.dateFormat.symbols.months;\n    return months[viewDate.getMonth()] + ' ' + viewDate.getFullYear();\n  }\n\n  _registerSwipeHandlers() {\n    var $window = this.$scrollable.window();\n\n    this.$scrollable.on('touchmove', function(event) {\n      // prevent scrolling the background when swiping the date picker (iOS)\n      event.preventDefault();\n    });\n\n    this.$scrollable.on('remove', function(event) {\n      $window.off('.datepickerDrag');\n    });\n\n    this.$scrollable.on(events.touchdown(this.touch), function(event) {\n      var origPageX = events.pageX(event);\n      var moveX = 0;\n\n      // stop pending animations, otherwise the months may be removed by the animation stop handler before touchend is executed\n      this.$scrollable.stop(true);\n\n      // Prepare months. On the first swipe the 3 boxes are already rendered, so nothing happens when setMonths is called.\n      // But on a subsequent swipe (while the pane is still moving) the next month needs to be rendered.\n      var prevDate = dates.shift(this.viewDate, 0, -1, 0);\n      var nextDate = dates.shift(this.viewDate, 0, 1, 0);\n      this.setMonths([prevDate, this.viewDate, nextDate]);\n      var scrollableLeft = this.$scrollable.position().left;\n\n      this.swiped = false;\n      var started = true;\n\n      $window.on(events.touchmove(this.touch, 'datepickerDrag'), function(event) {\n        var pageX = events.pageX(event);\n        moveX = pageX - origPageX;\n        var newScrollableLeft = scrollableLeft + moveX;\n        var minX = this.$container.width() - this.$scrollable.outerWidth();\n\n        // limit the drag range\n        newScrollableLeft = Math.max(Math.min(newScrollableLeft, 0), minX);\n\n        // set the new position\n        if (newScrollableLeft !== scrollableLeft) {\n          this.$scrollable.cssLeft(newScrollableLeft);\n        }\n      }.bind(this));\n\n      $window.on(events.touchendcancel(this.touch, 'datepickerDrag'), function(event) {\n        $window.off('.datepickerDrag');\n        if (!started) {\n          // On iOS touchcancel and touchend are fired right after each other when swiping twice very fast -> Ignore the second event\n          return;\n        }\n        started = false;\n\n        // If the movement is less than this value (in px), the swipe won't happen. Instead, the value is selected.\n        var minMove = 5;\n        var viewDate = this.viewDate;\n\n        // Detect in which direction the swipe happened\n        if (moveX < -minMove) {\n          // dragged left -> use next month\n          viewDate = nextDate;\n        } else if (moveX > minMove) {\n          // dragged right -> use previous month\n          viewDate = prevDate;\n        }\n\n        if (this.viewDate !== viewDate) {\n          this.swiped = true;\n          this.setViewDate(viewDate);\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n\n  _onNavigationMouseDown(event) {\n    var $target = $(event.currentTarget);\n    var diff = $target.data('shift');\n    this.shiftViewDate(0, diff, 0);\n  }\n\n  _onDayClick(event) {\n    if (this.swiped) {\n      // Don't handle on a swipe action\n      return;\n    }\n    var $target = $(event.currentTarget);\n    var date = $target.data('date');\n    this.selectDate(date);\n    this.trigger('dateSelect', {\n      date: date\n    });\n  }\n\n  _onMouseWheel(event) {\n    event = event.originalEvent || this.$container.window(true).event.originalEvent;\n    var wheelData = event.wheelDelta ? event.wheelDelta / 10 : -event.detail * 3;\n    var diff = (wheelData >= 0 ? -1 : 1);\n    this.shiftViewDate(0, diff, 0);\n    event.preventDefault();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}