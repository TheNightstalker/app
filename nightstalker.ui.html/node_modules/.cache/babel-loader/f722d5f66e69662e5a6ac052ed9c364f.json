{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { AbstractLayout, Dimension, HtmlComponent, Rectangle, webstorage } from '../../index';\nimport $ from 'jquery';\n\nvar FlexboxLayout = /*#__PURE__*/function (_AbstractLayout) {\n  _inherits(FlexboxLayout, _AbstractLayout);\n\n  var _super = _createSuper(FlexboxLayout);\n\n  function FlexboxLayout(direction, cacheKey) {\n    var _this;\n\n    _classCallCheck(this, FlexboxLayout);\n\n    _this = _super.call(this);\n    _this.childrenLayoutDatas = [];\n    _this.cacheKey = null;\n\n    _this.setCacheKey(cacheKey);\n\n    if (direction === FlexboxLayout.Direction.ROW) {\n      _this.preferredLayoutSize = _this.preferredLayoutSizeRow;\n      _this._getDimensionValue = _this._getWidth;\n      _this._layoutFromLayoutData = _this._layoutFromLayoutDataRow;\n    } else {\n      _this.preferredLayoutSize = _this.preferredLayoutSizeColumn;\n      _this._getDimensionValue = _this._getHeight;\n      _this._layoutFromLayoutData = _this._layoutFromLayoutDataColumn;\n    }\n\n    return _this;\n  } // constants\n\n\n  _createClass(FlexboxLayout, [{\n    key: \"setCacheKey\",\n    value: function setCacheKey(cacheKey) {\n      this.cacheKey = cacheKey;\n\n      if (this.cacheKey && this.cacheKey.length > 0) {\n        this.cacheKey.unshift('scout.flexboxLayout');\n      }\n    }\n  }, {\n    key: \"_readCache\",\n    value: function _readCache(childCount) {\n      if (!this.cacheKey || this.cacheKey.length === 0 || childCount < 2) {\n        return;\n      }\n\n      var keySequence = this.cacheKey.slice(),\n          cacheValue = webstorage.getItem(localStorage, keySequence[0]),\n          i = 1,\n          cacheObj;\n      keySequence.push('' + childCount);\n\n      if (cacheValue) {\n        cacheObj = JSON.parse(cacheValue);\n      }\n\n      while (cacheObj && i < keySequence.length) {\n        cacheObj = cacheObj[keySequence[i]];\n        i++;\n      }\n\n      return cacheObj;\n    }\n  }, {\n    key: \"_writeCache\",\n    value: function _writeCache(childCount, sizes) {\n      if (!this.cacheKey || this.cacheKey.length === 0 || childCount < 2) {\n        return;\n      }\n\n      var keySequence = this.cacheKey.slice(),\n          cacheValue = webstorage.getItem(localStorage, keySequence[0]),\n          i = 1,\n          cacheObj,\n          cachedSizes;\n      keySequence.push('' + childCount);\n\n      if (cacheValue) {\n        cacheObj = JSON.parse(cacheValue);\n      } else {\n        cacheObj = {};\n      }\n\n      cachedSizes = cacheObj;\n\n      while (i < keySequence.length - 1) {\n        if (!cachedSizes[keySequence[i]]) {\n          cachedSizes[keySequence[i]] = {};\n        }\n\n        cachedSizes = cachedSizes[keySequence[i]];\n        i++;\n      }\n\n      cachedSizes[keySequence[i]] = sizes;\n      webstorage.setItem(localStorage, keySequence[0], JSON.stringify(cacheObj));\n    }\n  }, {\n    key: \"_computeCacheKey\",\n    value: function _computeCacheKey(childCount) {\n      // no need to cache bounds of a single child\n      if (!this.cacheKey || childCount < 2) {\n        return;\n      }\n\n      return this.cacheKey + '-' + childCount;\n    } // layout functions\n\n  }, {\n    key: \"layout\",\n    value: function layout($container) {\n      var children = this._getChildren($container),\n          htmlContainer = HtmlComponent.get($container),\n          containerSize = htmlContainer.availableSize({\n        exact: true\n      }),\n          splitterWithDelta;\n\n      containerSize = containerSize.subtract(htmlContainer.insets());\n      splitterWithDelta = children.filter(function (c) {\n        return c.layoutData.diff;\n      })[0];\n\n      if (splitterWithDelta) {\n        this._layoutDelta(children, splitterWithDelta, containerSize);\n      } else {\n        this._layoutComponents(children, containerSize);\n      }\n    }\n  }, {\n    key: \"_getChildren\",\n    value: function _getChildren($container) {\n      var children = [];\n      $container.children().each(function () {\n        var htmlChild = HtmlComponent.optGet($(this));\n\n        if (htmlChild) {\n          children.push(htmlChild);\n        }\n      });\n      children = children.sort(function (a, b) {\n        return (a.layoutData.order || 0) - (b.layoutData.order || 0);\n      });\n      return children;\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.childrenLayoutDatas.forEach(function (ld) {\n        ld.sizePx = 0;\n        ld.initialPx = 0;\n        ld.diff = null;\n      });\n      this.childrenLayoutDatas = [];\n    }\n  }, {\n    key: \"_layoutDelta\",\n    value: function _layoutDelta(children, deltaComp, containerSize) {\n      this.ensureInitialValues(children, containerSize);\n      var delta = deltaComp.layoutData.diff,\n          componentsBefore = children.slice(0, children.indexOf(deltaComp)).reverse(),\n          componentsAfter = children.slice(children.indexOf(deltaComp) + 1),\n          deltaDiffPrev,\n          deltaDiffNext; // calculate if the delta can be applied to the previous and following columns\n\n      deltaDiffPrev = _distributeDelta(componentsBefore, delta, false);\n      deltaDiffNext = -_distributeDelta(componentsAfter, -delta, false); // compute the max delta could be applied\n\n      delta = Math.sign(delta) * Math.min(Math.abs(delta - deltaDiffPrev), Math.abs(delta - deltaDiffNext));\n\n      if (delta !== 0) {\n        // apply the delta to the previous and following columns\n        _distributeDelta(componentsBefore, delta, true);\n\n        _distributeDelta(componentsAfter, -delta, true);\n      }\n\n      this._layoutFromLayoutDataWithCache(children, containerSize);\n      /* private functions */\n\n\n      function _distributeDelta(components, delta, applyDelta) {\n        return components.reduce(function (diff, c) {\n          if (diff !== 0) {\n            diff = c.layoutData.acceptDelta(diff, applyDelta);\n          }\n\n          return diff;\n        }, delta);\n      }\n    }\n  }, {\n    key: \"_layoutComponents\",\n    value: function _layoutComponents(children, containerSize) {\n      var delta = this.ensureInitialValues(children, containerSize);\n\n      if (delta < 0) {\n        this._adjust(children, delta, function (ld) {\n          return ld.shrink;\n        });\n      } else if (delta > 0) {\n        this._adjust(children, delta, function (ld) {\n          return ld.grow;\n        });\n      }\n\n      this._layoutFromLayoutDataWithCache(children, containerSize);\n    }\n  }, {\n    key: \"_adjust\",\n    value: function _adjust(children, delta, getWeightFunction) {\n      var weightSum,\n          deltaFactor,\n          layoutDatas = children.map(function (c) {\n        return c.layoutData;\n      }).filter(function (ld) {\n        // resizable\n        return ld.acceptDelta(Math.sign(delta)) === 0;\n      });\n\n      if (layoutDatas.length < 1) {\n        return;\n      }\n\n      weightSum = layoutDatas.reduce(function (sum, ld) {\n        return sum + getWeightFunction(ld);\n      }, 0); // delta factor\n\n      deltaFactor = delta / weightSum;\n      delta = layoutDatas.reduce(function (delta, ld) {\n        return ld.acceptDelta(deltaFactor * getWeightFunction(ld), true);\n      }, delta);\n\n      if (Math.abs(delta) > 0.2) {\n        this._adjust(children, delta, getWeightFunction);\n      }\n    }\n  }, {\n    key: \"_getPreferredSize\",\n    value: function _getPreferredSize(htmlComp) {\n      var prefSize;\n      prefSize = htmlComp.prefSize({\n        useCssSize: true\n      }).add(htmlComp.margins());\n      return prefSize;\n    }\n  }, {\n    key: \"ensureInitialValues\",\n    value: function ensureInitialValues(children, containerSize) {\n      var totalPx = this._getDimensionValue(containerSize),\n          sumOfAbsolutePx = 0,\n          sumOfRelatives = 0,\n          colLayoutDatas = children.map(function (c) {\n        return c.layoutData;\n      }),\n          cachedSizes = this._readCache(children.length) || []; // setup initial values\n\n\n      children.forEach(function (comp, i) {\n        var ld = comp.layoutData;\n\n        if (ld.sizePx) {\n          sumOfAbsolutePx += ld.sizePx;\n        } else if (ld.initial < 0) {\n          // use ui height\n          ld.initialPx = this._getDimensionValue(this._getPreferredSize(comp));\n          sumOfAbsolutePx += ld.initialPx;\n        } else if (ld.relative) {\n          sumOfRelatives += ld.initial;\n        } else {\n          ld.initialPx = ld.initial;\n          sumOfAbsolutePx += ld.initialPx;\n        }\n      }.bind(this));\n      var relativeFactor = (totalPx - sumOfAbsolutePx) / sumOfRelatives;\n      colLayoutDatas.filter(function (ld) {\n        return ld.relative && ld.initial > -1 && !ld.sizePx;\n      }).reduce(function (restWidth, ld) {\n        ld.initialPx = Math.max(30, relativeFactor * ld.initial);\n        return restWidth - ld.initialPx;\n      }, totalPx - sumOfAbsolutePx); // set px values\n\n      return colLayoutDatas.reduce(function (restWidth, ld, i) {\n        if (!ld.sizePx) {\n          if (cachedSizes[i]) {\n            ld.sizePx = ld.validate(Math.round(totalPx * cachedSizes[i]));\n          } else {\n            ld.sizePx = ld.initialPx;\n          }\n        }\n\n        this.childrenLayoutDatas.push(ld);\n        return restWidth - ld.sizePx;\n      }.bind(this), totalPx);\n    }\n  }, {\n    key: \"_layoutFromLayoutDataWithCache\",\n    value: function _layoutFromLayoutDataWithCache(children, containerSize) {\n      this._cacheSizes(children, containerSize);\n\n      this._layoutFromLayoutData(children, containerSize);\n    }\n  }, {\n    key: \"_cacheSizes\",\n    value: function _cacheSizes(children, containerSize) {\n      var totalPx = this._getDimensionValue(containerSize),\n          value;\n\n      value = children.map(function (c) {\n        return c.layoutData.sizePx / totalPx;\n      });\n\n      this._writeCache(children.length, value);\n    } // functions differ from row to column mode\n\n  }, {\n    key: \"preferredLayoutSizeColumn\",\n    value: function preferredLayoutSizeColumn($container, options) {\n      return this._getChildren($container).reduce(function (size, c) {\n        var prefSize = this._getPreferredSize(c);\n\n        size.width = Math.max(prefSize.width, size.width);\n        size.height += prefSize.height;\n        return size;\n      }.bind(this), new Dimension(0, 0));\n    }\n  }, {\n    key: \"preferredLayoutSizeRow\",\n    value: function preferredLayoutSizeRow($container, options) {\n      return this._getChildren($container).reduce(function (size, c) {\n        var prefSize = this._getPreferredSize(c);\n\n        size.height = Math.max(prefSize.height, size.height);\n        size.width += prefSize.width;\n        return size;\n      }.bind(this), new Dimension(0, 0));\n    }\n  }, {\n    key: \"_getWidth\",\n    value: function _getWidth(dimension) {\n      return dimension.width;\n    }\n  }, {\n    key: \"_getHeight\",\n    value: function _getHeight(dimension) {\n      return dimension.height;\n    }\n  }, {\n    key: \"_layoutFromLayoutDataRow\",\n    value: function _layoutFromLayoutDataRow(children, containerSize) {\n      children.reduce(function (x, comp) {\n        var margins = comp.margins();\n        var insets = comp.insets();\n        var w = comp.layoutData.sizePx;\n        var bounds = new Rectangle(x - insets.left - margins.left, 0, w + insets.left + insets.right, containerSize.height);\n        comp.setBounds(bounds);\n        return x + w;\n      }, 0);\n    }\n  }, {\n    key: \"_layoutFromLayoutDataColumn\",\n    value: function _layoutFromLayoutDataColumn(children, containerSize) {\n      children.reduce(function (y, comp) {\n        var margins = comp.margins();\n        var insets = comp.insets();\n        var h = comp.layoutData.sizePx;\n        var bounds = new Rectangle(0, y - insets.top - margins.top, containerSize.width, h + insets.top + insets.bottom);\n        comp.setBounds(bounds);\n        return y + h;\n      }, 0);\n    }\n  }]);\n\n  return FlexboxLayout;\n}(AbstractLayout);\n\n_defineProperty(FlexboxLayout, \"Direction\", {\n  COLUMN: 0,\n  ROW: 1\n});\n\nexport { FlexboxLayout as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/layout/flexbox/FlexboxLayout.js"],"names":["AbstractLayout","Dimension","HtmlComponent","Rectangle","webstorage","$","FlexboxLayout","direction","cacheKey","childrenLayoutDatas","setCacheKey","Direction","ROW","preferredLayoutSize","preferredLayoutSizeRow","_getDimensionValue","_getWidth","_layoutFromLayoutData","_layoutFromLayoutDataRow","preferredLayoutSizeColumn","_getHeight","_layoutFromLayoutDataColumn","length","unshift","childCount","keySequence","slice","cacheValue","getItem","localStorage","i","cacheObj","push","JSON","parse","sizes","cachedSizes","setItem","stringify","$container","children","_getChildren","htmlContainer","get","containerSize","availableSize","exact","splitterWithDelta","subtract","insets","filter","c","layoutData","diff","_layoutDelta","_layoutComponents","each","htmlChild","optGet","sort","a","b","order","forEach","ld","sizePx","initialPx","deltaComp","ensureInitialValues","delta","componentsBefore","indexOf","reverse","componentsAfter","deltaDiffPrev","deltaDiffNext","_distributeDelta","Math","sign","min","abs","_layoutFromLayoutDataWithCache","components","applyDelta","reduce","acceptDelta","_adjust","shrink","grow","getWeightFunction","weightSum","deltaFactor","layoutDatas","map","sum","htmlComp","prefSize","useCssSize","add","margins","totalPx","sumOfAbsolutePx","sumOfRelatives","colLayoutDatas","_readCache","comp","initial","_getPreferredSize","relative","bind","relativeFactor","restWidth","max","validate","round","_cacheSizes","value","_writeCache","options","size","width","height","dimension","x","w","bounds","left","right","setBounds","y","h","top","bottom","COLUMN"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {AbstractLayout, Dimension, HtmlComponent, Rectangle, webstorage} from '../../index';\nimport $ from 'jquery';\n\nexport default class FlexboxLayout extends AbstractLayout {\n\n  constructor(direction, cacheKey) {\n    super();\n    this.childrenLayoutDatas = [];\n    this.cacheKey = null;\n    this.setCacheKey(cacheKey);\n    if (direction === FlexboxLayout.Direction.ROW) {\n      this.preferredLayoutSize = this.preferredLayoutSizeRow;\n      this._getDimensionValue = this._getWidth;\n      this._layoutFromLayoutData = this._layoutFromLayoutDataRow;\n    } else {\n      this.preferredLayoutSize = this.preferredLayoutSizeColumn;\n      this._getDimensionValue = this._getHeight;\n      this._layoutFromLayoutData = this._layoutFromLayoutDataColumn;\n    }\n  }\n\n  // constants\n  static Direction = {\n    COLUMN: 0,\n    ROW: 1\n  };\n\n  setCacheKey(cacheKey) {\n    this.cacheKey = cacheKey;\n    if (this.cacheKey && this.cacheKey.length > 0) {\n      this.cacheKey.unshift('scout.flexboxLayout');\n    }\n  }\n\n  _readCache(childCount) {\n    if (!this.cacheKey || this.cacheKey.length === 0 || childCount < 2) {\n      return;\n    }\n    var keySequence = this.cacheKey.slice(),\n      cacheValue = webstorage.getItem(localStorage, keySequence[0]),\n      i = 1,\n      cacheObj;\n    keySequence.push('' + childCount);\n    if (cacheValue) {\n      cacheObj = JSON.parse(cacheValue);\n    }\n    while (cacheObj && i < keySequence.length) {\n      cacheObj = cacheObj[keySequence[i]];\n      i++;\n    }\n    return cacheObj;\n  }\n\n  _writeCache(childCount, sizes) {\n    if (!this.cacheKey || this.cacheKey.length === 0 || childCount < 2) {\n      return;\n    }\n    var keySequence = this.cacheKey.slice(),\n      cacheValue = webstorage.getItem(localStorage, keySequence[0]),\n      i = 1,\n      cacheObj,\n      cachedSizes;\n    keySequence.push('' + childCount);\n    if (cacheValue) {\n      cacheObj = JSON.parse(cacheValue);\n    } else {\n      cacheObj = {};\n    }\n    cachedSizes = cacheObj;\n    while (i < keySequence.length - 1) {\n      if (!cachedSizes[keySequence[i]]) {\n        cachedSizes[keySequence[i]] = {};\n      }\n      cachedSizes = cachedSizes[keySequence[i]];\n      i++;\n    }\n    cachedSizes[keySequence[i]] = sizes;\n    webstorage.setItem(localStorage, keySequence[0], JSON.stringify(cacheObj));\n  }\n\n  _computeCacheKey(childCount) {\n    // no need to cache bounds of a single child\n    if (!this.cacheKey || childCount < 2) {\n      return;\n    }\n    return this.cacheKey + '-' + childCount;\n  }\n\n  // layout functions\n  layout($container) {\n    var children = this._getChildren($container),\n      htmlContainer = HtmlComponent.get($container),\n      containerSize = htmlContainer.availableSize({\n        exact: true\n      }),\n      splitterWithDelta;\n\n    containerSize = containerSize.subtract(htmlContainer.insets());\n\n    splitterWithDelta = children.filter(function(c) {\n      return c.layoutData.diff;\n    })[0];\n\n    if (splitterWithDelta) {\n      this._layoutDelta(children, splitterWithDelta, containerSize);\n    } else {\n      this._layoutComponents(children, containerSize);\n    }\n  }\n\n  _getChildren($container) {\n    var children = [];\n    $container.children().each(function() {\n      var htmlChild = HtmlComponent.optGet($(this));\n      if (htmlChild) {\n        children.push(htmlChild);\n      }\n    });\n    children = children.sort(function(a, b) {\n      return (a.layoutData.order || 0) - (b.layoutData.order || 0);\n    });\n    return children;\n  }\n\n  reset() {\n    this.childrenLayoutDatas.forEach(function(ld) {\n      ld.sizePx = 0;\n      ld.initialPx = 0;\n      ld.diff = null;\n    });\n    this.childrenLayoutDatas = [];\n  }\n\n  _layoutDelta(children, deltaComp, containerSize) {\n    this.ensureInitialValues(children, containerSize);\n    var delta = deltaComp.layoutData.diff,\n      componentsBefore = children.slice(0, children.indexOf(deltaComp)).reverse(),\n      componentsAfter = children.slice(children.indexOf(deltaComp) + 1),\n      deltaDiffPrev,\n      deltaDiffNext;\n\n    // calculate if the delta can be applied to the previous and following columns\n    deltaDiffPrev = _distributeDelta(componentsBefore, delta, false);\n    deltaDiffNext = -_distributeDelta(componentsAfter, -delta, false);\n    // compute the max delta could be applied\n\n    delta = Math.sign(delta) * (Math.min(Math.abs(delta - deltaDiffPrev), Math.abs(delta - deltaDiffNext)));\n\n    if (delta !== 0) {\n      // apply the delta to the previous and following columns\n      _distributeDelta(componentsBefore, delta, true);\n      _distributeDelta(componentsAfter, -delta, true);\n    }\n\n    this._layoutFromLayoutDataWithCache(children, containerSize);\n\n    /* private functions */\n    function _distributeDelta(components, delta, applyDelta) {\n      return components.reduce(function(diff, c) {\n        if (diff !== 0) {\n          diff = c.layoutData.acceptDelta(diff, applyDelta);\n        }\n        return diff;\n      }, delta);\n    }\n  }\n\n  _layoutComponents(children, containerSize) {\n    var delta = this.ensureInitialValues(children, containerSize);\n    if (delta < 0) {\n      this._adjust(children, delta, function(ld) {\n        return ld.shrink;\n      });\n    } else if (delta > 0) {\n      this._adjust(children, delta, function(ld) {\n        return ld.grow;\n      });\n    }\n    this._layoutFromLayoutDataWithCache(children, containerSize);\n  }\n\n  _adjust(children, delta, getWeightFunction) {\n    var weightSum,\n      deltaFactor,\n      layoutDatas = children.map(function(c) {\n        return c.layoutData;\n      }).filter(function(ld) {\n        // resizable\n        return ld.acceptDelta(Math.sign(delta)) === 0;\n      });\n\n    if (layoutDatas.length < 1) {\n      return;\n    }\n\n    weightSum = layoutDatas.reduce(function(sum, ld) {\n      return sum + getWeightFunction(ld);\n    }, 0);\n\n    // delta factor\n    deltaFactor = delta / weightSum;\n    delta = layoutDatas.reduce(function(delta, ld) {\n      return ld.acceptDelta(deltaFactor * getWeightFunction(ld), true);\n    }, delta);\n    if (Math.abs(delta) > 0.2) {\n      this._adjust(children, delta, getWeightFunction);\n    }\n\n  }\n\n  _getPreferredSize(htmlComp) {\n    var prefSize;\n    prefSize = htmlComp.prefSize({\n      useCssSize: true\n    })\n      .add(htmlComp.margins());\n    return prefSize;\n  }\n\n  ensureInitialValues(children, containerSize) {\n    var totalPx = this._getDimensionValue(containerSize),\n      sumOfAbsolutePx = 0,\n      sumOfRelatives = 0,\n      colLayoutDatas = children.map(function(c) {\n        return c.layoutData;\n      }),\n      cachedSizes = this._readCache(children.length) || [];\n\n    // setup initial values\n    children.forEach(function(comp, i) {\n      var ld = comp.layoutData;\n\n      if (ld.sizePx) {\n        sumOfAbsolutePx += ld.sizePx;\n      } else if (ld.initial < 0) {\n        // use ui height\n        ld.initialPx = this._getDimensionValue(this._getPreferredSize(comp));\n        sumOfAbsolutePx += ld.initialPx;\n\n      } else if (ld.relative) {\n        sumOfRelatives += ld.initial;\n      } else {\n        ld.initialPx = ld.initial;\n        sumOfAbsolutePx += ld.initialPx;\n      }\n\n    }.bind(this));\n\n    var relativeFactor = (totalPx - sumOfAbsolutePx) / sumOfRelatives;\n    colLayoutDatas.filter(function(ld) {\n      return ld.relative && ld.initial > -1 && !ld.sizePx;\n    }).reduce(function(restWidth, ld) {\n      ld.initialPx = Math.max(30, relativeFactor * ld.initial);\n      return restWidth - ld.initialPx;\n    }, (totalPx - sumOfAbsolutePx));\n\n    // set px values\n    return colLayoutDatas\n      .reduce(function(restWidth, ld, i) {\n        if (!ld.sizePx) {\n          if (cachedSizes[i]) {\n            ld.sizePx = ld.validate(Math.round(totalPx * cachedSizes[i]));\n          } else {\n            ld.sizePx = ld.initialPx;\n          }\n        }\n        this.childrenLayoutDatas.push(ld);\n        return restWidth - ld.sizePx;\n      }.bind(this), totalPx);\n\n  }\n\n  _layoutFromLayoutDataWithCache(children, containerSize) {\n    this._cacheSizes(children, containerSize);\n    this._layoutFromLayoutData(children, containerSize);\n  }\n\n  _cacheSizes(children, containerSize) {\n    var totalPx = this._getDimensionValue(containerSize),\n      value;\n    value = children.map(function(c) {\n      return c.layoutData.sizePx / totalPx;\n    });\n    this._writeCache(children.length, value);\n  }\n\n  // functions differ from row to column mode\n\n  preferredLayoutSizeColumn($container, options) {\n    return this._getChildren($container).reduce(function(size, c) {\n      var prefSize = this._getPreferredSize(c);\n      size.width = Math.max(prefSize.width, size.width);\n      size.height += prefSize.height;\n      return size;\n    }.bind(this), new Dimension(0, 0));\n  }\n\n  preferredLayoutSizeRow($container, options) {\n    return this._getChildren($container).reduce(function(size, c) {\n      var prefSize = this._getPreferredSize(c);\n      size.height = Math.max(prefSize.height, size.height);\n      size.width += prefSize.width;\n      return size;\n    }.bind(this), new Dimension(0, 0));\n  }\n\n  _getWidth(dimension) {\n    return dimension.width;\n  }\n\n  _getHeight(dimension) {\n    return dimension.height;\n  }\n\n  _layoutFromLayoutDataRow(children, containerSize) {\n    children.reduce(function(x, comp) {\n      var margins = comp.margins();\n      var insets = comp.insets();\n      var w = comp.layoutData.sizePx;\n      var bounds = new Rectangle(x - insets.left - margins.left, 0, w + insets.left + insets.right, containerSize.height);\n      comp.setBounds(bounds);\n      return x + w;\n    }, 0);\n  }\n\n  _layoutFromLayoutDataColumn(children, containerSize) {\n    children.reduce(function(y, comp) {\n      var margins = comp.margins();\n      var insets = comp.insets();\n      var h = comp.layoutData.sizePx;\n      var bounds = new Rectangle(0, y - insets.top - margins.top, containerSize.width, h + insets.top + insets.bottom);\n      comp.setBounds(bounds);\n      return y + h;\n    }, 0);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}