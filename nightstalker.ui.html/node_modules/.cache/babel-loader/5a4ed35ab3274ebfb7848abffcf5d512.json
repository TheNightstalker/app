{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Action, HtmlComponent, KeyStrokeContext, NullLayout, scout, styles, Table, TableControlActionKeyStroke, TableControlCloseKeyStroke } from '../../index';\n\nvar TableControl = /*#__PURE__*/function (_Action) {\n  _inherits(TableControl, _Action);\n\n  var _super = _createSuper(TableControl);\n\n  function TableControl() {\n    var _this;\n\n    _classCallCheck(this, TableControl);\n\n    _this = _super.call(this);\n    _this.tableFooter = null;\n    _this.contentRendered = false;\n    _this.height = null;\n    _this.animateDuration = null;\n    _this.resizerVisible = true;\n    _this.toggleAction = true;\n    _this.showTooltipWhenSelected = false;\n    return _this;\n  }\n\n  _createClass(TableControl, [{\n    key: \"_init\",\n    value: function _init(model) {\n      this.parent = model.parent;\n      this.table = this.getTable();\n\n      _get(_getPrototypeOf(TableControl.prototype), \"_init\", this).call(this, model); // retain the size with 'dense' in case we're in dense mode\n\n\n      var denseClass = this.session.desktop.dense ? 'dense' : null;\n      TableControl.CONTAINER_SIZE = styles.getSize('table-control-container', 'height', 'height', TableControl.CONTAINER_SIZE, denseClass);\n      this.height = TableControl.CONTAINER_SIZE;\n      this.animateDuration = TableControl.CONTAINER_ANIMATE_DURATION;\n\n      this._setSelected(this.selected);\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"_initKeyStrokeContext\",\n    value: function _initKeyStrokeContext() {\n      _get(_getPrototypeOf(TableControl.prototype), \"_initKeyStrokeContext\", this).call(this);\n\n      this.tableControlKeyStrokeContext = this._createKeyStrokeContextForTableControl();\n    }\n  }, {\n    key: \"_createKeyStrokeContextForTableControl\",\n    value: function _createKeyStrokeContextForTableControl() {\n      var keyStrokeContext = new KeyStrokeContext();\n\n      keyStrokeContext.$scopeTarget = function () {\n        return this.tableFooter.$controlContent;\n      }.bind(this);\n\n      keyStrokeContext.$bindTarget = function () {\n        return this.tableFooter.$controlContent;\n      }.bind(this);\n\n      keyStrokeContext.registerKeyStroke(new TableControlCloseKeyStroke(this));\n      return keyStrokeContext;\n    }\n  }, {\n    key: \"_createLayout\",\n    value: function _createLayout() {\n      return new NullLayout();\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      var classes = 'table-control ';\n\n      if (this.cssClass) {\n        classes += this.cssClass + '-table-control';\n      }\n\n      this.$container = this.$parent.appendDiv(classes).on('mousedown', this._onMouseDown.bind(this)).data('control', this);\n      this.htmlComp = HtmlComponent.install(this.$container, this.session);\n      this.htmlComp.setLayout(this._createLayout());\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      this.removeContent();\n\n      _get(_getPrototypeOf(TableControl.prototype), \"remove\", this).call(this);\n    }\n  }, {\n    key: \"_renderContent\",\n    value: function _renderContent($parent) {// to be implemented by subclass\n    }\n  }, {\n    key: \"_removeContent\",\n    value: function _removeContent() {// to be implemented by subclass\n    }\n  }, {\n    key: \"removeContent\",\n    value: function removeContent() {\n      if (this.contentRendered) {\n        this._removeContent();\n\n        if (this.cssClass) {\n          this.tableFooter.$controlContainer.removeClass(this.cssClass + '-table-control-container');\n          this.tableFooter.$controlContent.removeClass(this.cssClass + '-table-control-content');\n        }\n\n        this.session.keyStrokeManager.uninstallKeyStrokeContext(this.tableControlKeyStrokeContext);\n        this.contentRendered = false;\n      }\n    }\n    /**\n     * Renders the content if not already rendered.<br>\n     * Opens the container if the container is not already open.<br>\n     * Does nothing if the content is not available yet to -> don't open container if content is not rendered yet to prevent blank container or laggy opening.\n     */\n\n  }, {\n    key: \"renderContent\",\n    value: function renderContent() {\n      if (!this.contentRendered && !this.isContentAvailable()) {\n        return;\n      }\n\n      if (!this.tableFooter.open) {\n        this.tableFooter.openControlContainer(this);\n      }\n\n      if (!this.contentRendered) {\n        if (this.cssClass) {\n          this.tableFooter.$controlContainer.addClass(this.cssClass + '-table-control-container');\n          this.tableFooter.$controlContent.addClass(this.cssClass + '-table-control-content');\n        }\n\n        this.tableFooter.$controlContent.data('control', this);\n\n        this._renderContent(this.tableFooter.$controlContent);\n\n        this.session.keyStrokeManager.installKeyStrokeContext(this.tableControlKeyStrokeContext);\n\n        if (this.htmlComp) {\n          this.htmlComp.invalidateLayoutTree(false);\n        }\n\n        this.contentRendered = true;\n      }\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"get$Scrollable\",\n    value: function get$Scrollable() {\n      return this.$contentContainer;\n    }\n  }, {\n    key: \"_renderSelected\",\n    value: function _renderSelected(selected, options) {\n      selected = scout.nvl(selected, this.selected);\n      options = $.extend({}, {\n        closeWhenUnselected: true\n      }, options);\n      this.$container.select(selected);\n\n      if (selected) {\n        this.tableFooter.onControlSelected(this);\n        this.renderContent();\n      } else {\n        // Don't modify the state initially, only on property change events\n        if (this.rendered) {\n          if (options.closeWhenUnselected && this === this.tableFooter.selectedControl) {\n            // Don't remove immediately, wait for the animation to finish (handled by onControlContainerClosed)\n            this.tableFooter.onControlSelected(null);\n            this.tableFooter.closeControlContainer(this, options);\n          } else {\n            this.removeContent();\n          }\n        }\n      }\n\n      this._updateTooltip();\n    }\n    /**\n     * Returns true if the table control may be displayed (opened).\n     */\n\n  }, {\n    key: \"isContentAvailable\",\n    value: function isContentAvailable() {\n      return true;\n    }\n  }, {\n    key: \"toggle\",\n    value: function toggle() {\n      if (!this.enabledComputed) {\n        return;\n      }\n\n      if (this.tableFooter.selectedControl === this) {\n        this.setSelected(false);\n      } else {\n        this.setSelected(true);\n      }\n    }\n  }, {\n    key: \"setSelected\",\n    value: function setSelected(selected, options) {\n      if (selected && !this.visible) {\n        return;\n      }\n\n      if (selected === this.selected) {\n        return;\n      }\n\n      if (this.tableFooter && this.tableFooter.selectedControl && this.tableFooter.selectedControl !== this) {\n        this.tableFooter.selectedControl.setSelected(false, {\n          closeWhenUnselected: false\n        });\n      } // Instead of calling parent.setSelected(), we manually execute the required code. Otherwise\n      // we would not be able to pass 'closeWhenUnselected' to _renderSelected().\n\n\n      this._setSelected(selected);\n\n      options = $.extend({}, {\n        closeWhenUnselected: true\n      }, options);\n\n      if (this.rendered) {\n        this._renderSelected(selected, options);\n      } else if (options.closeWhenUnselected && this.tableFooter && this === this.tableFooter.selectedControl && !selected) {\n        this.tableFooter.onControlSelected(null);\n      }\n    }\n  }, {\n    key: \"_setSelected\",\n    value: function _setSelected(selected) {\n      // Does not nothing more than the default but allows for extension by a subclass\n      this._setProperty('selected', selected);\n    }\n  }, {\n    key: \"_configureTooltip\",\n    value: function _configureTooltip() {\n      var options = _get(_getPrototypeOf(TableControl.prototype), \"_configureTooltip\", this).call(this);\n\n      options.cssClass = 'table-control-tooltip';\n      return options;\n    }\n  }, {\n    key: \"_onMouseDown\",\n    value: function _onMouseDown() {\n      this.toggle();\n    }\n  }, {\n    key: \"onControlContainerOpened\",\n    value: function onControlContainerOpened() {// nop\n    }\n  }, {\n    key: \"onControlContainerClosed\",\n    value: function onControlContainerClosed() {\n      this.removeContent();\n    }\n    /**\n     * @override Action.js\n     */\n\n  }, {\n    key: \"_createActionKeyStroke\",\n    value: function _createActionKeyStroke() {\n      return new TableControlActionKeyStroke(this);\n    }\n  }, {\n    key: \"getTable\",\n    value: function getTable() {\n      var parent = this.parent;\n\n      while (parent) {\n        if (parent instanceof Table) {\n          return parent;\n        }\n\n        parent = parent.parent;\n      }\n\n      return null;\n    }\n  }]);\n\n  return TableControl;\n}(Action);\n\n_defineProperty(TableControl, \"CONTAINER_SIZE\", 345);\n\n_defineProperty(TableControl, \"CONTAINER_ANIMATE_DURATION\", 350);\n\nexport { TableControl as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/table/controls/TableControl.js"],"names":["Action","HtmlComponent","KeyStrokeContext","NullLayout","scout","styles","Table","TableControlActionKeyStroke","TableControlCloseKeyStroke","TableControl","tableFooter","contentRendered","height","animateDuration","resizerVisible","toggleAction","showTooltipWhenSelected","model","parent","table","getTable","denseClass","session","desktop","dense","CONTAINER_SIZE","getSize","CONTAINER_ANIMATE_DURATION","_setSelected","selected","tableControlKeyStrokeContext","_createKeyStrokeContextForTableControl","keyStrokeContext","$scopeTarget","$controlContent","bind","$bindTarget","registerKeyStroke","classes","cssClass","$container","$parent","appendDiv","on","_onMouseDown","data","htmlComp","install","setLayout","_createLayout","removeContent","_removeContent","$controlContainer","removeClass","keyStrokeManager","uninstallKeyStrokeContext","isContentAvailable","open","openControlContainer","addClass","_renderContent","installKeyStrokeContext","invalidateLayoutTree","$contentContainer","options","nvl","$","extend","closeWhenUnselected","select","onControlSelected","renderContent","rendered","selectedControl","closeControlContainer","_updateTooltip","enabledComputed","setSelected","visible","_renderSelected","_setProperty","toggle"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Action, HtmlComponent, KeyStrokeContext, NullLayout, scout, styles, Table, TableControlActionKeyStroke, TableControlCloseKeyStroke} from '../../index';\n\nexport default class TableControl extends Action {\n\n  constructor() {\n    super();\n    this.tableFooter = null;\n    this.contentRendered = false;\n    this.height = null;\n    this.animateDuration = null;\n    this.resizerVisible = true;\n    this.toggleAction = true;\n    this.showTooltipWhenSelected = false;\n  }\n\n  static CONTAINER_SIZE = 345; // Defined in sizes.less\n  static CONTAINER_ANIMATE_DURATION = 350;\n\n  _init(model) {\n    this.parent = model.parent;\n    this.table = this.getTable();\n    super._init(model);\n    // retain the size with 'dense' in case we're in dense mode\n    var denseClass = this.session.desktop.dense ? 'dense' : null;\n    TableControl.CONTAINER_SIZE = styles.getSize('table-control-container', 'height', 'height', TableControl.CONTAINER_SIZE, denseClass);\n    this.height = TableControl.CONTAINER_SIZE;\n    this.animateDuration = TableControl.CONTAINER_ANIMATE_DURATION;\n    this._setSelected(this.selected);\n  }\n\n  /**\n   * @override\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n\n    this.tableControlKeyStrokeContext = this._createKeyStrokeContextForTableControl();\n  }\n\n  _createKeyStrokeContextForTableControl() {\n    var keyStrokeContext = new KeyStrokeContext();\n    keyStrokeContext.$scopeTarget = function() {\n      return this.tableFooter.$controlContent;\n    }.bind(this);\n    keyStrokeContext.$bindTarget = function() {\n      return this.tableFooter.$controlContent;\n    }.bind(this);\n    keyStrokeContext.registerKeyStroke(new TableControlCloseKeyStroke(this));\n    return keyStrokeContext;\n  }\n\n  _createLayout() {\n    return new NullLayout();\n  }\n\n  _render() {\n    var classes = 'table-control ';\n    if (this.cssClass) {\n      classes += this.cssClass + '-table-control';\n    }\n    this.$container = this.$parent.appendDiv(classes)\n      .on('mousedown', this._onMouseDown.bind(this))\n      .data('control', this);\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n    this.htmlComp.setLayout(this._createLayout());\n  }\n\n  remove() {\n    this.removeContent();\n    super.remove();\n  }\n\n  _renderContent($parent) {\n    // to be implemented by subclass\n  }\n\n  _removeContent() {\n    // to be implemented by subclass\n  }\n\n  removeContent() {\n    if (this.contentRendered) {\n      this._removeContent();\n      if (this.cssClass) {\n        this.tableFooter.$controlContainer.removeClass(this.cssClass + '-table-control-container');\n        this.tableFooter.$controlContent.removeClass(this.cssClass + '-table-control-content');\n      }\n      this.session.keyStrokeManager.uninstallKeyStrokeContext(this.tableControlKeyStrokeContext);\n      this.contentRendered = false;\n    }\n  }\n\n  /**\n   * Renders the content if not already rendered.<br>\n   * Opens the container if the container is not already open.<br>\n   * Does nothing if the content is not available yet to -> don't open container if content is not rendered yet to prevent blank container or laggy opening.\n   */\n  renderContent() {\n    if (!this.contentRendered && !this.isContentAvailable()) {\n      return;\n    }\n\n    if (!this.tableFooter.open) {\n      this.tableFooter.openControlContainer(this);\n    }\n\n    if (!this.contentRendered) {\n      if (this.cssClass) {\n        this.tableFooter.$controlContainer.addClass(this.cssClass + '-table-control-container');\n        this.tableFooter.$controlContent.addClass(this.cssClass + '-table-control-content');\n      }\n      this.tableFooter.$controlContent.data('control', this);\n      this._renderContent(this.tableFooter.$controlContent);\n      this.session.keyStrokeManager.installKeyStrokeContext(this.tableControlKeyStrokeContext);\n      if (this.htmlComp) {\n        this.htmlComp.invalidateLayoutTree(false);\n      }\n      this.contentRendered = true;\n    }\n  }\n\n  /**\n   * @override\n   */\n  get$Scrollable() {\n    return this.$contentContainer;\n  }\n\n  _renderSelected(selected, options) {\n    selected = scout.nvl(selected, this.selected);\n    options = $.extend({}, {closeWhenUnselected: true}, options);\n\n    this.$container.select(selected);\n\n    if (selected) {\n      this.tableFooter.onControlSelected(this);\n      this.renderContent();\n    } else {\n\n      // Don't modify the state initially, only on property change events\n      if (this.rendered) {\n\n        if (options.closeWhenUnselected && this === this.tableFooter.selectedControl) {\n          // Don't remove immediately, wait for the animation to finish (handled by onControlContainerClosed)\n          this.tableFooter.onControlSelected(null);\n          this.tableFooter.closeControlContainer(this, options);\n        } else {\n          this.removeContent();\n        }\n\n      }\n    }\n    this._updateTooltip();\n  }\n\n  /**\n   * Returns true if the table control may be displayed (opened).\n   */\n  isContentAvailable() {\n    return true;\n  }\n\n  toggle() {\n    if (!this.enabledComputed) {\n      return;\n    }\n    if (this.tableFooter.selectedControl === this) {\n      this.setSelected(false);\n    } else {\n      this.setSelected(true);\n    }\n  }\n\n  setSelected(selected, options) {\n    if (selected && !this.visible) {\n      return;\n    }\n    if (selected === this.selected) {\n      return;\n    }\n\n    if (this.tableFooter && this.tableFooter.selectedControl && this.tableFooter.selectedControl !== this) {\n      this.tableFooter.selectedControl.setSelected(false, {closeWhenUnselected: false});\n    }\n\n    // Instead of calling parent.setSelected(), we manually execute the required code. Otherwise\n    // we would not be able to pass 'closeWhenUnselected' to _renderSelected().\n    this._setSelected(selected);\n    options = $.extend({}, {closeWhenUnselected: true}, options);\n    if (this.rendered) {\n      this._renderSelected(selected, options);\n    } else if (options.closeWhenUnselected && this.tableFooter && this === this.tableFooter.selectedControl && !selected) {\n      this.tableFooter.onControlSelected(null);\n    }\n  }\n\n  _setSelected(selected) {\n    // Does not nothing more than the default but allows for extension by a subclass\n    this._setProperty('selected', selected);\n  }\n\n  _configureTooltip() {\n    var options = super._configureTooltip();\n    options.cssClass = 'table-control-tooltip';\n    return options;\n  }\n\n  _onMouseDown() {\n    this.toggle();\n  }\n\n  onControlContainerOpened() {\n    // nop\n  }\n\n  onControlContainerClosed() {\n    this.removeContent();\n  }\n\n  /**\n   * @override Action.js\n   */\n  _createActionKeyStroke() {\n    return new TableControlActionKeyStroke(this);\n  }\n\n  getTable() {\n    var parent = this.parent;\n    while (parent) {\n      if (parent instanceof Table) {\n        return parent;\n      }\n      parent = parent.parent;\n    }\n\n    return null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}