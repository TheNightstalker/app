{"ast":null,"code":"/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, Device, objects, strings } from '../index';\n/**\n * @returns {number} the x coordinate where the event happened, works for touch events as well.\n */\n\nexport function pageX(event) {\n  if (!objects.isNullOrUndefined(event.pageX)) {\n    return event.pageX;\n  }\n\n  return event.originalEvent.touches[0].pageX;\n}\n/**\n * @returns {number} the y coordinate where the event happened, works for touch events as well.\n */\n\nexport function pageY(event) {\n  if (!objects.isNullOrUndefined(event.pageY)) {\n    return event.pageY;\n  }\n\n  return event.originalEvent.touches[0].pageY;\n}\nexport function touchdown(touch, suffix) {\n  return touchOrMouse(touch, 'touchstart', 'mousedown', suffix);\n}\nexport function touchmove(touch, suffix) {\n  return touchOrMouse(touch, 'touchmove', 'mousemove', suffix);\n}\nexport function touchendcancel(touch, suffix) {\n  return touchOrMouse(touch, 'touchend touchcancel', 'mouseup', suffix);\n}\nexport function touchOrMouse(touch, touchevent, mouseevent, suffix) {\n  suffix = suffix || '';\n\n  if (suffix) {\n    suffix = '.' + suffix;\n  }\n\n  if (touch) {\n    return touchevent + suffix;\n  }\n\n  return mouseevent + suffix;\n}\nexport function isTouchEvent(event) {\n  return event && strings.startsWith(event.type, 'touch');\n}\nexport function fixTouchEvent(event) {\n  if (isTouchEvent(event)) {\n    var touches = event.touches || (event.originalEvent ? event.originalEvent.touches : null);\n    var touch = touches ? touches[0] : null;\n\n    if (touch) {\n      // Touch events may contain fractional values, while mouse events should not\n      // - https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/pageX\n      // - https://www.chromestatus.com/features/6169687914184704\n      event.pageX = Math.round(touch.pageX);\n      event.pageY = Math.round(touch.pageY);\n    }\n  }\n}\n/**\n * @returns an object containing passive: true if the browser supports passive event listeners, otherwise returns false.\n */\n\nexport function passiveOptions() {\n  var options = false;\n\n  if (Device.get().supportsPassiveEventListener()) {\n    options = {\n      passive: true\n    };\n  }\n\n  return options;\n}\n/**\n * Listens for scroll events and executes startHandler on first event. It then regularly checks for further scroll events and executes endHandler if no event has fired since a certain amount of time and the user has released his finger.\n * If he does not release his finger the endHandler won't be called even if the pane has stopped scrolling.\n */\n\nexport function onScrollStartEndDuringTouch($elem, startHandler, endHandler) {\n  var scrollTimeout;\n  var started = false;\n  var touchend = false;\n\n  var scrollHandler = function scrollHandler(event) {\n    // Execute once on first scroll event (and not as soon as user touches the pane because he might not even want to scroll)\n    if (!started) {\n      startHandler();\n      started = true;\n    }\n\n    clearTimeout(scrollTimeout); // Check some ms later if a scroll event has occured in the mean time.\n    // If yes it (probably) is still scrolling. If no it (probably) is not scrolling anymore -> call handler\n\n    checkLater();\n  };\n\n  var touchEndHandler = function touchEndHandler(event) {\n    touchend = true;\n    checkLater();\n  };\n\n  function checkLater() {\n    clearTimeout(scrollTimeout);\n    scrollTimeout = setTimeout(function () {\n      if (touchend) {\n        // Only stop processing if user released the finger\n        removeHandlers();\n        endHandler();\n      }\n    }, 50);\n  }\n\n  function removeHandlers() {\n    $elem.off('scroll', scrollHandler);\n    $elem.document().off('touchend touchcancel', touchEndHandler);\n  }\n\n  $elem.on('scroll', scrollHandler); // Make sure handler is executed and scroll listener removed if no scroll event occurs\n\n  $elem.document().one('touchend touchcancel', touchEndHandler);\n}\n/**\n * Forwards the event to the given target by creating a new event with the same data as the old one.\n * Prevents default action of the original event if preventDefault was called for the forwarded event.\n * Does not use jQuery to make sure the capture phase is executed as well.\n *\n * <p>\n * <b>Important</b>\n * This function only works in browsers supporting the Event constructor (e.g. KeyboardEvent: https://developer.mozilla.org/de/docs/Web/API/KeyboardEvent/KeyboardEvent).\n * -> It does not work for IE 11.\n * </p>\n *\n * @param target {HTMLElement} the element which should receive the event\n * @param event {Event} the original event which should be propagated\n */\n\nexport function propagateEvent(target, event) {\n  if (typeof Event !== 'function') {\n    return;\n  }\n\n  var newEvent = new event.constructor(event.type, event);\n\n  if (!target.dispatchEvent(newEvent)) {\n    event.preventDefault();\n  }\n}\n/**\n * Adds an event listener for each given type to the source which propagates the events for that type to the target.\n *\n * <p>\n * <b>Important</b>\n * This function only works in browsers supporting the Event constructor (e.g. KeyboardEvent: https://developer.mozilla.org/de/docs/Web/API/KeyboardEvent/KeyboardEvent).\n * -> It does not work for IE 11.\n * </p>\n *\n * @param source {HTMLElement} the element for which the event listener should be added.\n * @param target {HTMLElement} the element which should receive the event.\n * @param types {string[]} an array of event types.\n * @param [filter] {function} an optional filter function which can return false if the event should not be propagated.\n */\n\nexport function addPropagationListener(source, target, types, filter) {\n  types = arrays.ensure(types);\n  types.forEach(function (type) {\n    source.addEventListener(type, function (event) {\n      if (filter && !filter(event)) {\n        return;\n      }\n\n      propagateEvent(target, event);\n    });\n  });\n}\nexport default {\n  addPropagationListener: addPropagationListener,\n  fixTouchEvent: fixTouchEvent,\n  isTouchEvent: isTouchEvent,\n  onScrollStartEndDuringTouch: onScrollStartEndDuringTouch,\n  pageX: pageX,\n  pageY: pageY,\n  passiveOptions: passiveOptions,\n  propagateEvent: propagateEvent,\n  touchOrMouse: touchOrMouse,\n  touchdown: touchdown,\n  touchendcancel: touchendcancel,\n  touchmove: touchmove\n};","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/util/events.js"],"names":["arrays","Device","objects","strings","pageX","event","isNullOrUndefined","originalEvent","touches","pageY","touchdown","touch","suffix","touchOrMouse","touchmove","touchendcancel","touchevent","mouseevent","isTouchEvent","startsWith","type","fixTouchEvent","Math","round","passiveOptions","options","get","supportsPassiveEventListener","passive","onScrollStartEndDuringTouch","$elem","startHandler","endHandler","scrollTimeout","started","touchend","scrollHandler","clearTimeout","checkLater","touchEndHandler","setTimeout","removeHandlers","off","document","on","one","propagateEvent","target","Event","newEvent","constructor","dispatchEvent","preventDefault","addPropagationListener","source","types","filter","ensure","forEach","addEventListener"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, Device, objects, strings} from '../index';\n\n/**\n * @returns {number} the x coordinate where the event happened, works for touch events as well.\n */\nexport function pageX(event) {\n  if (!objects.isNullOrUndefined(event.pageX)) {\n    return event.pageX;\n  }\n  return event.originalEvent.touches[0].pageX;\n}\n\n/**\n * @returns {number} the y coordinate where the event happened, works for touch events as well.\n */\nexport function pageY(event) {\n  if (!objects.isNullOrUndefined(event.pageY)) {\n    return event.pageY;\n  }\n  return event.originalEvent.touches[0].pageY;\n}\n\nexport function touchdown(touch, suffix) {\n  return touchOrMouse(touch, 'touchstart', 'mousedown', suffix);\n}\n\nexport function touchmove(touch, suffix) {\n  return touchOrMouse(touch, 'touchmove', 'mousemove', suffix);\n}\n\nexport function touchendcancel(touch, suffix) {\n  return touchOrMouse(touch, 'touchend touchcancel', 'mouseup', suffix);\n}\n\nexport function touchOrMouse(touch, touchevent, mouseevent, suffix) {\n  suffix = suffix || '';\n  if (suffix) {\n    suffix = '.' + suffix;\n  }\n  if (touch) {\n    return touchevent + suffix;\n  }\n  return mouseevent + suffix;\n}\n\nexport function isTouchEvent(event) {\n  return event && strings.startsWith(event.type, 'touch');\n}\n\nexport function fixTouchEvent(event) {\n  if (isTouchEvent(event)) {\n    var touches = event.touches || (event.originalEvent ? event.originalEvent.touches : null);\n    var touch = touches ? touches[0] : null;\n    if (touch) {\n      // Touch events may contain fractional values, while mouse events should not\n      // - https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/pageX\n      // - https://www.chromestatus.com/features/6169687914184704\n      event.pageX = Math.round(touch.pageX);\n      event.pageY = Math.round(touch.pageY);\n    }\n  }\n}\n\n/**\n * @returns an object containing passive: true if the browser supports passive event listeners, otherwise returns false.\n */\nexport function passiveOptions() {\n  var options = false;\n  if (Device.get().supportsPassiveEventListener()) {\n    options = {\n      passive: true\n    };\n  }\n  return options;\n}\n\n/**\n * Listens for scroll events and executes startHandler on first event. It then regularly checks for further scroll events and executes endHandler if no event has fired since a certain amount of time and the user has released his finger.\n * If he does not release his finger the endHandler won't be called even if the pane has stopped scrolling.\n */\nexport function onScrollStartEndDuringTouch($elem, startHandler, endHandler) {\n  var scrollTimeout;\n  var started = false;\n  var touchend = false;\n  var scrollHandler = function(event) {\n    // Execute once on first scroll event (and not as soon as user touches the pane because he might not even want to scroll)\n    if (!started) {\n      startHandler();\n      started = true;\n    }\n\n    clearTimeout(scrollTimeout);\n    // Check some ms later if a scroll event has occured in the mean time.\n    // If yes it (probably) is still scrolling. If no it (probably) is not scrolling anymore -> call handler\n    checkLater();\n  };\n\n  var touchEndHandler = function(event) {\n    touchend = true;\n    checkLater();\n  };\n\n  function checkLater() {\n    clearTimeout(scrollTimeout);\n    scrollTimeout = setTimeout(function() {\n      if (touchend) {\n        // Only stop processing if user released the finger\n        removeHandlers();\n        endHandler();\n      }\n    }, 50);\n  }\n\n  function removeHandlers() {\n    $elem.off('scroll', scrollHandler);\n    $elem.document().off('touchend touchcancel', touchEndHandler);\n  }\n\n  $elem.on('scroll', scrollHandler);\n  // Make sure handler is executed and scroll listener removed if no scroll event occurs\n  $elem.document().one('touchend touchcancel', touchEndHandler);\n}\n\n/**\n * Forwards the event to the given target by creating a new event with the same data as the old one.\n * Prevents default action of the original event if preventDefault was called for the forwarded event.\n * Does not use jQuery to make sure the capture phase is executed as well.\n *\n * <p>\n * <b>Important</b>\n * This function only works in browsers supporting the Event constructor (e.g. KeyboardEvent: https://developer.mozilla.org/de/docs/Web/API/KeyboardEvent/KeyboardEvent).\n * -> It does not work for IE 11.\n * </p>\n *\n * @param target {HTMLElement} the element which should receive the event\n * @param event {Event} the original event which should be propagated\n */\nexport function propagateEvent(target, event) {\n  if (typeof (Event) !== 'function') {\n    return;\n  }\n  var newEvent = new event.constructor(event.type, event);\n  if (!target.dispatchEvent(newEvent)) {\n    event.preventDefault();\n  }\n}\n\n/**\n * Adds an event listener for each given type to the source which propagates the events for that type to the target.\n *\n * <p>\n * <b>Important</b>\n * This function only works in browsers supporting the Event constructor (e.g. KeyboardEvent: https://developer.mozilla.org/de/docs/Web/API/KeyboardEvent/KeyboardEvent).\n * -> It does not work for IE 11.\n * </p>\n *\n * @param source {HTMLElement} the element for which the event listener should be added.\n * @param target {HTMLElement} the element which should receive the event.\n * @param types {string[]} an array of event types.\n * @param [filter] {function} an optional filter function which can return false if the event should not be propagated.\n */\nexport function addPropagationListener(source, target, types, filter) {\n  types = arrays.ensure(types);\n  types.forEach(function(type) {\n    source.addEventListener(type, function(event) {\n      if (filter && !filter(event)) {\n        return;\n      }\n      propagateEvent(target, event);\n    });\n  });\n}\n\nexport default {\n  addPropagationListener,\n  fixTouchEvent,\n  isTouchEvent,\n  onScrollStartEndDuringTouch,\n  pageX,\n  pageY,\n  passiveOptions,\n  propagateEvent,\n  touchOrMouse,\n  touchdown,\n  touchendcancel,\n  touchmove\n};\n"]},"metadata":{},"sourceType":"module"}