{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Button, DialogLayout, Event, FileChooserController, FocusRule, FormLayout, GlassPaneRenderer, GroupBox, HtmlComponent, MessageBoxController, Rectangle, scout, Status, strings, tooltips, webstorage, Widget, WrappedFormField } from '../index';\nimport $ from 'jquery';\n\nvar Form = /*#__PURE__*/function (_Widget) {\n  _inherits(Form, _Widget);\n\n  var _super = _createSuper(Form);\n\n  function Form() {\n    var _this;\n\n    _classCallCheck(this, Form);\n\n    _this = _super.call(this);\n\n    _this._addWidgetProperties(['rootGroupBox', 'views', 'dialogs', 'initialFocus', 'messageBoxes', 'fileChoosers']);\n\n    _this._addPreserveOnPropertyChangeProperties(['initialFocus']);\n\n    _this.askIfNeedSave = true;\n    _this.askIfNeedSaveText = null; // if not set, a default text is used (see Lifecycle.js)\n\n    _this.data = {};\n    _this.displayHint = Form.DisplayHint.DIALOG;\n    _this.displayParent = null; // only relevant if form is opened, not relevant if form is just rendered into another widget (not managed by a form controller)\n\n    _this.maximizeEnabled = true;\n    _this.maximized = false;\n    _this.minimizeEnabled = true;\n    _this.minimized = false;\n    _this.modal = true;\n    _this.logicalGrid = scout.create('FormGrid');\n    _this.dialogs = [];\n    _this.views = [];\n    _this.messageBoxes = [];\n    _this.fileChoosers = [];\n    _this.focusedElement = null;\n    _this.closable = true;\n    _this.cacheBounds = false;\n    _this.cacheBoundsKey = null;\n    _this.resizable = true;\n    _this.rootGroupBox = null;\n    _this.saveNeeded = false;\n    _this.saveNeededVisible = false;\n    _this.formController = null;\n    _this.messageBoxController = null;\n    _this.fileChooserController = null;\n    _this._glassPaneRenderer = null;\n    /**\n     * Whether this form should render its initial focus\n     */\n\n    _this.renderInitialFocusEnabled = true;\n    _this.$statusIcons = [];\n    _this.$header = null;\n    _this.$statusContainer = null;\n    _this.$close = null;\n    _this.$saveNeeded = null;\n    _this.$icon = null;\n    _this.$title = null;\n    _this.$subTitle = null;\n    return _this;\n  }\n\n  _createClass(Form, [{\n    key: \"_init\",\n    value: function _init(model) {\n      _get(_getPrototypeOf(Form.prototype), \"_init\", this).call(this, model);\n\n      this.resolveTextKeys(['title', 'askIfNeedSaveText']);\n      this.resolveIconIds(['iconId']);\n\n      this._setDisplayParent(this.displayParent);\n\n      this._setViews(this.views);\n\n      this.formController = scout.create('FormController', {\n        displayParent: this,\n        session: this.session\n      });\n      this.messageBoxController = new MessageBoxController(this, this.session);\n      this.fileChooserController = new FileChooserController(this, this.session);\n\n      this._setRootGroupBox(this.rootGroupBox);\n\n      this._setStatus(this.status);\n\n      this.cacheBoundsKey = scout.nvl(model.cacheBoundsKey, this.objectType);\n\n      this._installLifecycle();\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      this._renderForm();\n    }\n    /**\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"_renderProperties\",\n    value: function _renderProperties() {\n      _get(_getPrototypeOf(Form.prototype), \"_renderProperties\", this).call(this);\n\n      this._renderTitle();\n\n      this._renderSubTitle();\n\n      this._renderIconId();\n\n      this._renderClosable();\n\n      this._renderSaveNeeded();\n\n      this._renderCssClass();\n\n      this._renderStatus();\n\n      this._renderModal();\n\n      this._installFocusContext();\n\n      if (this.renderInitialFocusEnabled) {\n        this.renderInitialFocus();\n      }\n    }\n  }, {\n    key: \"_postRender\",\n    value: function _postRender() {\n      _get(_getPrototypeOf(Form.prototype), \"_postRender\", this).call(this); // Render attached forms, message boxes and file choosers.\n\n\n      this.formController.render();\n      this.messageBoxController.render();\n      this.fileChooserController.render();\n\n      if (this._glassPaneRenderer) {\n        this._glassPaneRenderer.renderGlassPanes();\n      }\n    }\n  }, {\n    key: \"_destroy\",\n    value: function _destroy() {\n      _get(_getPrototypeOf(Form.prototype), \"_destroy\", this).call(this);\n\n      if (this._glassPaneRenderer) {\n        this._glassPaneRenderer = null;\n      }\n    }\n  }, {\n    key: \"_remove\",\n    value: function _remove() {\n      this.formController.remove();\n      this.messageBoxController.remove();\n      this.fileChooserController.remove();\n\n      if (this._glassPaneRenderer) {\n        this._glassPaneRenderer.removeGlassPanes();\n\n        this._glassPaneRenderer = null;\n      }\n\n      this._uninstallFocusContext();\n\n      this.$statusIcons = [];\n      this.$header = null;\n      this.$statusContainer = null;\n      this.$close = null;\n      this.$saveNeeded = null;\n      this.$icon = null;\n      this.$title = null;\n      this.$subTitle = null;\n\n      _get(_getPrototypeOf(Form.prototype), \"_remove\", this).call(this);\n    }\n  }, {\n    key: \"_renderForm\",\n    value: function _renderForm() {\n      var layout, $handle;\n      this.$container = this.$parent.appendDiv().addClass(this.isDialog() ? 'dialog' : 'form').data('model', this);\n\n      if (this.uiCssClass) {\n        this.$container.addClass(this.uiCssClass);\n      }\n\n      this.htmlComp = HtmlComponent.install(this.$container, this.session);\n\n      if (this.isDialog()) {\n        layout = new DialogLayout(this);\n        this.htmlComp.validateRoot = true;\n        $handle = this.$container.appendDiv('drag-handle');\n        this.$container.draggable($handle, $.throttle(this._onMove.bind(this), 1000 / 60)); // 60fps\n\n        if (this.resizable) {\n          this._initResizable();\n        }\n\n        this._renderHeader(); // Attach to capture phase to activate focus context before regular mouse down handlers may set the focus.\n        // E.g. clicking a check box label on another dialog executes mouse down handler of the check box which will focus the box. This only works if the focus context of the dialog is active.\n\n\n        this.$container[0].addEventListener('mousedown', this._onDialogMouseDown.bind(this), true);\n      } else {\n        layout = new FormLayout(this);\n      }\n\n      this.htmlComp.setLayout(layout);\n      this.rootGroupBox.render();\n    }\n  }, {\n    key: \"_renderFocusedElement\",\n    value: function _renderFocusedElement() {\n      if (this.focusedElement) {\n        this.focusedElement.focus();\n        this.focusedElement = null;\n      }\n    }\n  }, {\n    key: \"setModal\",\n    value: function setModal(modal) {\n      this.setProperty('modal', modal);\n    }\n  }, {\n    key: \"_renderModal\",\n    value: function _renderModal() {\n      if (this.parent instanceof WrappedFormField) {\n        return;\n      }\n\n      if (this.modal && !this._glassPaneRenderer) {\n        this._glassPaneRenderer = new GlassPaneRenderer(this);\n\n        this._glassPaneRenderer.renderGlassPanes();\n      } else if (!this.modal && this._glassPaneRenderer) {\n        this._glassPaneRenderer.removeGlassPanes();\n\n        this._glassPaneRenderer = null;\n      }\n    }\n  }, {\n    key: \"_installLifecycle\",\n    value: function _installLifecycle() {\n      this.lifecycle = this._createLifecycle();\n      this.lifecycle.handle('load', this._onLifecycleLoad.bind(this));\n      this.lifecycle.handle('save', this._onLifecycleSave.bind(this));\n      this.lifecycle.on('postLoad', this._onLifecyclePostLoad.bind(this));\n      this.lifecycle.on('reset', this._onLifecycleReset.bind(this));\n      this.lifecycle.on('close', this._onLifecycleClose.bind(this));\n    }\n  }, {\n    key: \"_createLifecycle\",\n    value: function _createLifecycle() {\n      return scout.create('FormLifecycle', {\n        widget: this,\n        askIfNeedSave: this.askIfNeedSave,\n        askIfNeedSaveText: this.askIfNeedSaveText\n      });\n    }\n    /**\n     * Loads the data and renders the form afterwards by adding it to the desktop.\n     * <p>\n     * Calling this method is equivalent to calling load() first and once the promise is resolved, calling show().\n     * <p>\n     * Keep in mind that the form won't be rendered immediately after calling {@link open}. Because promises are always resolved asynchronously,\n     * {@link show} will be called delayed even if {@link load} does nothing but return a resolved promise.<br>\n     * This is only relevant if you need to access properties which are only available when the form is rendered (e.g. $container), which is not recommended anyway.\n     * <p>\n     *\n     * @returns {Promise} the promise returned by the {@link load} function.\n     */\n\n  }, {\n    key: \"open\",\n    value: function open() {\n      return this.load().then(function () {\n        if (this.destroyed) {\n          // If form has been closed right after it was opened don't try to show it\n          return;\n        }\n\n        this.show();\n      }.bind(this));\n    }\n    /**\n     * Initializes the life cycle and calls the {@link _load} function.\n     * @returns {Promise} promise which is resolved when the form is loaded.\n     */\n\n  }, {\n    key: \"load\",\n    value: function load() {\n      return this.lifecycle.load();\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is loaded, respectively when the 'load' event is triggered'.\n     */\n\n  }, {\n    key: \"whenLoad\",\n    value: function whenLoad() {\n      return this.when('load');\n    }\n    /**\n     * Lifecycle handle function registered for 'load'.\n     *\n     * @returns {Promise<T | void>|void}\n     */\n\n  }, {\n    key: \"_onLifecycleLoad\",\n    value: function _onLifecycleLoad() {\n      var _this2 = this;\n\n      try {\n        return this._load().then(function (data) {\n          if (_this2.destroyed) {\n            // If form has been closed right after it was opened ignore the load result\n            return;\n          }\n\n          _this2.setData(data);\n\n          _this2.importData();\n\n          _this2.trigger('load');\n        }).catch(function (error) {\n          return _this2._handleLoadError(error);\n        });\n      } catch (error) {\n        return this._handleLoadError(error);\n      }\n    }\n    /**\n     * This function is called when an error occurs while the <code>_load</code> function is called or when the <code>_load</code> function returns with a rejected promise.\n     * By default the Form is destroyed and the error re-thrown so a caller of <code>Form.load()</code> may catch the error.\n     *\n     * @param error\n     */\n\n  }, {\n    key: \"_handleLoadError\",\n    value: function _handleLoadError(error) {\n      this.destroy();\n      throw error;\n    }\n    /**\n     * Method may be implemented to load the data. By default, the provided this.data is returned.\n     */\n\n  }, {\n    key: \"_load\",\n    value: function _load() {\n      return $.resolvedPromise().then(function () {\n        return this.data;\n      }.bind(this));\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is post loaded, respectively when the 'postLoad' event is triggered'.\n     */\n\n  }, {\n    key: \"whenPostLoad\",\n    value: function whenPostLoad() {\n      return this.when('postLoad');\n    }\n  }, {\n    key: \"_onLifecyclePostLoad\",\n    value: function _onLifecyclePostLoad() {\n      return this._postLoad().then(function () {\n        this.trigger('postLoad');\n      }.bind(this));\n    }\n  }, {\n    key: \"_postLoad\",\n    value: function _postLoad() {\n      return $.resolvedPromise();\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(data) {\n      this.setProperty('data', data);\n    }\n  }, {\n    key: \"importData\",\n    value: function importData() {// NOP\n    }\n  }, {\n    key: \"exportData\",\n    value: function exportData() {// NOP\n    }\n    /**\n     * Saves and closes the form.\n     * @returns {Promise} promise which is resolved when the form is closed.\n     */\n\n  }, {\n    key: \"ok\",\n    value: function ok() {\n      return this.lifecycle.ok();\n    }\n    /**\n     * Saves the changes without closing the form.\n     * @returns {Promise} promise which is resolved when the form is saved\n     *    Note: it will be resolved even if the form does not require save and therefore even if {@link @_save} is not called.\n     *    If you only want to be informed when save is required and {@link @_save} executed then you could use {@link whenSave()} or {@link on('save')} instead.\n     */\n\n  }, {\n    key: \"save\",\n    value: function save() {\n      return this.lifecycle.save();\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is saved, respectively when the 'save' event is triggered'.\n     */\n\n  }, {\n    key: \"whenSave\",\n    value: function whenSave() {\n      return this.when('save');\n    }\n  }, {\n    key: \"_onLifecycleSave\",\n    value: function _onLifecycleSave() {\n      var data = this.exportData();\n      return this._save(data).then(function (status) {\n        this.setData(data);\n        this.trigger('save');\n        return status;\n      }.bind(this));\n    }\n    /**\n     * This function is called by the lifecycle, for instance when the 'ok' function is called.\n     * The function is called every time the 'ok' function is called, which means it runs even when\n     * there is not a single touched field. The function should be used to implement an overall validate\n     * logic which is not related to a specific field. For instance you could validate the state of an\n     * internal member variable.\n     * <p>\n     * You should return a Status object with severity ERROR in case the validation fails.\n     *\n     * @return Status\n     */\n\n  }, {\n    key: \"_validate\",\n    value: function _validate() {\n      return Status.ok();\n    }\n    /**\n     * This function is called by the lifecycle, when the 'save' function is called.<p>\n     * The data given to this function is the result of 'exportData' which was called in advance.\n     *\n     * @returns {Promise} promise which may contain a Status specifying if the save operation was successful. The promise may be empty which means the save operation was successful.\n     */\n\n  }, {\n    key: \"_save\",\n    value: function _save(data) {\n      return $.resolvedPromise();\n    }\n    /**\n     * Resets the form to its initial state.\n     * @returns {Promise}.\n     */\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.lifecycle.reset();\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is reset, respectively when the 'reset' event is triggered'.\n     */\n\n  }, {\n    key: \"whenReset\",\n    value: function whenReset() {\n      return this.when('reset');\n    }\n  }, {\n    key: \"_onLifecycleReset\",\n    value: function _onLifecycleReset() {\n      this.trigger('reset');\n    }\n    /**\n     * Closes the form if there are no changes made. Otherwise it shows a message box asking to save the changes.\n     * @returns {Promise}.\n     */\n\n  }, {\n    key: \"cancel\",\n    value: function cancel() {\n      return this.lifecycle.cancel();\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is cancelled, respectively when the 'cancel' event is triggered'.\n     */\n\n  }, {\n    key: \"whenCancel\",\n    value: function whenCancel() {\n      return this.when('cancel');\n    }\n    /**\n     * Closes the form and discards any unsaved changes.\n     * @returns {Promise}.\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      return this.lifecycle.close();\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is closed, respectively when the 'close' event is triggered'.\n     */\n\n  }, {\n    key: \"whenClose\",\n    value: function whenClose() {\n      return this.when('close');\n    }\n    /**\n     * Destroys the form and removes it from the desktop.\n     */\n\n  }, {\n    key: \"_onLifecycleClose\",\n    value: function _onLifecycleClose() {\n      var event = new Event();\n      this.trigger('close', event);\n\n      if (!event.defaultPrevented) {\n        this._close();\n      }\n    }\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      this.hide();\n      this.destroy();\n    }\n    /**\n     * This function is called when the user presses the \"x\" icon.<p>\n     * It will either call {@link #close()} or {@link #cancel()), depending on the enabled and visible system buttons, see {@link _abort}.\n     */\n\n  }, {\n    key: \"abort\",\n    value: function abort() {\n      var event = new Event();\n      this.trigger('abort', event);\n\n      if (!event.defaultPrevented) {\n        this._abort();\n      }\n    }\n    /**\n     * @returns {Promise} promise which is resolved when the form is aborted, respectively when the 'abort' event is triggered'.\n     */\n\n  }, {\n    key: \"whenAbort\",\n    value: function whenAbort() {\n      return this.when('abort');\n    }\n    /**\n     * Will call {@link #close()} if there is a close menu or button, otherwise {@link #cancel()) will be called.\n    */\n\n  }, {\n    key: \"_abort\",\n    value: function _abort() {\n      // Search for a close button in the menus and buttons of the root group box\n      var hasCloseButton = this.rootGroupBox.controls.concat(this.rootGroupBox.menus).filter(function (control) {\n        var enabled = control.enabled;\n\n        if (control.enabledComputed !== undefined) {\n          enabled = control.enabledComputed; // Menus don't have enabledComputed, only form fields\n        }\n\n        return control.visible && enabled && control.systemType && control.systemType !== Button.SystemType.NONE;\n      }).some(function (control) {\n        return control.systemType === Button.SystemType.CLOSE;\n      });\n\n      if (hasCloseButton) {\n        this.close();\n      } else {\n        this.cancel();\n      }\n    }\n  }, {\n    key: \"setClosable\",\n    value: function setClosable(closable) {\n      this.setProperty('closable', closable);\n    }\n  }, {\n    key: \"_renderClosable\",\n    value: function _renderClosable() {\n      if (!this.isDialog()) {\n        return;\n      }\n\n      this.$container.toggleClass('closable');\n\n      if (this.closable) {\n        if (this.$close) {\n          return;\n        }\n\n        this.$close = this.$statusContainer.appendDiv('status closer').on('click', this._onCloseIconClick.bind(this));\n      } else {\n        if (!this.$close) {\n          return;\n        }\n\n        this.$close.remove();\n        this.$close = null;\n      }\n    }\n  }, {\n    key: \"_onCloseIconClick\",\n    value: function _onCloseIconClick() {\n      this.abort();\n    }\n  }, {\n    key: \"_initResizable\",\n    value: function _initResizable() {\n      this.$container.resizable().on('resize', this._onResize.bind(this));\n    }\n  }, {\n    key: \"_onResize\",\n    value: function _onResize(event) {\n      var autoSizeOld = this.htmlComp.layout.autoSize;\n      this.htmlComp.layout.autoSize = false;\n      this.htmlComp.revalidateLayout();\n      this.htmlComp.layout.autoSize = autoSizeOld;\n      this.updateCacheBounds();\n      return false;\n    }\n  }, {\n    key: \"_onDialogMouseDown\",\n    value: function _onDialogMouseDown() {\n      this.activate();\n    }\n  }, {\n    key: \"activate\",\n    value: function activate() {\n      this.session.desktop.activateForm(this);\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.session.desktop.showForm(this);\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.session.desktop.hideForm(this);\n    }\n  }, {\n    key: \"_renderHeader\",\n    value: function _renderHeader() {\n      if (this.isDialog()) {\n        this.$header = this.$container.appendDiv('header');\n        this.$statusContainer = this.$header.appendDiv('status-container');\n        this.$icon = this.$header.appendDiv('icon-container');\n        this.$title = this.$header.appendDiv('title');\n        tooltips.installForEllipsis(this.$title, {\n          parent: this\n        });\n        this.$subTitle = this.$header.appendDiv('sub-title');\n        tooltips.installForEllipsis(this.$subTitle, {\n          parent: this\n        });\n      }\n    }\n  }, {\n    key: \"_setRootGroupBox\",\n    value: function _setRootGroupBox(rootGroupBox) {\n      this._setProperty('rootGroupBox', rootGroupBox);\n\n      if (this.rootGroupBox) {\n        this.rootGroupBox.setMainBox(true);\n\n        if (this.isDialog() || this.searchForm || this.parent instanceof WrappedFormField) {\n          this.rootGroupBox.setMenuBarPosition(GroupBox.MenuBarPosition.BOTTOM);\n        }\n      }\n    }\n  }, {\n    key: \"_renderSaveNeeded\",\n    value: function _renderSaveNeeded() {\n      if (!this.isDialog()) {\n        return;\n      }\n\n      if (this.saveNeeded && this.saveNeededVisible) {\n        this.$container.addClass('save-needed');\n\n        if (this.$saveNeeded) {\n          return;\n        }\n\n        if (this.$close) {\n          this.$saveNeeded = this.$close.beforeDiv('status save-needer');\n        } else {\n          this.$saveNeeded = this.$statusContainer.appendDiv('status save-needer');\n        }\n      } else {\n        this.$container.removeClass('save-needed');\n\n        if (!this.$saveNeeded) {\n          return;\n        }\n\n        this.$saveNeeded.remove();\n        this.$saveNeeded = null;\n      } // Layout could have been changed, e.g. if subtitle becomes visible\n\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"setAskIfNeedSave\",\n    value: function setAskIfNeedSave(askIfNeedSave) {\n      this.setProperty('askIfNeedSave', askIfNeedSave);\n\n      if (this.lifecycle) {\n        this.lifecycle.setAskIfNeedSave(askIfNeedSave);\n      }\n    }\n  }, {\n    key: \"setDisplayHint\",\n    value: function setDisplayHint(displayHint) {\n      this.setProperty('displayHint', displayHint);\n    }\n  }, {\n    key: \"setSaveNeededVisible\",\n    value: function setSaveNeededVisible(visible) {\n      this.setProperty('saveNeededVisible', visible);\n    }\n  }, {\n    key: \"_renderSaveNeededVisible\",\n    value: function _renderSaveNeededVisible() {\n      this._renderSaveNeeded();\n    }\n  }, {\n    key: \"_renderCssClass\",\n    value: function _renderCssClass(cssClass, oldCssClass) {\n      cssClass = cssClass || this.cssClass;\n      this.$container.removeClass(oldCssClass);\n      this.$container.addClass(cssClass); // Layout could have been changed, e.g. if subtitle becomes visible\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"setStatus\",\n    value: function setStatus(status) {\n      this.setProperty('status', status);\n    }\n  }, {\n    key: \"_setStatus\",\n    value: function _setStatus(status) {\n      status = Status.ensure(status);\n\n      this._setProperty('status', status);\n    }\n  }, {\n    key: \"_renderStatus\",\n    value: function _renderStatus() {\n      if (!this.isDialog()) {\n        return;\n      }\n\n      this.$statusIcons.forEach(function ($icn) {\n        $icn.remove();\n      });\n      this.$statusIcons = [];\n\n      if (this.status) {\n        var statusList = this.status.asFlatList();\n        var $prevIcon;\n        statusList.forEach(function (sts) {\n          $prevIcon = this._renderSingleStatus(sts, $prevIcon);\n\n          if ($prevIcon) {\n            this.$statusIcons.push($prevIcon);\n          }\n        }.bind(this));\n      } // Layout could have been changed, e.g. if subtitle becomes visible\n\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"_renderSingleStatus\",\n    value: function _renderSingleStatus(status, $prevIcon) {\n      if (status && status.iconId) {\n        var $statusIcon = this.$statusContainer.appendIcon(status.iconId, 'status');\n\n        if (status.cssClass()) {\n          $statusIcon.addClass(status.cssClass());\n        }\n\n        $statusIcon.prependTo(this.$statusContainer);\n        return $statusIcon;\n      }\n\n      return $prevIcon;\n    }\n  }, {\n    key: \"_updateTitleForWindow\",\n    value: function _updateTitleForWindow() {\n      var formTitle = strings.join(' - ', this.title, this.subTitle),\n          applicationTitle = this.session.desktop.title;\n      this.popupWindow.title(formTitle || applicationTitle);\n    }\n  }, {\n    key: \"_updateTitleForDom\",\n    value: function _updateTitleForDom() {\n      var titleText = this.title;\n\n      if (!titleText && this.closable) {\n        // Add '&nbsp;' to prevent title-box of a closable form from collapsing if title is empty\n        titleText = strings.plainText('&nbsp;');\n      }\n\n      if (titleText || this.subTitle) {\n        var $titles = getOrAppendChildDiv(this.$container, 'title-box'); // Render title\n\n        if (titleText) {\n          getOrAppendChildDiv($titles, 'title').text(titleText).icon(this.iconId);\n        } else {\n          removeChildDiv($titles, 'title');\n        } // Render subTitle\n\n\n        if (strings.hasText(titleText)) {\n          getOrAppendChildDiv($titles, 'sub-title').text(this.subTitle);\n        } else {\n          removeChildDiv($titles, 'sub-title');\n        }\n      } else {\n        removeChildDiv(this.$container, 'title-box');\n      } // ----- Helper functions -----\n\n\n      function getOrAppendChildDiv($parent, cssClass) {\n        var $div = $parent.children('.' + cssClass);\n\n        if ($div.length === 0) {\n          $div = this.$parent.appendDiv(cssClass);\n        }\n\n        return $div;\n      }\n\n      function removeChildDiv($parent, cssClass) {\n        $parent.children('.' + cssClass).remove();\n      }\n    }\n  }, {\n    key: \"isDialog\",\n    value: function isDialog() {\n      return this.displayHint === Form.DisplayHint.DIALOG;\n    }\n  }, {\n    key: \"isPopupWindow\",\n    value: function isPopupWindow() {\n      return this.displayHint === Form.DisplayHint.POPUP_WINDOW;\n    }\n  }, {\n    key: \"isView\",\n    value: function isView() {\n      return this.displayHint === Form.DisplayHint.VIEW;\n    }\n  }, {\n    key: \"_onMove\",\n    value: function _onMove(newOffset) {\n      this.trigger('move', newOffset);\n      this.updateCacheBounds();\n    }\n  }, {\n    key: \"updateCacheBounds\",\n    value: function updateCacheBounds() {\n      if (this.cacheBounds) {\n        this.storeCacheBounds(this.htmlComp.bounds());\n      }\n    }\n  }, {\n    key: \"appendTo\",\n    value: function appendTo($parent) {\n      this.$container.appendTo($parent);\n    }\n  }, {\n    key: \"setTitle\",\n    value: function setTitle(title) {\n      this.setProperty('title', title);\n    }\n  }, {\n    key: \"_renderTitle\",\n    value: function _renderTitle() {\n      if (this.isDialog()) {\n        this.$title.text(this.title);\n        this.$header.toggleClass('no-title', !this.title && !this.subTitle);\n      } else if (this.isPopupWindow()) {\n        this._updateTitleForWindow();\n      } // Layout could have been changed, e.g. if subtitle becomes visible\n\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"setSubTitle\",\n    value: function setSubTitle(subTitle) {\n      this.setProperty('subTitle', subTitle);\n    }\n  }, {\n    key: \"_renderSubTitle\",\n    value: function _renderSubTitle() {\n      if (this.isDialog()) {\n        this.$subTitle.text(this.subTitle);\n        this.$header.toggleClass('no-title', !this.title && !this.subTitle);\n      } else if (this.isPopupWindow()) {\n        this._updateTitleForWindow();\n      } // Layout could have been changed, e.g. if subtitle becomes visible\n\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"setIconId\",\n    value: function setIconId(iconId) {\n      this.setProperty('iconId', iconId);\n    }\n  }, {\n    key: \"_renderIconId\",\n    value: function _renderIconId() {\n      if (this.isDialog()) {\n        this.$icon.icon(this.iconId); // Layout could have been changed, e.g. if subtitle becomes visible\n\n        this.invalidateLayoutTree();\n      }\n    }\n  }, {\n    key: \"_setViews\",\n    value: function _setViews(views) {\n      if (views) {\n        views.forEach(function (view) {\n          view.setDisplayParent(this);\n        }.bind(this));\n      }\n\n      this._setProperty('views', views);\n    }\n    /**\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"setDisabledStyle\",\n    value: function setDisabledStyle(disabledStyle) {\n      this.rootGroupBox.setDisabledStyle(disabledStyle);\n    }\n  }, {\n    key: \"setDisplayParent\",\n    value: function setDisplayParent(displayParent) {\n      this.setProperty('displayParent', displayParent);\n    }\n  }, {\n    key: \"_setDisplayParent\",\n    value: function _setDisplayParent(displayParent) {\n      if (displayParent instanceof Form && displayParent.parent instanceof WrappedFormField && displayParent.isView()) {\n        displayParent = Form.findNonWrappedForm(displayParent);\n      }\n\n      this._setProperty('displayParent', displayParent);\n\n      if (displayParent) {\n        this.setParent(this.findDesktop().computeParentForDisplayParent(displayParent));\n      }\n    }\n  }, {\n    key: \"_attach\",\n    value: function _attach() {\n      this.$parent.append(this.$container); // If the parent was resized while this view was detached, the view has a wrong size.\n\n      if (this.isView()) {\n        this.invalidateLayoutTree(false);\n      } // form is attached even if children are not yet\n\n\n      if ((this.isView() || this.isDialog()) && !this.detailForm) {\n        // notify model this form is active\n        this.session.desktop._setFormActivated(this);\n      }\n\n      _get(_getPrototypeOf(Form.prototype), \"_attach\", this).call(this);\n    }\n    /**\n     * Method invoked when:\n     *  - this is a 'detailForm' and the outline content is displayed;\n     *  - this is a 'view' and the view tab is selected;\n     *  - this is a child 'dialog' or 'view' and its 'displayParent' is attached;\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"_postAttach\",\n    value: function _postAttach() {\n      // Attach child dialogs, message boxes and file choosers.\n      this.formController.attachDialogs();\n      this.messageBoxController.attach();\n      this.fileChooserController.attach();\n\n      _get(_getPrototypeOf(Form.prototype), \"_attach\", this).call(this);\n    }\n    /**\n     * Method invoked when:\n     *  - this is a 'detailForm' and the outline content is hidden;\n     *  - this is a 'view' and the view tab is deselected;\n     *  - this is a child 'dialog' or 'view' and its 'displayParent' is detached;\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"_detach\",\n    value: function _detach() {\n      // Detach child dialogs, message boxes and file choosers, not views.\n      this.formController.detachDialogs();\n      this.messageBoxController.detach();\n      this.fileChooserController.detach();\n      this.$container.detach();\n\n      _get(_getPrototypeOf(Form.prototype), \"_detach\", this).call(this);\n    }\n  }, {\n    key: \"renderInitialFocus\",\n    value: function renderInitialFocus() {\n      var focused = false;\n\n      if (this.initialFocus) {\n        focused = this.initialFocus.focus();\n      } else {\n        // If no explicit focus is requested, try to focus the first focusable element.\n        // Do it only if the focus is not already on an element in the form (e.g. focus could have been requested explicitly by a child element)\n        // And only if the context belonging to that element is ready. Not ready means, some other widget (probably an outer container) is still preparing the context and will do the initial focus later\n        if (!this.$container.isOrHas(this.$container.activeElement())) {\n          var focusManager = this.session.focusManager;\n          focused = focusManager.requestFocusIfReady(focusManager.findFirstFocusableElement(this.$container));\n        }\n      }\n\n      if (focused) {\n        // If the focus widget is outside of the view area the browser tries to scroll the widget into view.\n        // If the scroll area contains large (not absolutely positioned) content it can happen that the browsers scrolls the content even though the focused widget already is in the view area.\n        // This is probably because the focus happens while the form is not layouted yet. We should actually refactor this and do the focusing after layouting, but this would be a bigger change.\n        // The current workaround is to revert the scrolling done by the browser. Automatic scrolling to the focused widget when the form is not layouted does not work anyway.\n        var $scrollParent = this.$container.activeElement().scrollParent();\n        $scrollParent.scrollTop(0);\n        $scrollParent.scrollLeft(0);\n      }\n    }\n    /**\n     * This method returns the HtmlElement (DOM node) which is used by FocusManager/FocusContext/Popup\n     * to focus the initial element. The impl. of these classes relies on HtmlElements, so we can not\n     * easily use the focus() method of FormField here. Furthermore, some classes like Button\n     * are sometimes 'adapted' by a ButtonAdapterMenu, which means the Button itself is not rendered, but\n     * we must know the $container of the adapter menu to focus the correct element. That's why we call\n     * the getFocusableElement() method.\n     */\n\n  }, {\n    key: \"_initialFocusElement\",\n    value: function _initialFocusElement() {\n      var focusElement;\n\n      if (this.initialFocus) {\n        focusElement = this.initialFocus.getFocusableElement();\n      }\n\n      if (!focusElement) {\n        focusElement = this.session.focusManager.findFirstFocusableElement(this.$container);\n      }\n\n      return focusElement;\n    }\n  }, {\n    key: \"_installFocusContext\",\n    value: function _installFocusContext() {\n      if (this.isDialog() || this.isPopupWindow()) {\n        this.session.focusManager.installFocusContext(this.$container, FocusRule.NONE);\n      }\n    }\n  }, {\n    key: \"_uninstallFocusContext\",\n    value: function _uninstallFocusContext() {\n      if (this.isDialog() || this.isPopupWindow()) {\n        this.session.focusManager.uninstallFocusContext(this.$container);\n      }\n    }\n  }, {\n    key: \"touch\",\n    value: function touch() {\n      this.rootGroupBox.touch();\n    }\n    /**\n     * Function required for objects that act as 'displayParent'.\n     *\n     * @return 'true' if this Form is currently accessible to the user\n     */\n\n  }, {\n    key: \"inFront\",\n    value: function inFront() {\n      return this.rendered && this.attached;\n    }\n    /**\n     * Visits all form-fields of this form in pre-order (top-down).\n     */\n\n  }, {\n    key: \"visitFields\",\n    value: function visitFields(visitor) {\n      this.rootGroupBox.visitFields(visitor);\n    }\n    /**\n     * Visits all dialogs, messageBoxes and fileChoosers of this form in pre-order (top-down).\n     * filter is an optional parameter.\n     */\n\n  }, {\n    key: \"visitDisplayChildren\",\n    value: function visitDisplayChildren(visitor, filter) {\n      if (!filter) {\n        filter = function filter(displayChild) {\n          return true;\n        };\n      }\n\n      var visitorFunc = function visitorFunc(child) {\n        visitor(child); // only forms provide a deeper hierarchy\n\n        if (child instanceof Form) {\n          child.visitDisplayChildren(visitor, filter);\n        }\n      };\n\n      this.dialogs.filter(filter).forEach(visitorFunc, this);\n      this.messageBoxes.filter(filter).forEach(visitorFunc, this);\n      this.fileChoosers.filter(filter).forEach(visitorFunc, this);\n    }\n  }, {\n    key: \"storeCacheBounds\",\n    value: function storeCacheBounds(bounds) {\n      if (this.cacheBounds) {\n        var storageKey = 'scout:formBounds:' + this.cacheBoundsKey;\n        webstorage.setItem(localStorage, storageKey, JSON.stringify(bounds));\n      }\n    }\n  }, {\n    key: \"readCacheBounds\",\n    value: function readCacheBounds() {\n      if (!this.cacheBounds) {\n        return null;\n      }\n\n      var storageKey = 'scout:formBounds:' + this.cacheBoundsKey;\n      var bounds = webstorage.getItem(localStorage, storageKey);\n\n      if (!bounds) {\n        return null;\n      }\n\n      bounds = JSON.parse(bounds);\n      return new Rectangle(bounds.x, bounds.y, bounds.width, bounds.height);\n    }\n    /**\n     * @returns {Form} the form the widget belongs to (returns the first parent which is a {@link Form}.\n     */\n\n  }], [{\n    key: \"findForm\",\n    value: function findForm(widget) {\n      var parent = widget.parent;\n\n      while (parent && !(parent instanceof Form)) {\n        parent = parent.parent;\n      }\n\n      return parent;\n    }\n    /**\n     * @returns {Form} the first form which is not an inner form of a wrapped form field\n     */\n\n  }, {\n    key: \"findNonWrappedForm\",\n    value: function findNonWrappedForm(widget) {\n      if (!widget) {\n        return null;\n      }\n\n      var form = null;\n      widget.findParent(function (parent) {\n        if (parent instanceof Form) {\n          form = parent; // If form is an inner form of a wrapped form field -> continue search\n\n          if (form.parent instanceof WrappedFormField) {\n            return false;\n          } // Otherwise use that form\n\n\n          return true;\n        }\n      });\n      return form;\n    }\n  }]);\n\n  return Form;\n}(Widget);\n\n_defineProperty(Form, \"DisplayHint\", {\n  DIALOG: 'dialog',\n  POPUP_WINDOW: 'popupWindow',\n  VIEW: 'view'\n});\n\nexport { Form as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/form/Form.js"],"names":["Button","DialogLayout","Event","FileChooserController","FocusRule","FormLayout","GlassPaneRenderer","GroupBox","HtmlComponent","MessageBoxController","Rectangle","scout","Status","strings","tooltips","webstorage","Widget","WrappedFormField","$","Form","_addWidgetProperties","_addPreserveOnPropertyChangeProperties","askIfNeedSave","askIfNeedSaveText","data","displayHint","DisplayHint","DIALOG","displayParent","maximizeEnabled","maximized","minimizeEnabled","minimized","modal","logicalGrid","create","dialogs","views","messageBoxes","fileChoosers","focusedElement","closable","cacheBounds","cacheBoundsKey","resizable","rootGroupBox","saveNeeded","saveNeededVisible","formController","messageBoxController","fileChooserController","_glassPaneRenderer","renderInitialFocusEnabled","$statusIcons","$header","$statusContainer","$close","$saveNeeded","$icon","$title","$subTitle","model","resolveTextKeys","resolveIconIds","_setDisplayParent","_setViews","session","_setRootGroupBox","_setStatus","status","nvl","objectType","_installLifecycle","_renderForm","_renderTitle","_renderSubTitle","_renderIconId","_renderClosable","_renderSaveNeeded","_renderCssClass","_renderStatus","_renderModal","_installFocusContext","renderInitialFocus","render","renderGlassPanes","remove","removeGlassPanes","_uninstallFocusContext","layout","$handle","$container","$parent","appendDiv","addClass","isDialog","uiCssClass","htmlComp","install","validateRoot","draggable","throttle","_onMove","bind","_initResizable","_renderHeader","addEventListener","_onDialogMouseDown","setLayout","focus","setProperty","parent","lifecycle","_createLifecycle","handle","_onLifecycleLoad","_onLifecycleSave","on","_onLifecyclePostLoad","_onLifecycleReset","_onLifecycleClose","widget","load","then","destroyed","show","when","_load","setData","importData","trigger","catch","error","_handleLoadError","destroy","resolvedPromise","_postLoad","ok","save","exportData","_save","reset","cancel","close","event","defaultPrevented","_close","hide","_abort","hasCloseButton","controls","concat","menus","filter","control","enabled","enabledComputed","undefined","visible","systemType","SystemType","NONE","some","CLOSE","toggleClass","_onCloseIconClick","abort","_onResize","autoSizeOld","autoSize","revalidateLayout","updateCacheBounds","activate","desktop","activateForm","showForm","hideForm","installForEllipsis","_setProperty","setMainBox","searchForm","setMenuBarPosition","MenuBarPosition","BOTTOM","beforeDiv","removeClass","invalidateLayoutTree","setAskIfNeedSave","cssClass","oldCssClass","ensure","forEach","$icn","statusList","asFlatList","$prevIcon","sts","_renderSingleStatus","push","iconId","$statusIcon","appendIcon","prependTo","formTitle","join","title","subTitle","applicationTitle","popupWindow","titleText","plainText","$titles","getOrAppendChildDiv","text","icon","removeChildDiv","hasText","$div","children","length","POPUP_WINDOW","VIEW","newOffset","storeCacheBounds","bounds","appendTo","isPopupWindow","_updateTitleForWindow","view","setDisplayParent","disabledStyle","setDisabledStyle","isView","findNonWrappedForm","setParent","findDesktop","computeParentForDisplayParent","append","detailForm","_setFormActivated","attachDialogs","attach","detachDialogs","detach","focused","initialFocus","isOrHas","activeElement","focusManager","requestFocusIfReady","findFirstFocusableElement","$scrollParent","scrollParent","scrollTop","scrollLeft","focusElement","getFocusableElement","installFocusContext","uninstallFocusContext","touch","rendered","attached","visitor","visitFields","displayChild","visitorFunc","child","visitDisplayChildren","storageKey","setItem","localStorage","JSON","stringify","getItem","parse","x","y","width","height","form","findParent"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {\n  Button,\n  DialogLayout,\n  Event,\n  FileChooserController,\n  FocusRule,\n  FormLayout,\n  GlassPaneRenderer,\n  GroupBox,\n  HtmlComponent,\n  MessageBoxController,\n  Rectangle,\n  scout,\n  Status,\n  strings,\n  tooltips,\n  webstorage,\n  Widget,\n  WrappedFormField\n} from '../index';\nimport $ from 'jquery';\n\nexport default class Form extends Widget {\n  constructor() {\n    super();\n    this._addWidgetProperties(['rootGroupBox', 'views', 'dialogs', 'initialFocus', 'messageBoxes', 'fileChoosers']);\n    this._addPreserveOnPropertyChangeProperties(['initialFocus']);\n\n    this.askIfNeedSave = true;\n    this.askIfNeedSaveText = null; // if not set, a default text is used (see Lifecycle.js)\n    this.data = {};\n    this.displayHint = Form.DisplayHint.DIALOG;\n    this.displayParent = null; // only relevant if form is opened, not relevant if form is just rendered into another widget (not managed by a form controller)\n    this.maximizeEnabled = true;\n    this.maximized = false;\n    this.minimizeEnabled = true;\n    this.minimized = false;\n    this.modal = true;\n    this.logicalGrid = scout.create('FormGrid');\n    this.dialogs = [];\n    this.views = [];\n    this.messageBoxes = [];\n    this.fileChoosers = [];\n    this.focusedElement = null;\n    this.closable = true;\n    this.cacheBounds = false;\n    this.cacheBoundsKey = null;\n    this.resizable = true;\n    this.rootGroupBox = null;\n    this.saveNeeded = false;\n    this.saveNeededVisible = false;\n    this.formController = null;\n    this.messageBoxController = null;\n    this.fileChooserController = null;\n    this._glassPaneRenderer = null;\n    /**\n     * Whether this form should render its initial focus\n     */\n    this.renderInitialFocusEnabled = true;\n\n    this.$statusIcons = [];\n    this.$header = null;\n    this.$statusContainer = null;\n    this.$close = null;\n    this.$saveNeeded = null;\n    this.$icon = null;\n    this.$title = null;\n    this.$subTitle = null;\n  }\n\n  static DisplayHint = {\n    DIALOG: 'dialog',\n    POPUP_WINDOW: 'popupWindow',\n    VIEW: 'view'\n  };\n\n  _init(model) {\n    super._init(model);\n\n    this.resolveTextKeys(['title', 'askIfNeedSaveText']);\n    this.resolveIconIds(['iconId']);\n    this._setDisplayParent(this.displayParent);\n    this._setViews(this.views);\n    this.formController = scout.create('FormController', {\n      displayParent: this,\n      session: this.session\n    });\n\n    this.messageBoxController = new MessageBoxController(this, this.session);\n    this.fileChooserController = new FileChooserController(this, this.session);\n\n    this._setRootGroupBox(this.rootGroupBox);\n    this._setStatus(this.status);\n    this.cacheBoundsKey = scout.nvl(model.cacheBoundsKey, this.objectType);\n    this._installLifecycle();\n  }\n\n  _render() {\n    this._renderForm();\n  }\n\n  /**\n   * @override Widget.js\n   */\n  _renderProperties() {\n    super._renderProperties();\n    this._renderTitle();\n    this._renderSubTitle();\n    this._renderIconId();\n    this._renderClosable();\n    this._renderSaveNeeded();\n    this._renderCssClass();\n    this._renderStatus();\n    this._renderModal();\n\n    this._installFocusContext();\n    if (this.renderInitialFocusEnabled) {\n      this.renderInitialFocus();\n    }\n  }\n\n  _postRender() {\n    super._postRender();\n\n    // Render attached forms, message boxes and file choosers.\n    this.formController.render();\n    this.messageBoxController.render();\n    this.fileChooserController.render();\n\n    if (this._glassPaneRenderer) {\n      this._glassPaneRenderer.renderGlassPanes();\n    }\n  }\n\n  _destroy() {\n    super._destroy();\n    if (this._glassPaneRenderer) {\n      this._glassPaneRenderer = null;\n    }\n  }\n\n  _remove() {\n    this.formController.remove();\n    this.messageBoxController.remove();\n    this.fileChooserController.remove();\n    if (this._glassPaneRenderer) {\n      this._glassPaneRenderer.removeGlassPanes();\n      this._glassPaneRenderer = null;\n    }\n\n    this._uninstallFocusContext();\n\n    this.$statusIcons = [];\n    this.$header = null;\n    this.$statusContainer = null;\n    this.$close = null;\n    this.$saveNeeded = null;\n    this.$icon = null;\n    this.$title = null;\n    this.$subTitle = null;\n\n    super._remove();\n  }\n\n  _renderForm() {\n    var layout, $handle;\n\n    this.$container = this.$parent.appendDiv()\n      .addClass(this.isDialog() ? 'dialog' : 'form')\n      .data('model', this);\n\n    if (this.uiCssClass) {\n      this.$container.addClass(this.uiCssClass);\n    }\n\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n    if (this.isDialog()) {\n      layout = new DialogLayout(this);\n      this.htmlComp.validateRoot = true;\n      $handle = this.$container.appendDiv('drag-handle');\n      this.$container.draggable($handle, $.throttle(this._onMove.bind(this), 1000 / 60)); // 60fps\n      if (this.resizable) {\n        this._initResizable();\n      }\n      this._renderHeader();\n      // Attach to capture phase to activate focus context before regular mouse down handlers may set the focus.\n      // E.g. clicking a check box label on another dialog executes mouse down handler of the check box which will focus the box. This only works if the focus context of the dialog is active.\n      this.$container[0].addEventListener('mousedown', this._onDialogMouseDown.bind(this), true);\n    } else {\n      layout = new FormLayout(this);\n    }\n\n    this.htmlComp.setLayout(layout);\n    this.rootGroupBox.render();\n  }\n\n  _renderFocusedElement() {\n    if (this.focusedElement) {\n      this.focusedElement.focus();\n      this.focusedElement = null;\n    }\n  }\n\n  setModal(modal) {\n    this.setProperty('modal', modal);\n  }\n\n  _renderModal() {\n    if (this.parent instanceof WrappedFormField) {\n      return;\n    }\n    if (this.modal && !this._glassPaneRenderer) {\n      this._glassPaneRenderer = new GlassPaneRenderer(this);\n      this._glassPaneRenderer.renderGlassPanes();\n    } else if (!this.modal && this._glassPaneRenderer) {\n      this._glassPaneRenderer.removeGlassPanes();\n      this._glassPaneRenderer = null;\n    }\n  }\n\n  _installLifecycle() {\n    this.lifecycle = this._createLifecycle();\n    this.lifecycle.handle('load', this._onLifecycleLoad.bind(this));\n    this.lifecycle.handle('save', this._onLifecycleSave.bind(this));\n    this.lifecycle.on('postLoad', this._onLifecyclePostLoad.bind(this));\n    this.lifecycle.on('reset', this._onLifecycleReset.bind(this));\n    this.lifecycle.on('close', this._onLifecycleClose.bind(this));\n  }\n\n  _createLifecycle() {\n    return scout.create('FormLifecycle', {\n      widget: this,\n      askIfNeedSave: this.askIfNeedSave,\n      askIfNeedSaveText: this.askIfNeedSaveText\n    });\n  }\n\n  /**\n   * Loads the data and renders the form afterwards by adding it to the desktop.\n   * <p>\n   * Calling this method is equivalent to calling load() first and once the promise is resolved, calling show().\n   * <p>\n   * Keep in mind that the form won't be rendered immediately after calling {@link open}. Because promises are always resolved asynchronously,\n   * {@link show} will be called delayed even if {@link load} does nothing but return a resolved promise.<br>\n   * This is only relevant if you need to access properties which are only available when the form is rendered (e.g. $container), which is not recommended anyway.\n   * <p>\n   *\n   * @returns {Promise} the promise returned by the {@link load} function.\n   */\n  open() {\n    return this.load()\n      .then(function() {\n        if (this.destroyed) {\n          // If form has been closed right after it was opened don't try to show it\n          return;\n        }\n        this.show();\n      }.bind(this));\n  }\n\n  /**\n   * Initializes the life cycle and calls the {@link _load} function.\n   * @returns {Promise} promise which is resolved when the form is loaded.\n   */\n  load() {\n    return this.lifecycle.load();\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is loaded, respectively when the 'load' event is triggered'.\n   */\n  whenLoad() {\n    return this.when('load');\n  }\n\n  /**\n   * Lifecycle handle function registered for 'load'.\n   *\n   * @returns {Promise<T | void>|void}\n   */\n  _onLifecycleLoad() {\n    try {\n      return this._load()\n        .then(data => {\n          if (this.destroyed) {\n            // If form has been closed right after it was opened ignore the load result\n            return;\n          }\n          this.setData(data);\n          this.importData();\n          this.trigger('load');\n        }).catch(error => {\n          return this._handleLoadError(error);\n        });\n    } catch (error) {\n      return this._handleLoadError(error);\n    }\n  }\n\n  /**\n   * This function is called when an error occurs while the <code>_load</code> function is called or when the <code>_load</code> function returns with a rejected promise.\n   * By default the Form is destroyed and the error re-thrown so a caller of <code>Form.load()</code> may catch the error.\n   *\n   * @param error\n   */\n  _handleLoadError(error) {\n    this.destroy();\n    throw error;\n  }\n\n  /**\n   * Method may be implemented to load the data. By default, the provided this.data is returned.\n   */\n  _load() {\n    return $.resolvedPromise().then(function() {\n      return this.data;\n    }.bind(this));\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is post loaded, respectively when the 'postLoad' event is triggered'.\n   */\n  whenPostLoad() {\n    return this.when('postLoad');\n  }\n\n  _onLifecyclePostLoad() {\n    return this._postLoad().then(function() {\n      this.trigger('postLoad');\n    }.bind(this));\n  }\n\n  _postLoad() {\n    return $.resolvedPromise();\n  }\n\n  setData(data) {\n    this.setProperty('data', data);\n  }\n\n  importData() {\n    // NOP\n  }\n\n  exportData() {\n    // NOP\n  }\n\n  /**\n   * Saves and closes the form.\n   * @returns {Promise} promise which is resolved when the form is closed.\n   */\n  ok() {\n    return this.lifecycle.ok();\n  }\n\n  /**\n   * Saves the changes without closing the form.\n   * @returns {Promise} promise which is resolved when the form is saved\n   *    Note: it will be resolved even if the form does not require save and therefore even if {@link @_save} is not called.\n   *    If you only want to be informed when save is required and {@link @_save} executed then you could use {@link whenSave()} or {@link on('save')} instead.\n   */\n  save() {\n    return this.lifecycle.save();\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is saved, respectively when the 'save' event is triggered'.\n   */\n  whenSave() {\n    return this.when('save');\n  }\n\n  _onLifecycleSave() {\n    var data = this.exportData();\n    return this._save(data).then(function(status) {\n      this.setData(data);\n      this.trigger('save');\n      return status;\n    }.bind(this));\n  }\n\n  /**\n   * This function is called by the lifecycle, for instance when the 'ok' function is called.\n   * The function is called every time the 'ok' function is called, which means it runs even when\n   * there is not a single touched field. The function should be used to implement an overall validate\n   * logic which is not related to a specific field. For instance you could validate the state of an\n   * internal member variable.\n   * <p>\n   * You should return a Status object with severity ERROR in case the validation fails.\n   *\n   * @return Status\n   */\n  _validate() {\n    return Status.ok();\n  }\n\n  /**\n   * This function is called by the lifecycle, when the 'save' function is called.<p>\n   * The data given to this function is the result of 'exportData' which was called in advance.\n   *\n   * @returns {Promise} promise which may contain a Status specifying if the save operation was successful. The promise may be empty which means the save operation was successful.\n   */\n  _save(data) {\n    return $.resolvedPromise();\n  }\n\n  /**\n   * Resets the form to its initial state.\n   * @returns {Promise}.\n   */\n  reset() {\n    this.lifecycle.reset();\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is reset, respectively when the 'reset' event is triggered'.\n   */\n  whenReset() {\n    return this.when('reset');\n  }\n\n  _onLifecycleReset() {\n    this.trigger('reset');\n  }\n\n  /**\n   * Closes the form if there are no changes made. Otherwise it shows a message box asking to save the changes.\n   * @returns {Promise}.\n   */\n  cancel() {\n    return this.lifecycle.cancel();\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is cancelled, respectively when the 'cancel' event is triggered'.\n   */\n  whenCancel() {\n    return this.when('cancel');\n  }\n\n  /**\n   * Closes the form and discards any unsaved changes.\n   * @returns {Promise}.\n   */\n  close() {\n    return this.lifecycle.close();\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is closed, respectively when the 'close' event is triggered'.\n   */\n  whenClose() {\n    return this.when('close');\n  }\n\n  /**\n   * Destroys the form and removes it from the desktop.\n   */\n  _onLifecycleClose() {\n    var event = new Event();\n    this.trigger('close', event);\n    if (!event.defaultPrevented) {\n      this._close();\n    }\n  }\n\n  _close() {\n    this.hide();\n    this.destroy();\n  }\n\n  /**\n   * This function is called when the user presses the \"x\" icon.<p>\n   * It will either call {@link #close()} or {@link #cancel()), depending on the enabled and visible system buttons, see {@link _abort}.\n   */\n  abort() {\n    var event = new Event();\n    this.trigger('abort', event);\n    if (!event.defaultPrevented) {\n      this._abort();\n    }\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the form is aborted, respectively when the 'abort' event is triggered'.\n   */\n  whenAbort() {\n    return this.when('abort');\n  }\n\n  /**\n   * Will call {@link #close()} if there is a close menu or button, otherwise {@link #cancel()) will be called.\n */\n  _abort() {\n    // Search for a close button in the menus and buttons of the root group box\n    var hasCloseButton = this.rootGroupBox.controls\n      .concat(this.rootGroupBox.menus)\n      .filter(function(control) {\n        var enabled = control.enabled;\n        if (control.enabledComputed !== undefined) {\n          enabled = control.enabledComputed; // Menus don't have enabledComputed, only form fields\n        }\n        return control.visible && enabled && control.systemType && control.systemType !== Button.SystemType.NONE;\n      })\n      .some(function(control) {\n        return control.systemType === Button.SystemType.CLOSE;\n      });\n\n    if (hasCloseButton) {\n      this.close();\n    } else {\n      this.cancel();\n    }\n  }\n\n  setClosable(closable) {\n    this.setProperty('closable', closable);\n  }\n\n  _renderClosable() {\n    if (!this.isDialog()) {\n      return;\n    }\n    this.$container.toggleClass('closable');\n    if (this.closable) {\n      if (this.$close) {\n        return;\n      }\n      this.$close = this.$statusContainer.appendDiv('status closer')\n        .on('click', this._onCloseIconClick.bind(this));\n    } else {\n      if (!this.$close) {\n        return;\n      }\n      this.$close.remove();\n      this.$close = null;\n    }\n  }\n\n  _onCloseIconClick() {\n    this.abort();\n  }\n\n  _initResizable() {\n    this.$container\n      .resizable()\n      .on('resize', this._onResize.bind(this));\n  }\n\n  _onResize(event) {\n    var autoSizeOld = this.htmlComp.layout.autoSize;\n    this.htmlComp.layout.autoSize = false;\n    this.htmlComp.revalidateLayout();\n    this.htmlComp.layout.autoSize = autoSizeOld;\n    this.updateCacheBounds();\n    return false;\n  }\n\n  _onDialogMouseDown() {\n    this.activate();\n  }\n\n  activate() {\n    this.session.desktop.activateForm(this);\n  }\n\n  show() {\n    this.session.desktop.showForm(this);\n  }\n\n  hide() {\n    this.session.desktop.hideForm(this);\n  }\n\n  _renderHeader() {\n    if (this.isDialog()) {\n      this.$header = this.$container.appendDiv('header');\n      this.$statusContainer = this.$header.appendDiv('status-container');\n      this.$icon = this.$header.appendDiv('icon-container');\n\n      this.$title = this.$header.appendDiv('title');\n      tooltips.installForEllipsis(this.$title, {\n        parent: this\n      });\n\n      this.$subTitle = this.$header.appendDiv('sub-title');\n      tooltips.installForEllipsis(this.$subTitle, {\n        parent: this\n      });\n    }\n  }\n\n  _setRootGroupBox(rootGroupBox) {\n    this._setProperty('rootGroupBox', rootGroupBox);\n    if (this.rootGroupBox) {\n      this.rootGroupBox.setMainBox(true);\n\n      if (this.isDialog() || this.searchForm || this.parent instanceof WrappedFormField) {\n        this.rootGroupBox.setMenuBarPosition(GroupBox.MenuBarPosition.BOTTOM);\n      }\n    }\n  }\n\n  _renderSaveNeeded() {\n    if (!this.isDialog()) {\n      return;\n    }\n    if (this.saveNeeded && this.saveNeededVisible) {\n      this.$container.addClass('save-needed');\n      if (this.$saveNeeded) {\n        return;\n      }\n      if (this.$close) {\n        this.$saveNeeded = this.$close.beforeDiv('status save-needer');\n      } else {\n        this.$saveNeeded = this.$statusContainer\n          .appendDiv('status save-needer');\n      }\n    } else {\n      this.$container.removeClass('save-needed');\n      if (!this.$saveNeeded) {\n        return;\n      }\n      this.$saveNeeded.remove();\n      this.$saveNeeded = null;\n    }\n    // Layout could have been changed, e.g. if subtitle becomes visible\n    this.invalidateLayoutTree();\n  }\n\n  setAskIfNeedSave(askIfNeedSave) {\n    this.setProperty('askIfNeedSave', askIfNeedSave);\n    if (this.lifecycle) {\n      this.lifecycle.setAskIfNeedSave(askIfNeedSave);\n    }\n  }\n\n  setDisplayHint(displayHint) {\n    this.setProperty('displayHint', displayHint);\n  }\n\n  setSaveNeededVisible(visible) {\n    this.setProperty('saveNeededVisible', visible);\n  }\n\n  _renderSaveNeededVisible() {\n    this._renderSaveNeeded();\n  }\n\n  _renderCssClass(cssClass, oldCssClass) {\n    cssClass = cssClass || this.cssClass;\n    this.$container.removeClass(oldCssClass);\n    this.$container.addClass(cssClass);\n    // Layout could have been changed, e.g. if subtitle becomes visible\n    this.invalidateLayoutTree();\n  }\n\n  setStatus(status) {\n    this.setProperty('status', status);\n  }\n\n  _setStatus(status) {\n    status = Status.ensure(status);\n    this._setProperty('status', status);\n  }\n\n  _renderStatus() {\n    if (!this.isDialog()) {\n      return;\n    }\n\n    this.$statusIcons.forEach(function($icn) {\n      $icn.remove();\n    });\n\n    this.$statusIcons = [];\n\n    if (this.status) {\n      var statusList = this.status.asFlatList();\n      var $prevIcon;\n      statusList.forEach(function(sts) {\n        $prevIcon = this._renderSingleStatus(sts, $prevIcon);\n        if ($prevIcon) {\n          this.$statusIcons.push($prevIcon);\n        }\n      }.bind(this));\n    }\n    // Layout could have been changed, e.g. if subtitle becomes visible\n    this.invalidateLayoutTree();\n  }\n\n  _renderSingleStatus(status, $prevIcon) {\n    if (status && status.iconId) {\n      var $statusIcon = this.$statusContainer.appendIcon(status.iconId, 'status');\n      if (status.cssClass()) {\n        $statusIcon.addClass(status.cssClass());\n      }\n      $statusIcon.prependTo(this.$statusContainer);\n      return $statusIcon;\n    }\n    return $prevIcon;\n  }\n\n  _updateTitleForWindow() {\n    var formTitle = strings.join(' - ', this.title, this.subTitle),\n      applicationTitle = this.session.desktop.title;\n    this.popupWindow.title(formTitle || applicationTitle);\n  }\n\n  _updateTitleForDom() {\n    var titleText = this.title;\n    if (!titleText && this.closable) {\n      // Add '&nbsp;' to prevent title-box of a closable form from collapsing if title is empty\n      titleText = strings.plainText('&nbsp;');\n    }\n    if (titleText || this.subTitle) {\n      var $titles = getOrAppendChildDiv(this.$container, 'title-box');\n      // Render title\n      if (titleText) {\n        getOrAppendChildDiv($titles, 'title')\n          .text(titleText)\n          .icon(this.iconId);\n      } else {\n        removeChildDiv($titles, 'title');\n      }\n      // Render subTitle\n      if (strings.hasText(titleText)) {\n        getOrAppendChildDiv($titles, 'sub-title').text(this.subTitle);\n      } else {\n        removeChildDiv($titles, 'sub-title');\n      }\n    } else {\n      removeChildDiv(this.$container, 'title-box');\n    }\n\n    // ----- Helper functions -----\n\n    function getOrAppendChildDiv($parent, cssClass) {\n      var $div = $parent.children('.' + cssClass);\n      if ($div.length === 0) {\n        $div = this.$parent.appendDiv(cssClass);\n      }\n      return $div;\n    }\n\n    function removeChildDiv($parent, cssClass) {\n      $parent.children('.' + cssClass).remove();\n    }\n  }\n\n  isDialog() {\n    return this.displayHint === Form.DisplayHint.DIALOG;\n  }\n\n  isPopupWindow() {\n    return this.displayHint === Form.DisplayHint.POPUP_WINDOW;\n  }\n\n  isView() {\n    return this.displayHint === Form.DisplayHint.VIEW;\n  }\n\n  _onMove(newOffset) {\n    this.trigger('move', newOffset);\n    this.updateCacheBounds();\n  }\n\n  updateCacheBounds() {\n    if (this.cacheBounds) {\n      this.storeCacheBounds(this.htmlComp.bounds());\n    }\n  }\n\n  appendTo($parent) {\n    this.$container.appendTo($parent);\n  }\n\n  setTitle(title) {\n    this.setProperty('title', title);\n  }\n\n  _renderTitle() {\n    if (this.isDialog()) {\n      this.$title.text(this.title);\n      this.$header.toggleClass('no-title', !this.title && !this.subTitle);\n    } else if (this.isPopupWindow()) {\n      this._updateTitleForWindow();\n    }\n    // Layout could have been changed, e.g. if subtitle becomes visible\n    this.invalidateLayoutTree();\n  }\n\n  setSubTitle(subTitle) {\n    this.setProperty('subTitle', subTitle);\n  }\n\n  _renderSubTitle() {\n    if (this.isDialog()) {\n      this.$subTitle.text(this.subTitle);\n      this.$header.toggleClass('no-title', !this.title && !this.subTitle);\n    } else if (this.isPopupWindow()) {\n      this._updateTitleForWindow();\n    }\n    // Layout could have been changed, e.g. if subtitle becomes visible\n    this.invalidateLayoutTree();\n  }\n\n  setIconId(iconId) {\n    this.setProperty('iconId', iconId);\n  }\n\n  _renderIconId() {\n    if (this.isDialog()) {\n      this.$icon.icon(this.iconId);\n      // Layout could have been changed, e.g. if subtitle becomes visible\n      this.invalidateLayoutTree();\n    }\n  }\n\n  _setViews(views) {\n    if (views) {\n      views.forEach(function(view) {\n        view.setDisplayParent(this);\n      }.bind(this));\n    }\n    this._setProperty('views', views);\n  }\n\n  /**\n   * @override Widget.js\n   */\n  setDisabledStyle(disabledStyle) {\n    this.rootGroupBox.setDisabledStyle(disabledStyle);\n  }\n\n  setDisplayParent(displayParent) {\n    this.setProperty('displayParent', displayParent);\n  }\n\n  _setDisplayParent(displayParent) {\n    if (displayParent instanceof Form && displayParent.parent instanceof WrappedFormField && displayParent.isView()) {\n      displayParent = Form.findNonWrappedForm(displayParent);\n    }\n    this._setProperty('displayParent', displayParent);\n\n    if (displayParent) {\n      this.setParent(this.findDesktop().computeParentForDisplayParent(displayParent));\n    }\n  }\n\n  _attach() {\n    this.$parent.append(this.$container);\n\n    // If the parent was resized while this view was detached, the view has a wrong size.\n    if (this.isView()) {\n      this.invalidateLayoutTree(false);\n    }\n\n    // form is attached even if children are not yet\n    if ((this.isView() || this.isDialog()) && !this.detailForm) {\n      // notify model this form is active\n      this.session.desktop._setFormActivated(this);\n    }\n    super._attach();\n  }\n\n  /**\n   * Method invoked when:\n   *  - this is a 'detailForm' and the outline content is displayed;\n   *  - this is a 'view' and the view tab is selected;\n   *  - this is a child 'dialog' or 'view' and its 'displayParent' is attached;\n   * @override Widget.js\n   */\n  _postAttach() {\n    // Attach child dialogs, message boxes and file choosers.\n    this.formController.attachDialogs();\n    this.messageBoxController.attach();\n    this.fileChooserController.attach();\n\n    super._attach();\n  }\n\n  /**\n   * Method invoked when:\n   *  - this is a 'detailForm' and the outline content is hidden;\n   *  - this is a 'view' and the view tab is deselected;\n   *  - this is a child 'dialog' or 'view' and its 'displayParent' is detached;\n   * @override Widget.js\n   */\n  _detach() {\n    // Detach child dialogs, message boxes and file choosers, not views.\n    this.formController.detachDialogs();\n    this.messageBoxController.detach();\n    this.fileChooserController.detach();\n\n    this.$container.detach();\n    super._detach();\n  }\n\n  renderInitialFocus() {\n    var focused = false;\n    if (this.initialFocus) {\n      focused = this.initialFocus.focus();\n    } else {\n      // If no explicit focus is requested, try to focus the first focusable element.\n      // Do it only if the focus is not already on an element in the form (e.g. focus could have been requested explicitly by a child element)\n      // And only if the context belonging to that element is ready. Not ready means, some other widget (probably an outer container) is still preparing the context and will do the initial focus later\n      if (!this.$container.isOrHas(this.$container.activeElement())) {\n        var focusManager = this.session.focusManager;\n        focused = focusManager.requestFocusIfReady(focusManager.findFirstFocusableElement(this.$container));\n      }\n    }\n    if (focused) {\n      // If the focus widget is outside of the view area the browser tries to scroll the widget into view.\n      // If the scroll area contains large (not absolutely positioned) content it can happen that the browsers scrolls the content even though the focused widget already is in the view area.\n      // This is probably because the focus happens while the form is not layouted yet. We should actually refactor this and do the focusing after layouting, but this would be a bigger change.\n      // The current workaround is to revert the scrolling done by the browser. Automatic scrolling to the focused widget when the form is not layouted does not work anyway.\n      var $scrollParent = this.$container.activeElement().scrollParent();\n      $scrollParent.scrollTop(0);\n      $scrollParent.scrollLeft(0);\n    }\n  }\n\n  /**\n   * This method returns the HtmlElement (DOM node) which is used by FocusManager/FocusContext/Popup\n   * to focus the initial element. The impl. of these classes relies on HtmlElements, so we can not\n   * easily use the focus() method of FormField here. Furthermore, some classes like Button\n   * are sometimes 'adapted' by a ButtonAdapterMenu, which means the Button itself is not rendered, but\n   * we must know the $container of the adapter menu to focus the correct element. That's why we call\n   * the getFocusableElement() method.\n   */\n  _initialFocusElement() {\n    var focusElement;\n    if (this.initialFocus) {\n      focusElement = this.initialFocus.getFocusableElement();\n    }\n    if (!focusElement) {\n      focusElement = this.session.focusManager.findFirstFocusableElement(this.$container);\n    }\n    return focusElement;\n  }\n\n  _installFocusContext() {\n    if (this.isDialog() || this.isPopupWindow()) {\n      this.session.focusManager.installFocusContext(this.$container, FocusRule.NONE);\n    }\n  }\n\n  _uninstallFocusContext() {\n    if (this.isDialog() || this.isPopupWindow()) {\n      this.session.focusManager.uninstallFocusContext(this.$container);\n    }\n  }\n\n  touch() {\n    this.rootGroupBox.touch();\n  }\n\n  /**\n   * Function required for objects that act as 'displayParent'.\n   *\n   * @return 'true' if this Form is currently accessible to the user\n   */\n  inFront() {\n    return this.rendered && this.attached;\n  }\n\n  /**\n   * Visits all form-fields of this form in pre-order (top-down).\n   */\n  visitFields(visitor) {\n    this.rootGroupBox.visitFields(visitor);\n  }\n\n  /**\n   * Visits all dialogs, messageBoxes and fileChoosers of this form in pre-order (top-down).\n   * filter is an optional parameter.\n   */\n  visitDisplayChildren(visitor, filter) {\n    if (!filter) {\n      filter = function(displayChild) {\n        return true;\n      };\n    }\n\n    var visitorFunc = function(child) {\n      visitor(child);\n      // only forms provide a deeper hierarchy\n      if (child instanceof Form) {\n        child.visitDisplayChildren(visitor, filter);\n      }\n    };\n    this.dialogs.filter(filter).forEach(visitorFunc, this);\n    this.messageBoxes.filter(filter).forEach(visitorFunc, this);\n    this.fileChoosers.filter(filter).forEach(visitorFunc, this);\n  }\n\n  storeCacheBounds(bounds) {\n    if (this.cacheBounds) {\n      var storageKey = 'scout:formBounds:' + this.cacheBoundsKey;\n      webstorage.setItem(localStorage, storageKey, JSON.stringify(bounds));\n    }\n  }\n\n  readCacheBounds() {\n    if (!this.cacheBounds) {\n      return null;\n    }\n\n    var storageKey = 'scout:formBounds:' + this.cacheBoundsKey;\n    var bounds = webstorage.getItem(localStorage, storageKey);\n    if (!bounds) {\n      return null;\n    }\n    bounds = JSON.parse(bounds);\n    return new Rectangle(bounds.x, bounds.y, bounds.width, bounds.height);\n  }\n\n  /**\n   * @returns {Form} the form the widget belongs to (returns the first parent which is a {@link Form}.\n   */\n  static findForm(widget) {\n    var parent = widget.parent;\n    while (parent && !(parent instanceof Form)) {\n      parent = parent.parent;\n    }\n    return parent;\n  }\n\n  /**\n   * @returns {Form} the first form which is not an inner form of a wrapped form field\n   */\n  static findNonWrappedForm(widget) {\n    if (!widget) {\n      return null;\n    }\n    var form = null;\n    widget.findParent(function(parent) {\n      if (parent instanceof Form) {\n        form = parent;\n        // If form is an inner form of a wrapped form field -> continue search\n        if (form.parent instanceof WrappedFormField) {\n          return false;\n        }\n        // Otherwise use that form\n        return true;\n      }\n    });\n    return form;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}