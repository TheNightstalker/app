{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, CarouselLayout, events, GridData, HtmlComponent, SingleLayout, Widget } from '../index';\n\nvar Carousel = /*#__PURE__*/function (_Widget) {\n  _inherits(Carousel, _Widget);\n\n  var _super = _createSuper(Carousel);\n\n  function Carousel() {\n    var _this;\n\n    _classCallCheck(this, Carousel);\n\n    _this = _super.call(this);\n\n    _this._addWidgetProperties(['widgets']); // default values\n\n\n    _this.statusEnabled = true;\n    _this.statusItemHtml = '&bull;';\n    _this.currentItem = 0; // current item\n\n    _this.moveThreshold = 0.25; // threshold\n\n    _this.widgets = []; // widgets\n\n    _this.$carouselFilmstrip; // carousel filmstrip\n\n    _this.$carouselItems = []; // carousel items\n\n    _this.$carouselStatus; // carousel status bar (containing current position)\n\n    _this.$carouselStatusItems = []; // carousel status items\n\n    _this.positionX = 0; // last translation position\n\n    return _this;\n  }\n\n  _createClass(Carousel, [{\n    key: \"_init\",\n    value: function _init(model) {\n      _get(_getPrototypeOf(Carousel.prototype), \"_init\", this).call(this, model);\n\n      this._setGridData(this.gridData);\n\n      this.widgets = arrays.ensure(this.widgets);\n    }\n  }, {\n    key: \"_setGridData\",\n    value: function _setGridData(gridData) {\n      this._setProperty('gridData', new GridData(gridData));\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      // add container\n      this.$container = this.$parent.appendDiv('carousel');\n      this.htmlComp = HtmlComponent.install(this.$container, this.session);\n      this.htmlComp.setLayout(new CarouselLayout(this)); // add content filmstrip\n\n      this.$carouselFilmstrip = this.$container.appendDiv('carousel-filmstrip');\n\n      this._registerCarouselFilmstripEventListeners();\n\n      this.htmlCompFilmstrip = HtmlComponent.install(this.$carouselFilmstrip, this.session);\n    }\n  }, {\n    key: \"_remove\",\n    value: function _remove() {\n      this._removeStatus();\n\n      _get(_getPrototypeOf(Carousel.prototype), \"_remove\", this).call(this);\n    }\n  }, {\n    key: \"_renderProperties\",\n    value: function _renderProperties() {\n      _get(_getPrototypeOf(Carousel.prototype), \"_renderProperties\", this).call(this);\n\n      this._renderWidgets();\n\n      this._renderCurrentItem(); // must be called after renderWidgets\n\n\n      this._renderStatusEnabled();\n    }\n  }, {\n    key: \"setStatusEnabled\",\n    value: function setStatusEnabled(statusEnabled) {\n      this.setProperty('statusEnabled', statusEnabled);\n    }\n  }, {\n    key: \"_renderStatusEnabled\",\n    value: function _renderStatusEnabled() {\n      if (this.statusEnabled) {\n        this._renderStatus();\n\n        this._renderStatusItems();\n\n        this._renderCurrentStatusItem();\n      } else {\n        this._removeStatus();\n      }\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"_renderStatus\",\n    value: function _renderStatus() {\n      if (!this.$carouselStatus) {\n        this.$carouselStatus = this.$container.appendDiv('carousel-status');\n        this.htmlCompStatus = HtmlComponent.install(this.$carouselStatus, this.session);\n      }\n    }\n  }, {\n    key: \"_removeStatus\",\n    value: function _removeStatus() {\n      if (this.$carouselStatus) {\n        this.$carouselStatus.remove();\n        this.$carouselStatus = null;\n      }\n    }\n  }, {\n    key: \"_renderStatusItems\",\n    value: function _renderStatusItems() {\n      if (!this.$carouselStatus) {\n        return;\n      }\n\n      this.$carouselStatusItems = [];\n      this.$carouselStatus.empty();\n      this.$carouselItems.forEach(function () {\n        var $statusItem = this.$carouselStatus.appendDiv('status-item');\n        $statusItem.html(this.statusItemHtml);\n        this.$carouselStatusItems.push($statusItem);\n      }.bind(this));\n    }\n  }, {\n    key: \"_renderCurrentStatusItem\",\n    value: function _renderCurrentStatusItem() {\n      if (!this.$carouselStatus) {\n        return;\n      }\n\n      this.$carouselStatusItems.forEach(function (e, i) {\n        e.toggleClass('current-item', i === this.currentItem);\n      }.bind(this));\n    }\n  }, {\n    key: \"recalcTransformation\",\n    value: function recalcTransformation() {\n      this.positionX = this.currentItem * this.$container.width() * -1;\n      this.$carouselFilmstrip.css({\n        transform: 'translateX(' + this.positionX + 'px)'\n      });\n    }\n  }, {\n    key: \"setCurrentItem\",\n    value: function setCurrentItem(currentItem) {\n      this.setProperty('currentItem', currentItem);\n    }\n  }, {\n    key: \"_renderCurrentItem\",\n    value: function _renderCurrentItem() {\n      this._renderItemsInternal(undefined, false);\n\n      this._renderCurrentStatusItem();\n\n      this.invalidateLayoutTree();\n    }\n  }, {\n    key: \"_renderItemsInternal\",\n    value: function _renderItemsInternal(item, skipRemove) {\n      item = item || this.currentItem;\n\n      if (!skipRemove) {\n        this.widgets.forEach(function (w, j) {\n          if (w.rendered && (j < item - 1 || j > item + 1)) {\n            w.remove();\n          }\n        }, this);\n      }\n\n      for (var i = Math.max(item - 1, 0); i < Math.min(item + 2, this.widgets.length); i++) {\n        var widget = this.widgets[i];\n\n        if (!widget.rendered) {\n          widget.render(this.$carouselItems[i]);\n          widget.htmlComp.revalidateLayout();\n        }\n      }\n    }\n  }, {\n    key: \"setWidgets\",\n    value: function setWidgets(widgets) {\n      this.setProperty('widgets', widgets);\n    }\n  }, {\n    key: \"_renderWidgets\",\n    value: function _renderWidgets() {\n      this.$carouselFilmstrip.empty();\n      this.$carouselItems = this.widgets.map(function (widget) {\n        var $carouselItem = this.$carouselFilmstrip.appendDiv('carousel-item');\n        var htmlComp = HtmlComponent.install($carouselItem, this.session);\n        htmlComp.setLayout(new SingleLayout()); // Add the CSS classes of the widget to be able to style the carousel items.\n        // Use a suffix to prevent conflicts\n\n        var cssClasses = widget.cssClassAsArray();\n        cssClasses.forEach(function (cssClass) {\n          $carouselItem.addClass(cssClass + '-carousel-item');\n        });\n        return $carouselItem;\n      }, this);\n\n      this._renderStatusItems(); // reset current item\n\n\n      this.setCurrentItem(0);\n    }\n  }, {\n    key: \"_registerCarouselFilmstripEventListeners\",\n    value: function _registerCarouselFilmstripEventListeners() {\n      var $window = this.$carouselFilmstrip.window();\n      this.$carouselFilmstrip.on('mousedown touchstart', function (event) {\n        var origPageX = events.pageX(event);\n        var origPosition = this.positionX;\n        var minPositionX = this.$container.width() - this.$carouselFilmstrip.width();\n        var containerWidth = this.$container.width();\n        $window.on('mousemove.carouselDrag touchmove.carouselDrag', function (event) {\n          var pageX = events.pageX(event);\n          var moveX = pageX - origPageX;\n          var positionX = origPosition + moveX;\n\n          if (positionX !== this.positionX && positionX <= 0 && positionX >= minPositionX) {\n            this.$carouselFilmstrip.css({\n              transform: 'translateX(' + positionX + 'px)'\n            });\n            this.positionX = positionX; // item\n\n            var i = positionX / containerWidth * -1;\n\n            this._renderItemsInternal(positionX < origPosition ? Math.floor(i) : Math.ceil(i), true);\n          }\n        }.bind(this));\n        $window.on('mouseup.carouselDrag touchend.carouselDrag touchcancel.carouselDrag', function (e) {\n          $window.off('.carouselDrag'); // show only whole items\n\n          var mod = this.positionX % containerWidth;\n          var newCurrentItem = this.currentItem;\n\n          if (this.positionX < origPosition && mod / containerWidth < 0 - this.moveThreshold) {\n            // next\n            newCurrentItem = Math.ceil(this.positionX / containerWidth * -1);\n          } else if (this.positionX > origPosition && mod / containerWidth >= this.moveThreshold - 1) {\n            // prev\n            newCurrentItem = Math.floor(this.positionX / containerWidth * -1);\n          }\n\n          this.setCurrentItem(newCurrentItem);\n\n          if (mod !== 0) {\n            this.positionX = newCurrentItem * containerWidth * -1;\n            this.recalcTransformation();\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  }]);\n\n  return Carousel;\n}(Widget);\n\nexport { Carousel as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/carousel/Carousel.js"],"names":["arrays","CarouselLayout","events","GridData","HtmlComponent","SingleLayout","Widget","Carousel","_addWidgetProperties","statusEnabled","statusItemHtml","currentItem","moveThreshold","widgets","$carouselFilmstrip","$carouselItems","$carouselStatus","$carouselStatusItems","positionX","model","_setGridData","gridData","ensure","_setProperty","$container","$parent","appendDiv","htmlComp","install","session","setLayout","_registerCarouselFilmstripEventListeners","htmlCompFilmstrip","_removeStatus","_renderWidgets","_renderCurrentItem","_renderStatusEnabled","setProperty","_renderStatus","_renderStatusItems","_renderCurrentStatusItem","invalidateLayoutTree","htmlCompStatus","remove","empty","forEach","$statusItem","html","push","bind","e","i","toggleClass","width","css","transform","_renderItemsInternal","undefined","item","skipRemove","w","j","rendered","Math","max","min","length","widget","render","revalidateLayout","map","$carouselItem","cssClasses","cssClassAsArray","cssClass","addClass","setCurrentItem","$window","window","on","event","origPageX","pageX","origPosition","minPositionX","containerWidth","moveX","floor","ceil","off","mod","newCurrentItem","recalcTransformation"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, CarouselLayout, events, GridData, HtmlComponent, SingleLayout, Widget} from '../index';\n\nexport default class Carousel extends Widget {\n\n  constructor() {\n    super();\n    this._addWidgetProperties(['widgets']);\n\n    // default values\n    this.statusEnabled = true;\n    this.statusItemHtml = '&bull;';\n    this.currentItem = 0; // current item\n    this.moveThreshold = 0.25; // threshold\n    this.widgets = []; // widgets\n\n    this.$carouselFilmstrip; // carousel filmstrip\n    this.$carouselItems = []; // carousel items\n    this.$carouselStatus; // carousel status bar (containing current position)\n    this.$carouselStatusItems = []; // carousel status items\n\n    this.positionX = 0; // last translation position\n  }\n\n  _init(model) {\n    super._init(model);\n    this._setGridData(this.gridData);\n    this.widgets = arrays.ensure(this.widgets);\n  }\n\n  _setGridData(gridData) {\n    this._setProperty('gridData', new GridData(gridData));\n  }\n\n  _render() {\n    // add container\n    this.$container = this.$parent.appendDiv('carousel');\n\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n    this.htmlComp.setLayout(new CarouselLayout(this));\n\n    // add content filmstrip\n    this.$carouselFilmstrip = this.$container.appendDiv('carousel-filmstrip');\n    this._registerCarouselFilmstripEventListeners();\n    this.htmlCompFilmstrip = HtmlComponent.install(this.$carouselFilmstrip, this.session);\n  }\n\n  _remove() {\n    this._removeStatus();\n    super._remove();\n  }\n\n  _renderProperties() {\n    super._renderProperties();\n\n    this._renderWidgets();\n    this._renderCurrentItem(); // must be called after renderWidgets\n    this._renderStatusEnabled();\n  }\n\n  setStatusEnabled(statusEnabled) {\n    this.setProperty('statusEnabled', statusEnabled);\n  }\n\n  _renderStatusEnabled() {\n    if (this.statusEnabled) {\n      this._renderStatus();\n      this._renderStatusItems();\n      this._renderCurrentStatusItem();\n    } else {\n      this._removeStatus();\n    }\n    this.invalidateLayoutTree();\n  }\n\n  _renderStatus() {\n    if (!this.$carouselStatus) {\n      this.$carouselStatus = this.$container.appendDiv('carousel-status');\n      this.htmlCompStatus = HtmlComponent.install(this.$carouselStatus, this.session);\n    }\n  }\n\n  _removeStatus() {\n    if (this.$carouselStatus) {\n      this.$carouselStatus.remove();\n      this.$carouselStatus = null;\n    }\n  }\n\n  _renderStatusItems() {\n    if (!this.$carouselStatus) {\n      return;\n    }\n    this.$carouselStatusItems = [];\n    this.$carouselStatus.empty();\n    this.$carouselItems.forEach(function() {\n      var $statusItem = this.$carouselStatus.appendDiv('status-item');\n      $statusItem.html(this.statusItemHtml);\n      this.$carouselStatusItems.push($statusItem);\n    }.bind(this));\n  }\n\n  _renderCurrentStatusItem() {\n    if (!this.$carouselStatus) {\n      return;\n    }\n    this.$carouselStatusItems.forEach(function(e, i) {\n      e.toggleClass('current-item', i === this.currentItem);\n    }.bind(this));\n  }\n\n  recalcTransformation() {\n    this.positionX = this.currentItem * this.$container.width() * -1;\n    this.$carouselFilmstrip.css({\n      transform: 'translateX(' + this.positionX + 'px)'\n    });\n  }\n\n  setCurrentItem(currentItem) {\n    this.setProperty('currentItem', currentItem);\n  }\n\n  _renderCurrentItem() {\n    this._renderItemsInternal(undefined, false);\n    this._renderCurrentStatusItem();\n    this.invalidateLayoutTree();\n  }\n\n  _renderItemsInternal(item, skipRemove) {\n    item = item || this.currentItem;\n    if (!skipRemove) {\n      this.widgets.forEach(function(w, j) {\n        if (w.rendered && (j < item - 1 || j > item + 1)) {\n          w.remove();\n        }\n      }, this);\n    }\n    for (var i = Math.max(item - 1, 0); i < Math.min(item + 2, this.widgets.length); i++) {\n      var widget = this.widgets[i];\n      if (!widget.rendered) {\n        widget.render(this.$carouselItems[i]);\n        widget.htmlComp.revalidateLayout();\n      }\n    }\n  }\n\n  setWidgets(widgets) {\n    this.setProperty('widgets', widgets);\n  }\n\n  _renderWidgets() {\n    this.$carouselFilmstrip.empty();\n    this.$carouselItems = this.widgets.map(function(widget) {\n      var $carouselItem = this.$carouselFilmstrip.appendDiv('carousel-item');\n      var htmlComp = HtmlComponent.install($carouselItem, this.session);\n      htmlComp.setLayout(new SingleLayout());\n\n      // Add the CSS classes of the widget to be able to style the carousel items.\n      // Use a suffix to prevent conflicts\n      var cssClasses = widget.cssClassAsArray();\n      cssClasses.forEach(function(cssClass) {\n        $carouselItem.addClass(cssClass + '-carousel-item');\n      });\n\n      return $carouselItem;\n    }, this);\n\n    this._renderStatusItems();\n\n    // reset current item\n    this.setCurrentItem(0);\n  }\n\n  _registerCarouselFilmstripEventListeners() {\n    var $window = this.$carouselFilmstrip.window();\n    this.$carouselFilmstrip.on('mousedown touchstart', function(event) {\n      var origPageX = events.pageX(event);\n      var origPosition = this.positionX;\n      var minPositionX = this.$container.width() - this.$carouselFilmstrip.width();\n      var containerWidth = this.$container.width();\n      $window.on('mousemove.carouselDrag touchmove.carouselDrag', function(event) {\n        var pageX = events.pageX(event);\n        var moveX = pageX - origPageX;\n        var positionX = origPosition + moveX;\n        if (positionX !== this.positionX && positionX <= 0 && positionX >= minPositionX) {\n          this.$carouselFilmstrip.css({\n            transform: 'translateX(' + positionX + 'px)'\n          });\n          this.positionX = positionX;\n          // item\n          var i = positionX / containerWidth * -1;\n          this._renderItemsInternal(positionX < origPosition ? Math.floor(i) : Math.ceil(i), true);\n        }\n      }.bind(this));\n      $window.on('mouseup.carouselDrag touchend.carouselDrag touchcancel.carouselDrag', function(e) {\n        $window.off('.carouselDrag');\n        // show only whole items\n        var mod = this.positionX % containerWidth;\n        var newCurrentItem = this.currentItem;\n        if (this.positionX < origPosition && mod / containerWidth < (0 - this.moveThreshold)) { // next\n          newCurrentItem = Math.ceil(this.positionX / containerWidth * -1);\n        } else if (this.positionX > origPosition && mod / containerWidth >= this.moveThreshold - 1) { // prev\n          newCurrentItem = Math.floor(this.positionX / containerWidth * -1);\n        }\n        this.setCurrentItem(newCurrentItem);\n        if (mod !== 0) {\n          this.positionX = newCurrentItem * containerWidth * -1;\n          this.recalcTransformation();\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n}\n"]},"metadata":{},"sourceType":"module"}