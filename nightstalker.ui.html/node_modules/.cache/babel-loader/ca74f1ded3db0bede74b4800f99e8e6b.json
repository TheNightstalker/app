{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Box, Device, strings, TextMap } from '../index';\nimport $ from 'jquery';\n\nvar LoginBox = /*#__PURE__*/function (_Box) {\n  _inherits(LoginBox, _Box);\n\n  var _super = _createSuper(LoginBox);\n\n  function LoginBox() {\n    var _this;\n\n    _classCallCheck(this, LoginBox);\n\n    _this = _super.call(this);\n    _this.ajaxOptions = {\n      type: 'POST'\n    };\n    _this.authUrl = 'auth';\n    _this.onPostDoneFunc = _this.redirect.bind(_assertThisInitialized(_this));\n    _this.redirectUrl = null;\n    _this.logoUrl = 'logo.png';\n    _this.userDataKey = 'user';\n    _this.passwordDataKey = 'password';\n    _this.additionalData = {};\n    _this.prepareRedirectUrlFunc = LoginBox.prepareRedirectUrl;\n    _this.messageKey = null;\n    _this.texts = {\n      'ui.Login': 'Login',\n      'ui.LoginFailed': 'Login failed',\n      'ui.User': 'Username',\n      'ui.Password': 'Password'\n    };\n    return _this;\n  }\n\n  _createClass(LoginBox, [{\n    key: \"init\",\n    value: function init(options) {\n      options = options || {};\n      options.texts = new TextMap($.extend(this.texts, options.texts));\n      options.ajaxOptions = $.extend(this.ajaxOptions, options.ajaxOptions);\n      $.extend(this, options);\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      _get(_getPrototypeOf(LoginBox.prototype), \"_render\", this).call(this);\n\n      this.$container.addClass('login-box');\n      this.$content.addClass('login-box-content ');\n      this.$form = $('<form>').attr('action', this.authUrl).attr('method', 'post').submit(this._onLoginFormSubmit.bind(this)).appendTo(this.$content);\n\n      if (this.messageKey) {\n        this.$message = $('<div>').attr('id', 'message-box').html(strings.nl2br(this.texts.get(this.messageKey))).appendTo(this.$form);\n      }\n\n      this.$user = $('<input>').attr('type', 'text').attr('autocapitalize', 'off').attr('autocorrect', 'off').placeholder(this.texts.get('ui.User')).addClass('alternative').appendTo(this.$form);\n      this.$password = $('<input>').attr('type', 'password').placeholder(this.texts.get('ui.Password')).addClass('alternative').appendTo(this.$form);\n      this.$button = $('<button>').attr('type', 'submit').addClass('login-button button default').text(this.texts.get('ui.Login')).appendTo(this.$form);\n      this.$user.focus();\n    }\n  }, {\n    key: \"_resetButtonText\",\n    value: function _resetButtonText() {\n      this.$button.text(this.texts.get('ui.Login')).removeClass('login-error');\n    }\n  }, {\n    key: \"data\",\n    value: function data() {\n      var data = {};\n      data[this.userDataKey] = this.$user.val();\n      data[this.passwordDataKey] = this.$password.val();\n      $.extend(data, this.additionalData);\n      return data;\n    }\n  }, {\n    key: \"_onLoginFormSubmit\",\n    value: function _onLoginFormSubmit(event) {\n      // Prevent default submit action\n      event.preventDefault();\n      var url = this.$form.attr('action');\n      var data = this.data();\n      this.$button.removeClass('login-error').setEnabled(false);\n      this.$user.off('input.resetLoginError');\n      this.$password.off('input.resetLoginError');\n\n      if (Device.get().supportsCssAnimation()) {\n        this.$button.html('').append($('<div>').addClass('login-button-loading'));\n      }\n\n      var options = $.extend({}, this.ajaxOptions, {\n        url: url,\n        data: data\n      });\n      $.ajax(options).done(this._onPostDone.bind(this)).fail(this._onPostFail.bind(this));\n    }\n  }, {\n    key: \"redirect\",\n    value: function redirect(data) {\n      // Calculate target URL\n      var url = this.redirectUrl;\n\n      if (!url) {\n        url = (window.location.href || '').trim(); // Remove login and everything after it from the URL\n\n        url = this.prepareRedirectUrlFunc(url);\n      } // Go to target URL\n\n\n      if (url) {\n        window.location.href = url;\n      } else {\n        window.location.reload();\n      }\n    }\n  }, {\n    key: \"_onPostDone\",\n    value: function _onPostDone(data) {\n      this.remove();\n      this.onPostDoneFunc.call(this, data);\n    }\n  }, {\n    key: \"_onPostFail\",\n    value: function _onPostFail(jqXHR, textStatus, errorThrown) {\n      // execute delayed to make sure loading animation is visible, otherwise (if it is very fast), it flickers\n      setTimeout(this._onPostFailImpl.bind(this, jqXHR, textStatus, errorThrown), 300);\n    }\n  }, {\n    key: \"_onPostFailImpl\",\n    value: function _onPostFailImpl(jqXHR, textStatus, errorThrown) {\n      this.$button.setEnabled(true).html('').text(this.texts.get('ui.LoginFailed')).addClass('login-error');\n      this.$user.val('').focus();\n      this.$password.val(''); // async bind reset function because focus method on username field (see above) already triggers an input event on IE.\n\n      setTimeout(function () {\n        this.$user.one('input.resetLoginError', this._resetButtonText.bind(this));\n        this.$password.one('input.resetLoginError', this._resetButtonText.bind(this));\n      }.bind(this));\n    } // ----- Helper functions -----\n\n  }], [{\n    key: \"prepareRedirectUrl\",\n    value: function prepareRedirectUrl(url) {\n      var urlParts = /^([^?#]*)(\\?[^#]*)?(#.*)?$/.exec(url || ''); // $1 = baseUrl, $2 = queryPart, $3 = hashPart\n\n      var filteredBaseUrl = urlParts[1].replace(/login.html$/, '').replace(/login$/, '').replace(/logout$/, '');\n      return filteredBaseUrl + (urlParts[2] ? urlParts[2] : '') + (urlParts[3] ? urlParts[3] : '');\n    }\n  }]);\n\n  return LoginBox;\n}(Box);\n\nexport { LoginBox as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/login/LoginBox.js"],"names":["Box","Device","strings","TextMap","$","LoginBox","ajaxOptions","type","authUrl","onPostDoneFunc","redirect","bind","redirectUrl","logoUrl","userDataKey","passwordDataKey","additionalData","prepareRedirectUrlFunc","prepareRedirectUrl","messageKey","texts","options","extend","$container","addClass","$content","$form","attr","submit","_onLoginFormSubmit","appendTo","$message","html","nl2br","get","$user","placeholder","$password","$button","text","focus","removeClass","data","val","event","preventDefault","url","setEnabled","off","supportsCssAnimation","append","ajax","done","_onPostDone","fail","_onPostFail","window","location","href","trim","reload","remove","call","jqXHR","textStatus","errorThrown","setTimeout","_onPostFailImpl","one","_resetButtonText","urlParts","exec","filteredBaseUrl","replace"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Box, Device, strings, TextMap} from '../index';\nimport $ from 'jquery';\n\nexport default class LoginBox extends Box {\n\n  constructor() {\n    super();\n\n    this.ajaxOptions = {\n      type: 'POST'\n    };\n    this.authUrl = 'auth';\n    this.onPostDoneFunc = this.redirect.bind(this);\n    this.redirectUrl = null;\n    this.logoUrl = 'logo.png';\n    this.userDataKey = 'user';\n    this.passwordDataKey = 'password';\n    this.additionalData = {};\n    this.prepareRedirectUrlFunc = LoginBox.prepareRedirectUrl;\n    this.messageKey = null;\n    this.texts = {\n      'ui.Login': 'Login',\n      'ui.LoginFailed': 'Login failed',\n      'ui.User': 'Username',\n      'ui.Password': 'Password'\n    };\n  }\n\n  init(options) {\n    options = options || {};\n    options.texts = new TextMap($.extend(this.texts, options.texts));\n    options.ajaxOptions = $.extend(this.ajaxOptions, options.ajaxOptions);\n    $.extend(this, options);\n  }\n\n  _render() {\n    super._render();\n\n    this.$container.addClass('login-box');\n    this.$content.addClass('login-box-content ');\n    this.$form = $('<form>')\n      .attr('action', this.authUrl)\n      .attr('method', 'post')\n      .submit(this._onLoginFormSubmit.bind(this))\n      .appendTo(this.$content);\n    if (this.messageKey) {\n      this.$message = $('<div>')\n        .attr('id', 'message-box')\n        .html(strings.nl2br(this.texts.get(this.messageKey)))\n        .appendTo(this.$form);\n    }\n    this.$user = $('<input>')\n      .attr('type', 'text')\n      .attr('autocapitalize', 'off')\n      .attr('autocorrect', 'off')\n      .placeholder(this.texts.get('ui.User'))\n      .addClass('alternative')\n      .appendTo(this.$form);\n    this.$password = $('<input>')\n      .attr('type', 'password')\n      .placeholder(this.texts.get('ui.Password'))\n      .addClass('alternative')\n      .appendTo(this.$form);\n    this.$button = $('<button>')\n      .attr('type', 'submit')\n      .addClass('login-button button default')\n      .text(this.texts.get('ui.Login'))\n      .appendTo(this.$form);\n\n    this.$user.focus();\n  }\n\n  _resetButtonText() {\n    this.$button\n      .text(this.texts.get('ui.Login'))\n      .removeClass('login-error');\n  }\n\n  data() {\n    var data = {};\n    data[this.userDataKey] = this.$user.val();\n    data[this.passwordDataKey] = this.$password.val();\n    $.extend(data, this.additionalData);\n    return data;\n  }\n\n  _onLoginFormSubmit(event) {\n    // Prevent default submit action\n    event.preventDefault();\n\n    var url = this.$form.attr('action');\n    var data = this.data();\n\n    this.$button\n      .removeClass('login-error')\n      .setEnabled(false);\n    this.$user.off('input.resetLoginError');\n    this.$password.off('input.resetLoginError');\n    if (Device.get().supportsCssAnimation()) {\n      this.$button\n        .html('')\n        .append($('<div>').addClass('login-button-loading'));\n    }\n\n    var options = $.extend({}, this.ajaxOptions, {\n      url: url,\n      data: data\n    });\n    $.ajax(options)\n      .done(this._onPostDone.bind(this))\n      .fail(this._onPostFail.bind(this));\n  }\n\n  redirect(data) {\n    // Calculate target URL\n    var url = this.redirectUrl;\n    if (!url) {\n      url = (window.location.href || '').trim();\n      // Remove login and everything after it from the URL\n      url = this.prepareRedirectUrlFunc(url);\n    }\n\n    // Go to target URL\n    if (url) {\n      window.location.href = url;\n    } else {\n      window.location.reload();\n    }\n  }\n\n  _onPostDone(data) {\n    this.remove();\n    this.onPostDoneFunc.call(this, data);\n  }\n\n  _onPostFail(jqXHR, textStatus, errorThrown) {\n    // execute delayed to make sure loading animation is visible, otherwise (if it is very fast), it flickers\n    setTimeout(this._onPostFailImpl.bind(this, jqXHR, textStatus, errorThrown), 300);\n  }\n\n  _onPostFailImpl(jqXHR, textStatus, errorThrown) {\n    this.$button\n      .setEnabled(true)\n      .html('')\n      .text(this.texts.get('ui.LoginFailed'))\n      .addClass('login-error');\n    this.$user\n      .val('')\n      .focus();\n    this.$password\n      .val('');\n\n    // async bind reset function because focus method on username field (see above) already triggers an input event on IE.\n    setTimeout(function() {\n      this.$user\n        .one('input.resetLoginError', this._resetButtonText.bind(this));\n      this.$password\n        .one('input.resetLoginError', this._resetButtonText.bind(this));\n    }.bind(this));\n  }\n\n  // ----- Helper functions -----\n\n  static prepareRedirectUrl(url) {\n    var urlParts = /^([^?#]*)(\\?[^#]*)?(#.*)?$/.exec(url || ''); // $1 = baseUrl, $2 = queryPart, $3 = hashPart\n    var filteredBaseUrl = urlParts[1]\n      .replace(/login.html$/, '')\n      .replace(/login$/, '')\n      .replace(/logout$/, '');\n    return filteredBaseUrl + (urlParts[2] ? urlParts[2] : '') + (urlParts[3] ? urlParts[3] : '');\n  }\n}\n"]},"metadata":{},"sourceType":"module"}