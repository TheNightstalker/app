{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Distribution License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/org/documents/edl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, Form, scout, Status } from '../../index';\n\nvar UnsavedFormChangesForm = /*#__PURE__*/function (_Form) {\n  _inherits(UnsavedFormChangesForm, _Form);\n\n  var _super = _createSuper(UnsavedFormChangesForm);\n\n  function UnsavedFormChangesForm() {\n    var _this;\n\n    _classCallCheck(this, UnsavedFormChangesForm);\n\n    _this = _super.call(this);\n    _this.unsavedForms = [];\n    return _this;\n  }\n\n  _createClass(UnsavedFormChangesForm, [{\n    key: \"_jsonModel\",\n    value: function _jsonModel() {\n      return {\n        id: 'scout.UnsavedFormChangesForm',\n        objectType: 'Form',\n        type: 'model',\n        title: '${textKey:SaveChangesOfSelectedItems}',\n        askIfNeedSave: false,\n        rootGroupBox: {\n          id: 'MainBox',\n          objectType: 'GroupBox',\n          menus: [{\n            id: 'OkMenu',\n            objectType: 'OkMenu'\n          }, {\n            id: 'CancelMenu',\n            objectType: 'CancelMenu'\n          }],\n          fields: [{\n            id: 'UnsavedChangesBox',\n            objectType: 'GroupBox',\n            labelVisible: false,\n            gridColumnCount: 1,\n            fields: [{\n              id: 'OpenFormsField',\n              objectType: 'ListBox',\n              gridDataHints: {\n                h: 5\n              },\n              labelVisible: false\n            }]\n          }]\n        }\n      };\n    }\n  }, {\n    key: \"_init\",\n    value: function _init(model) {\n      _get(_getPrototypeOf(UnsavedFormChangesForm.prototype), \"_init\", this).call(this, model);\n\n      this.openFormsField = this.widget('OpenFormsField');\n      this.openFormsField.setLookupCall(scout.create('scout.UnsavedFormsLookupCall', {\n        session: this.session,\n        unsavedForms: this.unsavedForms\n      }));\n      this.openFormsField.table.one('rowsInserted', function (event) {\n        event.source.checkAll(true);\n      });\n      var checkAllMenu = scout.create('Menu', {\n        parent: this.openFormsField.table,\n        id: 'CheckAllMenu',\n        menuTypes: ['Table.EmptySpace'],\n        text: '${textKey:CheckAll}'\n      });\n      checkAllMenu.on('action', function (event) {\n        this.openFormsField.table.checkAll(true);\n      }.bind(this));\n      var uncheckAllMenu = scout.create('Menu', {\n        parent: this.openFormsField.table,\n        id: 'UncheckAllMenu',\n        menuTypes: ['Table.EmptySpace'],\n        text: '${textKey:UncheckAll}'\n      });\n      uncheckAllMenu.on('action', function (event) {\n        this.openFormsField.table.uncheckAll();\n      }.bind(this));\n      this.openFormsField.table.setMenus([checkAllMenu, uncheckAllMenu]);\n      this.on('postLoad', function (event) {\n        this.touch();\n      }.bind(this));\n    }\n  }, {\n    key: \"_validate\",\n    value: function _validate(data) {\n      var invalidForms = this.getInvalidForms();\n\n      if (invalidForms.length > 0) {\n        var msg = [];\n        msg.push('<p><b>', this.session.text('NotAllCheckedFormsCanBeSaved'), '</b></p>');\n        msg.push(this.session.text('FormsCannotBeSaved'), '<br><br>');\n        invalidForms.forEach(function (form) {\n          msg.push('- ', UnsavedFormChangesForm.getFormDisplayName(form), '<br>');\n        }, this);\n        return Status.error({\n          message: msg.join('')\n        });\n      }\n\n      return Status.ok();\n    }\n  }, {\n    key: \"getInvalidForms\",\n    value: function getInvalidForms() {\n      var invalidForms = [];\n      this.openFormsField.value.forEach(function (form) {\n        var missingElements = form.lifecycle._invalidElements().missingElements.slice();\n\n        var invalidElements = form.lifecycle._invalidElements().invalidElements.slice();\n\n        form.visitDisplayChildren(function (dialog) {\n          var diagElem = dialog.lifecycle._invalidElements();\n\n          arrays.pushAll(missingElements, diagElem.missingElements);\n          arrays.pushAll(invalidElements, diagElem.invalidElements);\n        }, function (dialog) {\n          // forms are the only display children with a lifecycle, only visit those.\n          return dialog instanceof Form;\n        });\n\n        if (missingElements.length > 0 || invalidElements.length > 0) {\n          invalidForms.push(form);\n        }\n      });\n      return invalidForms;\n    }\n  }], [{\n    key: \"getFormDisplayName\",\n    value: function getFormDisplayName(form) {\n      return [form.title, form.name, form.subTitle].filter(Boolean).join(' - ');\n    }\n  }]);\n\n  return UnsavedFormChangesForm;\n}(Form);\n\nexport { UnsavedFormChangesForm as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/desktop/unsavedchanges/UnsavedFormChangesForm.js"],"names":["arrays","Form","scout","Status","UnsavedFormChangesForm","unsavedForms","id","objectType","type","title","askIfNeedSave","rootGroupBox","menus","fields","labelVisible","gridColumnCount","gridDataHints","h","model","openFormsField","widget","setLookupCall","create","session","table","one","event","source","checkAll","checkAllMenu","parent","menuTypes","text","on","bind","uncheckAllMenu","uncheckAll","setMenus","touch","data","invalidForms","getInvalidForms","length","msg","push","forEach","form","getFormDisplayName","error","message","join","ok","value","missingElements","lifecycle","_invalidElements","slice","invalidElements","visitDisplayChildren","dialog","diagElem","pushAll","name","subTitle","filter","Boolean"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Distribution License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/org/documents/edl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, Form, scout, Status} from '../../index';\n\nexport default class UnsavedFormChangesForm extends Form {\n\n  constructor() {\n    super();\n\n    this.unsavedForms = [];\n  }\n\n  _jsonModel() {\n    return {\n      id: 'scout.UnsavedFormChangesForm',\n      objectType: 'Form',\n      type: 'model',\n      title: '${textKey:SaveChangesOfSelectedItems}',\n      askIfNeedSave: false,\n      rootGroupBox: {\n        id: 'MainBox',\n        objectType: 'GroupBox',\n        menus: [{\n          id: 'OkMenu',\n          objectType: 'OkMenu'\n        }, {\n          id: 'CancelMenu',\n          objectType: 'CancelMenu'\n        }],\n        fields: [{\n          id: 'UnsavedChangesBox',\n          objectType: 'GroupBox',\n          labelVisible: false,\n          gridColumnCount: 1,\n          fields: [{\n            id: 'OpenFormsField',\n            objectType: 'ListBox',\n            gridDataHints: {\n              h: 5\n            },\n            labelVisible: false\n          }]\n        }]\n      }\n    };\n  }\n\n  _init(model) {\n    super._init(model);\n\n    this.openFormsField = this.widget('OpenFormsField');\n    this.openFormsField.setLookupCall(scout.create('scout.UnsavedFormsLookupCall', {\n      session: this.session,\n      unsavedForms: this.unsavedForms\n    }));\n\n    this.openFormsField.table.one('rowsInserted', function(event) {\n      event.source.checkAll(true);\n    });\n\n    var checkAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'CheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:CheckAll}'\n    });\n\n    checkAllMenu.on('action', function(event) {\n      this.openFormsField.table.checkAll(true);\n    }.bind(this));\n\n    var uncheckAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'UncheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:UncheckAll}'\n    });\n\n    uncheckAllMenu.on('action', function(event) {\n      this.openFormsField.table.uncheckAll();\n    }.bind(this));\n\n    this.openFormsField.table.setMenus([checkAllMenu, uncheckAllMenu]);\n\n    this.on('postLoad', function(event) {\n      this.touch();\n    }.bind(this));\n  }\n\n  _validate(data) {\n    var invalidForms = this.getInvalidForms();\n    if (invalidForms.length > 0) {\n      var msg = [];\n      msg.push('<p><b>', this.session.text('NotAllCheckedFormsCanBeSaved'), '</b></p>');\n      msg.push(this.session.text('FormsCannotBeSaved'), '<br><br>');\n      invalidForms.forEach(function(form) {\n        msg.push('- ', UnsavedFormChangesForm.getFormDisplayName(form), '<br>');\n      }, this);\n      return Status.error({\n        message: msg.join('')\n      });\n    }\n    return Status.ok();\n  }\n\n  getInvalidForms() {\n    var invalidForms = [];\n    this.openFormsField.value.forEach(function(form) {\n      var missingElements = form.lifecycle._invalidElements().missingElements.slice();\n      var invalidElements = form.lifecycle._invalidElements().invalidElements.slice();\n      form.visitDisplayChildren(function(dialog) {\n        var diagElem = dialog.lifecycle._invalidElements();\n        arrays.pushAll(missingElements, diagElem.missingElements);\n        arrays.pushAll(invalidElements, diagElem.invalidElements);\n      }, function(dialog) {\n        // forms are the only display children with a lifecycle, only visit those.\n        return dialog instanceof Form;\n      });\n      if (missingElements.length > 0 || invalidElements.length > 0) {\n        invalidForms.push(form);\n      }\n    });\n    return invalidForms;\n  }\n\n  static getFormDisplayName(form) {\n    return [form.title, form.name, form.subTitle].filter(Boolean).join(' - ');\n  }\n}\n"]},"metadata":{},"sourceType":"module"}