{"ast":null,"code":"/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Device, numbers } from '../index';\nimport $ from 'jquery';\n/**\n * Polyfill for IE9 providing a simple implementation of FormData (as used by FileChooser.js)\n *\n * Only supports the append() and the toString() method. Does not work in modern browsers, because\n * it uses obsolete File.getAsBinary (https://developer.mozilla.org/de/docs/Web/API/File/getAsBinary).\n *\n * Rules for generating the boundary:\n * http://stackoverflow.com/a/4656646\n *\n * How to use this polyfill with jQuery:\n * http://stackoverflow.com/a/5976031\n */\n\nexport function install(window) {\n  _installPolyfillFormData(window);\n\n  _installPolyfillMath(window);\n}\n/**\n * Polyfills for \"Math\"\n */\n\nexport function _installPolyfillMath(window) {\n  if (Math.sign) {\n    return; // Nothing to do\n  }\n\n  Math.sign = function (x) {\n    x = +x; // convert to a number\n\n    if (x === 0 || isNaN(x)) {\n      return x;\n    }\n\n    return x > 0 ? 1 : -1;\n  };\n}\n/**\n * Polyfills for \"FormData\"\n */\n\nexport function _installPolyfillFormData(window) {\n  if (window.FormData) {\n    return; // Nothing to do\n  }\n\n  window.FormData = function () {\n    polyfill = true; // Marker\n\n    _boundary = 'ScoutFormData-' + numbers.randomId(50);\n    _data = [];\n    _crlf = '\\r\\n';\n  };\n\n  window.FormData.prototype.append = function (key, value, filename) {\n    var element = [key, value, filename];\n\n    _data.push(element);\n  };\n\n  window.FormData.prototype.getContent = function () {\n    var result = '';\n\n    _data.forEach(function (element) {\n      var key = element[0];\n      var value = element[1];\n      var filename = element[2];\n      result += '--' + _boundary + _crlf;\n\n      if (Device.get().supportsFile() && value instanceof window.File) {\n        // File\n        var file = value;\n        filename = filename || file.name || key;\n        result += 'Content-Disposition: form-data; name=\"' + key + '\"; filename=\"' + filename + '\"' + _crlf;\n        result += 'Content-Type: ' + file.type + _crlf;\n        result += _crlf;\n        result += (file.getAsBinary ? file.getAsBinary() : 'UNKNOWN CONTENT') + _crlf;\n      } else {\n        // Everything else\n        result += 'Content-Disposition: form-data; name=\"' + key + '\";' + _crlf;\n        result += _crlf;\n        result += value + _crlf;\n      }\n    });\n\n    result += '--' + _boundary + '--';\n    return result;\n  };\n\n  window.FormData.prototype.applyToAjaxOptions = function (ajaxOpts) {\n    if (!ajaxOpts) {\n      return;\n    } // Make sure no text encoding stuff is done by xhr\n\n\n    ajaxOpts.xhr = function () {\n      var xhr = $.ajaxSettings.xhr();\n      xhr.send = xhr.sendAsBinary || xhr.send; // sendAsBinary only exists in older browsers\n\n      return xhr;\n    }; // Manually set content type (with boundary)\n\n\n    ajaxOpts.contentType = 'multipart/form-data; boundary=' + _boundary; // Generate content\n\n    ajaxOpts.data = getContent();\n  };\n}\nexport default {\n  install: install\n};","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/util/polyfills.js"],"names":["Device","numbers","$","install","window","_installPolyfillFormData","_installPolyfillMath","Math","sign","x","isNaN","FormData","polyfill","_boundary","randomId","_data","_crlf","prototype","append","key","value","filename","element","push","getContent","result","forEach","get","supportsFile","File","file","name","type","getAsBinary","applyToAjaxOptions","ajaxOpts","xhr","ajaxSettings","send","sendAsBinary","contentType","data"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Device, numbers} from '../index';\nimport $ from 'jquery';\n\n/**\n * Polyfill for IE9 providing a simple implementation of FormData (as used by FileChooser.js)\n *\n * Only supports the append() and the toString() method. Does not work in modern browsers, because\n * it uses obsolete File.getAsBinary (https://developer.mozilla.org/de/docs/Web/API/File/getAsBinary).\n *\n * Rules for generating the boundary:\n * http://stackoverflow.com/a/4656646\n *\n * How to use this polyfill with jQuery:\n * http://stackoverflow.com/a/5976031\n */\n\n\nexport function install(window) {\n  _installPolyfillFormData(window);\n  _installPolyfillMath(window);\n}\n\n/**\n * Polyfills for \"Math\"\n */\n\nexport function _installPolyfillMath(window) {\n  if (Math.sign) {\n    return; // Nothing to do\n  }\n\n  Math.sign = function(x) {\n    x = +x; // convert to a number\n    if (x === 0 || isNaN(x)) {\n      return x;\n    }\n    return x > 0 ? 1 : -1;\n  };\n}\n\n/**\n * Polyfills for \"FormData\"\n */\n\nexport function _installPolyfillFormData(window) {\n  if (window.FormData) {\n    return; // Nothing to do\n  }\n\n  window.FormData = function() {\n    polyfill = true; // Marker\n    _boundary = 'ScoutFormData-' + numbers.randomId(50);\n    _data = [];\n    _crlf = '\\r\\n';\n  };\n\n  window.FormData.prototype.append = function(key, value, filename) {\n    var element = [key, value, filename];\n    _data.push(element);\n  };\n\n  window.FormData.prototype.getContent = function() {\n    var result = '';\n    _data.forEach(function(element) {\n      var key = element[0];\n      var value = element[1];\n      var filename = element[2];\n\n      result += '--' + _boundary + _crlf;\n      if (Device.get().supportsFile() && value instanceof window.File) {\n        // File\n        var file = value;\n        filename = filename || file.name || key;\n        result += 'Content-Disposition: form-data; name=\"' + key + '\"; filename=\"' + filename + '\"' + _crlf;\n        result += 'Content-Type: ' + file.type + _crlf;\n        result += _crlf;\n        result += (file.getAsBinary ? file.getAsBinary() : 'UNKNOWN CONTENT') + _crlf;\n      } else {\n        // Everything else\n        result += 'Content-Disposition: form-data; name=\"' + key + '\";' + _crlf;\n        result += _crlf;\n        result += value + _crlf;\n      }\n    });\n    result += '--' + _boundary + '--';\n    return result;\n  };\n\n  window.FormData.prototype.applyToAjaxOptions = function(ajaxOpts) {\n    if (!ajaxOpts) {\n      return;\n    }\n    // Make sure no text encoding stuff is done by xhr\n    ajaxOpts.xhr = function() {\n      var xhr = $.ajaxSettings.xhr();\n      xhr.send = xhr.sendAsBinary || xhr.send; // sendAsBinary only exists in older browsers\n      return xhr;\n    };\n    // Manually set content type (with boundary)\n    ajaxOpts.contentType = 'multipart/form-data; boundary=' + _boundary;\n    // Generate content\n    ajaxOpts.data = getContent();\n  };\n}\n\nexport default {\n  install\n};\n"]},"metadata":{},"sourceType":"module"}