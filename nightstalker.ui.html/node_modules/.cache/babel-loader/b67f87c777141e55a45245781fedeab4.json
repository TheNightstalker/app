{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, BoxButtons, ClickActiveElementKeyStroke, CloseKeyStroke, Device, dragAndDrop, Event, FileInput, FocusAdjacentElementKeyStroke, FocusRule, Form, FormLayout, GlassPaneRenderer, HtmlComponent, keys, KeyStrokeContext, MessageBoxes, scout, scrollbars, Status, Widget } from '../index';\nimport $ from 'jquery';\n\nvar FileChooser = /*#__PURE__*/function (_Widget) {\n  _inherits(FileChooser, _Widget);\n\n  var _super = _createSuper(FileChooser);\n\n  function FileChooser() {\n    var _this;\n\n    _classCallCheck(this, FileChooser);\n\n    _this = _super.call(this);\n    _this.displayParent = null;\n    _this.files = [];\n    _this._glassPaneRenderer = null;\n    _this.maximumUploadSize = FileInput.DEFAULT_MAXIMUM_UPLOAD_SIZE;\n    return _this;\n  }\n\n  _createClass(FileChooser, [{\n    key: \"_init\",\n    value: function _init(model) {\n      _get(_getPrototypeOf(FileChooser.prototype), \"_init\", this).call(this, model);\n\n      this._setDisplayParent(this.displayParent);\n\n      this._glassPaneRenderer = new GlassPaneRenderer(this);\n      this.fileInput = scout.create('FileInput', {\n        parent: this,\n        acceptTypes: this.acceptTypes,\n        maximumUploadSize: this.maximumUploadSize,\n        multiSelect: this.multiSelect,\n        visible: !Device.get().supportsFile()\n      });\n      this.fileInput.on('change', this._onFileChange.bind(this));\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"_createKeyStrokeContext\",\n    value: function _createKeyStrokeContext() {\n      return new KeyStrokeContext();\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"_initKeyStrokeContext\",\n    value: function _initKeyStrokeContext() {\n      _get(_getPrototypeOf(FileChooser.prototype), \"_initKeyStrokeContext\", this).call(this);\n\n      this.keyStrokeContext.registerKeyStroke([new FocusAdjacentElementKeyStroke(this.session, this), new ClickActiveElementKeyStroke(this, [keys.SPACE, keys.ENTER]), new CloseKeyStroke(this, function () {\n        return this.$cancelButton;\n      }.bind(this))]);\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      this.$container = this.$parent.appendDiv('file-chooser').on('mousedown', this._onMouseDown.bind(this));\n      var $handle = this.$container.appendDiv('drag-handle');\n      this.$container.draggable($handle);\n      this.$container.appendDiv('closable').on('click', function () {\n        this.cancel();\n      }.bind(this));\n      this.$content = this.$container.appendDiv('file-chooser-content');\n      this.$title = this.$content.appendDiv('file-chooser-title').text(this.session.text(this.multiSelect ? 'ui.ChooseFiles' : 'ui.ChooseFile'));\n      this.fileInput.render(this.$content); // DnD and Multiple files are only supported with the new file api\n\n      if (!this.fileInput.legacy) {\n        // Install DnD support\n        this.$container.on('dragenter', this._onDragEnterOrOver.bind(this)).on('dragover', this._onDragEnterOrOver.bind(this)).on('drop', this._onDrop.bind(this)); // explanation for file chooser\n\n        this.$content.appendDiv('file-chooser-label').text(this.session.text('ui.FileChooserHint')); // List of files\n\n        this.$files = this.$content.appendElement('<ul>', 'file-chooser-files');\n\n        this._installScrollbars();\n      } // Buttons\n\n\n      this.$buttons = this.$container.appendDiv('file-chooser-buttons');\n      var boxButtons = new BoxButtons(this.$buttons);\n\n      if (!this.fileInput.legacy) {\n        this.$addFileButton = boxButtons.addButton({\n          text: this.session.text('ui.Browse'),\n          onClick: this._onAddFileButtonClicked.bind(this),\n          needsClick: true\n        });\n      }\n\n      this.$uploadButton = boxButtons.addButton({\n        text: this.session.text('ui.Upload'),\n        onClick: this._onUploadButtonClicked.bind(this),\n        enabled: false\n      });\n      this.$cancelButton = boxButtons.addButton({\n        text: this.session.text('Cancel'),\n        onClick: this._onCancelButtonClicked.bind(this)\n      });\n      this.htmlComp = HtmlComponent.install(this.$container, this.session);\n      this.htmlComp.setLayout(new FormLayout(this));\n      this.$container.addClassForAnimation('animate-open'); // Prevent resizing when file chooser is dragged off the viewport\n\n      this.$container.addClass('calc-helper');\n      var windowSize = this.$container.windowSize(); // Use css width, but ensure that it is not larger than the window (mobile)\n\n      var w = Math.min(this.$container.width(), windowSize.width - 20);\n      this.$container.css('min-width', w);\n      this.$container.css('max-width', w);\n      this.$container.removeClass('calc-helper');\n      boxButtons.updateButtonWidths(this.$container.width()); // Render modality glasspanes\n\n      this._glassPaneRenderer.renderGlassPanes(); // Now that all texts, paddings, widths etc. are set, we can calculate the position\n\n\n      this._position();\n    }\n  }, {\n    key: \"_renderProperties\",\n    value: function _renderProperties() {\n      _get(_getPrototypeOf(FileChooser.prototype), \"_renderProperties\", this).call(this);\n\n      if (this.fileInput.legacy) {\n        // Files may not be set into native control -> clear list in order to be sync again\n        this.setFiles([]);\n      }\n\n      this._renderFiles();\n    }\n  }, {\n    key: \"_postRender\",\n    value: function _postRender() {\n      _get(_getPrototypeOf(FileChooser.prototype), \"_postRender\", this).call(this);\n\n      this._installFocusContext();\n    }\n  }, {\n    key: \"_remove\",\n    value: function _remove() {\n      this._glassPaneRenderer.removeGlassPanes();\n\n      this._uninstallFocusContext();\n\n      _get(_getPrototypeOf(FileChooser.prototype), \"_remove\", this).call(this);\n    }\n  }, {\n    key: \"_installFocusContext\",\n    value: function _installFocusContext() {\n      this.session.focusManager.installFocusContext(this.$container, FocusRule.AUTO);\n    }\n  }, {\n    key: \"_uninstallFocusContext\",\n    value: function _uninstallFocusContext() {\n      this.session.focusManager.uninstallFocusContext(this.$container);\n    }\n    /**\n     * @override\n     */\n\n  }, {\n    key: \"get$Scrollable\",\n    value: function get$Scrollable() {\n      return this.$files;\n    }\n  }, {\n    key: \"_position\",\n    value: function _position() {\n      this.$container.cssMarginLeft(-this.$container.outerWidth() / 2);\n    }\n  }, {\n    key: \"setDisplayParent\",\n    value: function setDisplayParent(displayParent) {\n      this.setProperty('displayParent', displayParent);\n    }\n  }, {\n    key: \"_setDisplayParent\",\n    value: function _setDisplayParent(displayParent) {\n      this._setProperty('displayParent', displayParent);\n\n      if (displayParent) {\n        this.setParent(this.findDesktop().computeParentForDisplayParent(displayParent));\n      }\n    }\n  }, {\n    key: \"setMaximumUploadSize\",\n    value: function setMaximumUploadSize(maximumUploadSize) {\n      this.setProperty('maximumUploadSize', maximumUploadSize);\n      this.fileInput.setMaximumUploadSize(maximumUploadSize);\n    }\n    /**\n     * Renders the file chooser and links it with the display parent.\n     */\n\n  }, {\n    key: \"open\",\n    value: function open() {\n      this.setDisplayParent(this.displayParent || this.session.desktop);\n      this.displayParent.fileChooserController.registerAndRender(this);\n    }\n    /**\n     * Destroys the file chooser and unlinks it from the display parent.\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      if (!this.rendered) {\n        this.cancel();\n        return;\n      }\n\n      if (this.$cancelButton && this.session.focusManager.requestFocus(this.$cancelButton)) {\n        this.$cancelButton.click();\n      }\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel() {\n      var event = new Event();\n      this.trigger('cancel', event);\n\n      if (!event.defaultPrevented) {\n        this._close();\n      }\n    }\n    /**\n     * Destroys the file chooser and unlinks it from the display parent.\n     */\n\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      if (this.displayParent) {\n        this.displayParent.fileChooserController.unregisterAndRemove(this);\n      }\n\n      this.destroy();\n    }\n  }, {\n    key: \"browse\",\n    value: function browse() {\n      this.fileInput.browse();\n    }\n  }, {\n    key: \"setAcceptTypes\",\n    value: function setAcceptTypes(acceptTypes) {\n      this.setProperty('acceptTypes', acceptTypes);\n      this.fileInput.setAcceptTypes(acceptTypes);\n    }\n  }, {\n    key: \"setMultiSelect\",\n    value: function setMultiSelect(multiSelect) {\n      this.setProperty('multiSelect', multiSelect);\n      this.fileInput.setMultiSelect(multiSelect);\n    }\n  }, {\n    key: \"addFiles\",\n    value: function addFiles(files) {\n      if (files instanceof FileList) {\n        files = FileInput.fileListToArray(files);\n      }\n\n      files = arrays.ensure(files);\n\n      if (files.length === 0) {\n        return;\n      }\n\n      if (!this.multiSelect || this.fileInput.legacy) {\n        files = [files[0]];\n        this.setFiles([files[0]]);\n      } else {\n        // copy so that parameter stays untouched\n        files = files.slice(); // append new files to existing ones\n\n        arrays.insertAll(files, this.files, 0);\n        this.setFiles(files);\n      }\n    }\n  }, {\n    key: \"removeFile\",\n    value: function removeFile(file) {\n      var files = this.files.slice();\n      arrays.remove(files, file);\n      this.setFiles(files); // Clear the input, otherwise user could not choose the file which he has removed previously\n\n      this.fileInput.clear();\n    }\n  }, {\n    key: \"setFiles\",\n    value: function setFiles(files) {\n      if (files instanceof FileList) {\n        files = FileInput.fileListToArray(files);\n      }\n\n      files = arrays.ensure(files);\n\n      try {\n        this.fileInput.validateMaximumUploadSize(files);\n      } catch (errorMessage) {\n        MessageBoxes.createOk(this).withHeader(this.session.text('ui.FileSizeLimitTitle')).withBody(errorMessage).withSeverity(Status.Severity.ERROR).buildAndOpen();\n        return;\n      }\n\n      this.setProperty('files', files);\n    }\n  }, {\n    key: \"_renderFiles\",\n    value: function _renderFiles() {\n      var files = this.files;\n\n      if (!this.fileInput.legacy) {\n        this.$files.empty();\n        files.forEach(function (file) {\n          var $file = this.$files.appendElement('<li>', 'file', file.name); // Append a space to allow the browser to break the line here when it gets too long\n\n          $file.append(' ');\n          var $remove = $file.appendSpan('remove menu-item').on('click', this.removeFile.bind(this, file));\n          var $removeLink = $file.makeElement('<a>', 'remove-link', this.session.text('Remove'));\n          $remove.appendTextNode('(');\n          $remove.append($removeLink);\n          $remove.appendTextNode(')');\n        }, this);\n        scrollbars.update(this.$files);\n      }\n\n      this.$uploadButton.setEnabled(files.length > 0);\n    }\n  }, {\n    key: \"_onDragEnterOrOver\",\n    value: function _onDragEnterOrOver(event) {\n      dragAndDrop.verifyDataTransferTypesScoutTypes(event, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER);\n    }\n  }, {\n    key: \"_onDrop\",\n    value: function _onDrop(event) {\n      if (dragAndDrop.dataTransferTypesContainsScoutTypes(event.originalEvent.dataTransfer, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)) {\n        $.suppressEvent(event);\n        this.addFiles(event.originalEvent.dataTransfer.files);\n      }\n    }\n  }, {\n    key: \"_onUploadButtonClicked\",\n    value: function _onUploadButtonClicked(event) {\n      this.trigger('upload');\n    }\n  }, {\n    key: \"_onCancelButtonClicked\",\n    value: function _onCancelButtonClicked(event) {\n      this.cancel();\n    }\n  }, {\n    key: \"_onAddFileButtonClicked\",\n    value: function _onAddFileButtonClicked(event) {\n      this.browse();\n    }\n  }, {\n    key: \"_onFileChange\",\n    value: function _onFileChange(event) {\n      this.addFiles(event.files);\n    }\n  }, {\n    key: \"_onMouseDown\",\n    value: function _onMouseDown(event, option) {\n      // If there is a dialog in the parent-hierarchy activate it in order to bring it on top of other dialogs.\n      var parent = this.findParent(function (p) {\n        return p instanceof Form && p.isDialog();\n      });\n\n      if (parent) {\n        parent.activate();\n      }\n    }\n    /**\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"_attach\",\n    value: function _attach() {\n      this.$parent.append(this.$container);\n\n      _get(_getPrototypeOf(FileChooser.prototype), \"_attach\", this).call(this);\n    }\n    /**\n     * @override Widget.js\n     */\n\n  }, {\n    key: \"_detach\",\n    value: function _detach() {\n      this.$container.detach();\n\n      _get(_getPrototypeOf(FileChooser.prototype), \"_detach\", this).call(this);\n    }\n  }]);\n\n  return FileChooser;\n}(Widget);\n\nexport { FileChooser as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/filechooser/FileChooser.js"],"names":["arrays","BoxButtons","ClickActiveElementKeyStroke","CloseKeyStroke","Device","dragAndDrop","Event","FileInput","FocusAdjacentElementKeyStroke","FocusRule","Form","FormLayout","GlassPaneRenderer","HtmlComponent","keys","KeyStrokeContext","MessageBoxes","scout","scrollbars","Status","Widget","$","FileChooser","displayParent","files","_glassPaneRenderer","maximumUploadSize","DEFAULT_MAXIMUM_UPLOAD_SIZE","model","_setDisplayParent","fileInput","create","parent","acceptTypes","multiSelect","visible","get","supportsFile","on","_onFileChange","bind","keyStrokeContext","registerKeyStroke","session","SPACE","ENTER","$cancelButton","$container","$parent","appendDiv","_onMouseDown","$handle","draggable","cancel","$content","$title","text","render","legacy","_onDragEnterOrOver","_onDrop","$files","appendElement","_installScrollbars","$buttons","boxButtons","$addFileButton","addButton","onClick","_onAddFileButtonClicked","needsClick","$uploadButton","_onUploadButtonClicked","enabled","_onCancelButtonClicked","htmlComp","install","setLayout","addClassForAnimation","addClass","windowSize","w","Math","min","width","css","removeClass","updateButtonWidths","renderGlassPanes","_position","setFiles","_renderFiles","_installFocusContext","removeGlassPanes","_uninstallFocusContext","focusManager","installFocusContext","AUTO","uninstallFocusContext","cssMarginLeft","outerWidth","setProperty","_setProperty","setParent","findDesktop","computeParentForDisplayParent","setMaximumUploadSize","setDisplayParent","desktop","fileChooserController","registerAndRender","rendered","requestFocus","click","event","trigger","defaultPrevented","_close","unregisterAndRemove","destroy","browse","setAcceptTypes","setMultiSelect","FileList","fileListToArray","ensure","length","slice","insertAll","file","remove","clear","validateMaximumUploadSize","errorMessage","createOk","withHeader","withBody","withSeverity","Severity","ERROR","buildAndOpen","empty","forEach","$file","name","append","$remove","appendSpan","removeFile","$removeLink","makeElement","appendTextNode","update","setEnabled","verifyDataTransferTypesScoutTypes","SCOUT_TYPES","FILE_TRANSFER","dataTransferTypesContainsScoutTypes","originalEvent","dataTransfer","suppressEvent","addFiles","option","findParent","p","isDialog","activate","detach"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {\n  arrays,\n  BoxButtons,\n  ClickActiveElementKeyStroke,\n  CloseKeyStroke,\n  Device,\n  dragAndDrop,\n  Event,\n  FileInput,\n  FocusAdjacentElementKeyStroke,\n  FocusRule,\n  Form,\n  FormLayout,\n  GlassPaneRenderer,\n  HtmlComponent,\n  keys,\n  KeyStrokeContext,\n  MessageBoxes,\n  scout,\n  scrollbars,\n  Status,\n  Widget\n} from '../index';\nimport $ from 'jquery';\n\nexport default class FileChooser extends Widget {\n\n  constructor() {\n    super();\n    this.displayParent = null;\n    this.files = [];\n    this._glassPaneRenderer = null;\n    this.maximumUploadSize = FileInput.DEFAULT_MAXIMUM_UPLOAD_SIZE;\n  }\n\n  _init(model) {\n    super._init(model);\n    this._setDisplayParent(this.displayParent);\n    this._glassPaneRenderer = new GlassPaneRenderer(this);\n    this.fileInput = scout.create('FileInput', {\n      parent: this,\n      acceptTypes: this.acceptTypes,\n      maximumUploadSize: this.maximumUploadSize,\n      multiSelect: this.multiSelect,\n      visible: !Device.get().supportsFile()\n    });\n    this.fileInput.on('change', this._onFileChange.bind(this));\n  }\n\n  /**\n   * @override\n   */\n  _createKeyStrokeContext() {\n    return new KeyStrokeContext();\n  }\n\n  /**\n   * @override\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n\n    this.keyStrokeContext.registerKeyStroke([\n      new FocusAdjacentElementKeyStroke(this.session, this),\n      new ClickActiveElementKeyStroke(this, [\n        keys.SPACE, keys.ENTER\n      ]),\n      new CloseKeyStroke(this, function() {\n        return this.$cancelButton;\n      }.bind(this))\n    ]);\n  }\n\n  _render() {\n    this.$container = this.$parent.appendDiv('file-chooser')\n      .on('mousedown', this._onMouseDown.bind(this));\n    var $handle = this.$container.appendDiv('drag-handle');\n    this.$container.draggable($handle);\n\n    this.$container.appendDiv('closable')\n      .on('click', function() {\n        this.cancel();\n      }.bind(this));\n\n    this.$content = this.$container.appendDiv('file-chooser-content');\n    this.$title = this.$content.appendDiv('file-chooser-title')\n      .text(this.session.text(this.multiSelect ? 'ui.ChooseFiles' : 'ui.ChooseFile'));\n\n    this.fileInput.render(this.$content);\n\n    // DnD and Multiple files are only supported with the new file api\n    if (!this.fileInput.legacy) {\n\n      // Install DnD support\n      this.$container.on('dragenter', this._onDragEnterOrOver.bind(this))\n        .on('dragover', this._onDragEnterOrOver.bind(this))\n        .on('drop', this._onDrop.bind(this));\n\n      // explanation for file chooser\n      this.$content.appendDiv('file-chooser-label')\n        .text(this.session.text('ui.FileChooserHint'));\n\n      // List of files\n      this.$files = this.$content.appendElement('<ul>', 'file-chooser-files');\n      this._installScrollbars();\n    }\n\n    // Buttons\n    this.$buttons = this.$container.appendDiv('file-chooser-buttons');\n    var boxButtons = new BoxButtons(this.$buttons);\n    if (!this.fileInput.legacy) {\n      this.$addFileButton = boxButtons.addButton({\n        text: this.session.text('ui.Browse'),\n        onClick: this._onAddFileButtonClicked.bind(this),\n        needsClick: true\n      });\n    }\n    this.$uploadButton = boxButtons.addButton({\n      text: this.session.text('ui.Upload'),\n      onClick: this._onUploadButtonClicked.bind(this),\n      enabled: false\n    });\n    this.$cancelButton = boxButtons.addButton({\n      text: this.session.text('Cancel'),\n      onClick: this._onCancelButtonClicked.bind(this)\n    });\n\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n    this.htmlComp.setLayout(new FormLayout(this));\n\n    this.$container.addClassForAnimation('animate-open');\n    // Prevent resizing when file chooser is dragged off the viewport\n    this.$container.addClass('calc-helper');\n    var windowSize = this.$container.windowSize();\n    // Use css width, but ensure that it is not larger than the window (mobile)\n    var w = Math.min(this.$container.width(), windowSize.width - 20);\n    this.$container.css('min-width', w);\n    this.$container.css('max-width', w);\n    this.$container.removeClass('calc-helper');\n    boxButtons.updateButtonWidths(this.$container.width());\n\n    // Render modality glasspanes\n    this._glassPaneRenderer.renderGlassPanes();\n\n    // Now that all texts, paddings, widths etc. are set, we can calculate the position\n    this._position();\n  }\n\n  _renderProperties() {\n    super._renderProperties();\n    if (this.fileInput.legacy) {\n      // Files may not be set into native control -> clear list in order to be sync again\n      this.setFiles([]);\n    }\n    this._renderFiles();\n  }\n\n  _postRender() {\n    super._postRender();\n    this._installFocusContext();\n  }\n\n  _remove() {\n    this._glassPaneRenderer.removeGlassPanes();\n    this._uninstallFocusContext();\n    super._remove();\n  }\n\n  _installFocusContext() {\n    this.session.focusManager.installFocusContext(this.$container, FocusRule.AUTO);\n  }\n\n  _uninstallFocusContext() {\n    this.session.focusManager.uninstallFocusContext(this.$container);\n  }\n\n  /**\n   * @override\n   */\n  get$Scrollable() {\n    return this.$files;\n  }\n\n  _position() {\n    this.$container.cssMarginLeft(-this.$container.outerWidth() / 2);\n  }\n\n  setDisplayParent(displayParent) {\n    this.setProperty('displayParent', displayParent);\n  }\n\n  _setDisplayParent(displayParent) {\n    this._setProperty('displayParent', displayParent);\n    if (displayParent) {\n      this.setParent(this.findDesktop().computeParentForDisplayParent(displayParent));\n    }\n  }\n\n  setMaximumUploadSize(maximumUploadSize) {\n    this.setProperty('maximumUploadSize', maximumUploadSize);\n    this.fileInput.setMaximumUploadSize(maximumUploadSize);\n  }\n\n  /**\n   * Renders the file chooser and links it with the display parent.\n   */\n  open() {\n    this.setDisplayParent(this.displayParent || this.session.desktop);\n    this.displayParent.fileChooserController.registerAndRender(this);\n  }\n\n  /**\n   * Destroys the file chooser and unlinks it from the display parent.\n   */\n  close() {\n    if (!this.rendered) {\n      this.cancel();\n      return;\n    }\n    if (this.$cancelButton && this.session.focusManager.requestFocus(this.$cancelButton)) {\n      this.$cancelButton.click();\n    }\n  }\n\n  cancel() {\n    var event = new Event();\n    this.trigger('cancel', event);\n    if (!event.defaultPrevented) {\n      this._close();\n    }\n  }\n\n  /**\n   * Destroys the file chooser and unlinks it from the display parent.\n   */\n  _close() {\n    if (this.displayParent) {\n      this.displayParent.fileChooserController.unregisterAndRemove(this);\n    }\n    this.destroy();\n  }\n\n  browse() {\n    this.fileInput.browse();\n  }\n\n  setAcceptTypes(acceptTypes) {\n    this.setProperty('acceptTypes', acceptTypes);\n    this.fileInput.setAcceptTypes(acceptTypes);\n  }\n\n  setMultiSelect(multiSelect) {\n    this.setProperty('multiSelect', multiSelect);\n    this.fileInput.setMultiSelect(multiSelect);\n  }\n\n  addFiles(files) {\n    if (files instanceof FileList) {\n      files = FileInput.fileListToArray(files);\n    }\n    files = arrays.ensure(files);\n    if (files.length === 0) {\n      return;\n    }\n    if (!this.multiSelect || this.fileInput.legacy) {\n      files = [files[0]];\n      this.setFiles([files[0]]);\n    } else {\n      // copy so that parameter stays untouched\n      files = files.slice();\n      // append new files to existing ones\n      arrays.insertAll(files, this.files, 0);\n      this.setFiles(files);\n    }\n  }\n\n  removeFile(file) {\n    var files = this.files.slice();\n    arrays.remove(files, file);\n    this.setFiles(files);\n    // Clear the input, otherwise user could not choose the file which he has removed previously\n    this.fileInput.clear();\n  }\n\n  setFiles(files) {\n    if (files instanceof FileList) {\n      files = FileInput.fileListToArray(files);\n    }\n    files = arrays.ensure(files);\n\n    try {\n      this.fileInput.validateMaximumUploadSize(files);\n    } catch (errorMessage) {\n      MessageBoxes.createOk(this)\n        .withHeader(this.session.text('ui.FileSizeLimitTitle'))\n        .withBody(errorMessage)\n        .withSeverity(Status.Severity.ERROR)\n        .buildAndOpen();\n      return;\n    }\n\n    this.setProperty('files', files);\n  }\n\n  _renderFiles() {\n    var files = this.files;\n\n    if (!this.fileInput.legacy) {\n      this.$files.empty();\n      files.forEach(function(file) {\n        var $file = this.$files.appendElement('<li>', 'file', file.name);\n        // Append a space to allow the browser to break the line here when it gets too long\n        $file.append(' ');\n        var $remove = $file\n          .appendSpan('remove menu-item')\n          .on('click', this.removeFile.bind(this, file));\n        var $removeLink = $file.makeElement('<a>', 'remove-link', this.session.text('Remove'));\n        $remove.appendTextNode('(');\n        $remove.append($removeLink);\n        $remove.appendTextNode(')');\n      }, this);\n      scrollbars.update(this.$files);\n    }\n    this.$uploadButton.setEnabled(files.length > 0);\n  }\n\n  _onDragEnterOrOver(event) {\n    dragAndDrop.verifyDataTransferTypesScoutTypes(event, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER);\n  }\n\n  _onDrop(event) {\n    if (dragAndDrop.dataTransferTypesContainsScoutTypes(event.originalEvent.dataTransfer, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)) {\n      $.suppressEvent(event);\n      this.addFiles(event.originalEvent.dataTransfer.files);\n    }\n  }\n\n  _onUploadButtonClicked(event) {\n    this.trigger('upload');\n  }\n\n  _onCancelButtonClicked(event) {\n    this.cancel();\n  }\n\n  _onAddFileButtonClicked(event) {\n    this.browse();\n  }\n\n  _onFileChange(event) {\n    this.addFiles(event.files);\n  }\n\n  _onMouseDown(event, option) {\n    // If there is a dialog in the parent-hierarchy activate it in order to bring it on top of other dialogs.\n    var parent = this.findParent(function(p) {\n      return p instanceof Form && p.isDialog();\n    });\n    if (parent) {\n      parent.activate();\n    }\n  }\n\n  /**\n   * @override Widget.js\n   */\n  _attach() {\n    this.$parent.append(this.$container);\n    super._attach();\n  }\n\n  /**\n   * @override Widget.js\n   */\n  _detach() {\n    this.$container.detach();\n    super._detach();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}