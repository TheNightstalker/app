{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { dates, Popup, Range, scout, strings, Widget } from '../index';\nimport $ from 'jquery';\n\nvar CalendarComponent = /*#__PURE__*/function (_Widget) {\n  _inherits(CalendarComponent, _Widget);\n\n  var _super = _createSuper(CalendarComponent);\n\n  function CalendarComponent() {\n    var _this;\n\n    _classCallCheck(this, CalendarComponent);\n\n    _this = _super.call(this);\n    /**\n     * Selected is a GUI only property (the model doesn't have it)\n     */\n\n    _this.selected = false;\n    _this.fullDay = false;\n    _this.item = null;\n    _this._$parts = [];\n    return _this;\n  }\n  /**\n   * If day of a month is smaller than 100px, the components get the class compact\n   */\n\n\n  _createClass(CalendarComponent, [{\n    key: \"_init\",\n    value: function _init(model) {\n      _get(_getPrototypeOf(CalendarComponent.prototype), \"_init\", this).call(this, model);\n\n      this._syncCoveredDaysRange(this.coveredDaysRange);\n    }\n  }, {\n    key: \"_syncCoveredDaysRange\",\n    value: function _syncCoveredDaysRange(coveredDaysRange) {\n      if (coveredDaysRange) {\n        this.coveredDaysRange = new Range(dates.parseJsonDate(coveredDaysRange.from), dates.parseJsonDate(coveredDaysRange.to));\n      }\n    }\n  }, {\n    key: \"_remove\",\n    value: function _remove() {\n      // remove $parts because they're not children of this.$container\n      this._$parts.forEach(function ($part) {\n        $part.remove();\n      });\n\n      this._$parts = [];\n\n      _get(_getPrototypeOf(CalendarComponent.prototype), \"_remove\", this).call(this);\n    }\n  }, {\n    key: \"_startLoopDay\",\n    value: function _startLoopDay() {\n      // start date is either beginning of the component or beginning of viewRange\n      if (dates.compare(this.coveredDaysRange.from, this.parent.viewRange.from) > 0) {\n        return this.coveredDaysRange.from;\n      }\n\n      return this.parent.viewRange.from;\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      var partDay, $day, $part;\n\n      if (!this.coveredDaysRange) {\n        // coveredDaysRange is not set on current CalendarComponent. Cannot show calendar component without from and to values.\n        return;\n      }\n\n      var loopDay = this._startLoopDay();\n\n      var appointmentToDate = dates.parseJsonDate(this.toDate);\n      var appointmentFromDate = dates.parseJsonDate(this.fromDate);\n      var coveredDaysRangeTo = this.coveredDaysRange.to;\n\n      if (!this.fullDay) {\n        var truncToDate = dates.trunc(appointmentToDate);\n\n        if (!dates.isSameDay(appointmentFromDate, appointmentToDate) && dates.compare(appointmentToDate, truncToDate) === 0) {\n          appointmentToDate = dates.shiftTime(appointmentToDate, 0, 0, 0, -1);\n          coveredDaysRangeTo = dates.shift(coveredDaysRangeTo, 0, 0, -1);\n        }\n      }\n\n      appointmentToDate = dates.toJsonDate(appointmentToDate);\n      var lastComponentDay = dates.shift(coveredDaysRangeTo, 0, 0, 1);\n\n      if (dates.compare(loopDay, lastComponentDay) > 0) {\n        // start day for the while loop is greater then the exit condition\n        return;\n      }\n\n      while (!dates.isSameDay(loopDay, lastComponentDay)) {\n        partDay = loopDay;\n        loopDay = dates.shift(loopDay, 0, 0, 1); // increase day for loop\n        // check if day is in visible view range\n\n        if (dates.compare(partDay, this.parent.viewRange.to) > 0) {\n          // break condition, partDay is now out of range.\n          break;\n        }\n\n        if (this.fullDay && !this.parent._isMonth()) {\n          $day = this._findDayInGrid(partDay, this.parent.$topGrid);\n        } else {\n          $day = this._findDayInGrid(partDay, this.parent.$grid);\n        }\n\n        if (!$day) {\n          // next day, partDay not found in grid\n          continue;\n        }\n\n        $part = $day.appendDiv('calendar-component');\n        $part.addClass(this.item.cssClass).data('component', this).data('partDay', partDay).mousedown(this._onMouseDown.bind(this)).on('contextmenu', this._onContextMenu.bind(this));\n        $part.appendDiv('calendar-component-leftcolorborder');\n        $part.appendDiv('content', this.item.subject);\n\n        this._$parts.push($part);\n\n        if (this.parent._isMonth()) {\n          var width = $day.data('new-width') || $day.width(); // prefer width from layoutSize\n\n          $part.addClass('component-month').toggleClass('compact', width < CalendarComponent.MONTH_COMPACT_THRESHOLD);\n        } else {\n          if (this.fullDay) {\n            // Full day tasks are rendered in the topGrid\n            var alreadyExistingTasks = $('.component-task', $day).length; // Offset of initial task: 30px for the day-of-month number\n            // Offset of following tasks: 26px * preceding number of tasks. 26px: Task 23px high, 1px border. Spaced by 2px\n\n            this._arrangeTask(30 + 26 * alreadyExistingTasks);\n\n            $part.addClass('component-task');\n          } else {\n            var fromDate = dates.parseJsonDate(this.fromDate),\n                toDate = dates.parseJsonDate(appointmentToDate),\n                partFrom = this._getHours(this.fromDate),\n                partTo = this._getHours(appointmentToDate); // position and height depending on start and end date\n\n\n            $part.addClass('component-day');\n\n            if (dates.isSameDay(dates.trunc(this.coveredDaysRange.from), dates.trunc(coveredDaysRangeTo))) {\n              this._partPosition($part, partFrom, partTo);\n            } else if (dates.isSameDay(partDay, fromDate)) {\n              this._partPosition($part, partFrom, 25) // 25: indicate that it takes longer than that day\n              .addClass('component-open-bottom');\n            } else if (dates.isSameDay(partDay, toDate)) {\n              // Start at zero: No need to indicate that it starts earlier since indicator needs no extra space\n              this._partPosition($part, 0, partTo).addClass('component-open-top');\n            } else {\n              this._partPosition($part, 0, 25) // 25: indicate that it takes longer than that day\n              .addClass('component-open-top').addClass('component-open-bottom');\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_getHours\",\n    value: function _getHours(date) {\n      var d = dates.parseJsonDate(date);\n      return d.getHours() + d.getMinutes() / 60;\n    }\n  }, {\n    key: \"_findDayInGrid\",\n    value: function _findDayInGrid(date, $grid) {\n      return $grid.find('.calendar-day').filter(function (i, elem) {\n        return dates.isSameDay($(this).data('date'), date);\n      }).eq(0);\n    }\n  }, {\n    key: \"_isTask\",\n    value: function _isTask() {\n      return !this.parent._isMonth() && this.fullDay;\n    }\n  }, {\n    key: \"_arrangeTask\",\n    value: function _arrangeTask(taskOffset) {\n      this._$parts.forEach(function ($part) {\n        $part.css('top', taskOffset + 'px');\n      });\n    }\n  }, {\n    key: \"_isDayPart\",\n    value: function _isDayPart() {\n      return !this.parent._isMonth() && !this.fullDay;\n    }\n  }, {\n    key: \"_getHourRange\",\n    value: function _getHourRange(day) {\n      var hourRange = new Range(this._getHours(this.fromDate), this._getHours(this.toDate));\n      var dateRange = new Range(dates.parseJsonDate(this.fromDate), dates.parseJsonDate(this.toDate));\n\n      if (dates.isSameDay(day, dateRange.from) && dates.isSameDay(day, dateRange.to)) {\n        return new Range(hourRange.from, hourRange.to);\n      } else if (dates.isSameDay(day, dateRange.from)) {\n        return new Range(hourRange.from, 24);\n      } else if (dates.isSameDay(day, dateRange.to)) {\n        return new Range(0, hourRange.to);\n      }\n\n      return new Range(0, 24);\n    }\n  }, {\n    key: \"getPartDayPosition\",\n    value: function getPartDayPosition(day) {\n      return this._getDisplayDayPosition(this._getHourRange(day));\n    }\n  }, {\n    key: \"_getDisplayDayPosition\",\n    value: function _getDisplayDayPosition(range) {\n      // Doesn't support minutes yet...\n      var preferredRange = new Range(this.parent._dayPosition(range.from, 0), this.parent._dayPosition(range.to, 0)); // Fixed number of divisions...\n\n      var minRangeSize = Math.round(100 * 100 / 24 / this.parent.numberOfHourDivisions) / 100; // Round to two digits\n\n      if (preferredRange.size() < minRangeSize) {\n        return new Range(preferredRange.from, preferredRange.from + minRangeSize);\n      }\n\n      return preferredRange;\n    }\n  }, {\n    key: \"_partPosition\",\n    value: function _partPosition($part, y1, y2) {\n      // Compensate open bottom (height: square of 16px, rotated 45°, approx. 23px = sqrt(16^2 + 16^2)\n      var compensateBottom = y2 === 25 ? 23 : 0;\n      y2 = Math.min(24, y2);\n      var range = new Range(y1, y2);\n\n      var r = this._getDisplayDayPosition(range); // Convert to %, rounded to two decimal places\n\n\n      compensateBottom = Math.round(100 * (100 / 1920 * compensateBottom)) / 100;\n      return $part.css('top', r.from + '%').css('height', r.to - r.from - compensateBottom + '%');\n    }\n  }, {\n    key: \"_renderProperties\",\n    value: function _renderProperties() {\n      _get(_getPrototypeOf(CalendarComponent.prototype), \"_renderProperties\", this).call(this);\n\n      this._renderSelected();\n    }\n  }, {\n    key: \"_renderSelected\",\n    value: function _renderSelected() {\n      this._$parts.forEach(function ($part) {\n        $part.toggleClass('comp-selected', this.selected);\n      }, this);\n    }\n  }, {\n    key: \"setSelected\",\n    value: function setSelected(selected) {\n      this.setProperty('selected', selected);\n    }\n  }, {\n    key: \"updateSelectedComponent\",\n    value: function updateSelectedComponent($part, updateScrollPosition) {\n      this.parent._selectedComponentChanged(this, $part.data('partDay'), updateScrollPosition);\n    }\n  }, {\n    key: \"_onMouseDown\",\n    value: function _onMouseDown(event) {\n      var $part = $(event.delegateTarget);\n      this.updateSelectedComponent($part, false);\n\n      if (event.button === 0) {\n        var popup = scout.create('WidgetPopup', {\n          parent: this.parent,\n          $anchor: $part,\n          closeOnAnchorMouseDown: true,\n          closeOnMouseDownOutside: true,\n          closeOnOtherPopupOpen: true,\n          horizontalAlignment: Popup.Alignment.LEFT,\n          verticalAlignment: Popup.Alignment.CENTER,\n          trimWidth: false,\n          trimHeight: false,\n          horizontalSwitch: true,\n          verticalSwitch: true,\n          withArrow: true,\n          cssClass: 'tooltip',\n          scrollType: 'remove',\n          location: {\n            y: event.originalEvent.clientY\n          },\n          widget: {\n            objectType: 'Label',\n            htmlEnabled: true,\n            cssClass: 'tooltip-content',\n            value: this._description()\n          }\n        });\n        popup.open();\n      } // stop propagation to avoid fire mouse-down event on calendar-day (Calendar#_onDayMouseDown)\n\n\n      event.stopPropagation();\n    }\n  }, {\n    key: \"_onContextMenu\",\n    value: function _onContextMenu(event) {\n      this.parent._showContextMenu(event, 'Calendar.CalendarComponent');\n    }\n  }, {\n    key: \"_format\",\n    value: function _format(date, pattern) {\n      return dates.format(date, this.session.locale, pattern);\n    }\n  }, {\n    key: \"_description\",\n    value: function _description() {\n      var descParts = [],\n          range = null,\n          text = '',\n          fromDate = dates.parseJsonDate(this.fromDate),\n          toDate = dates.parseJsonDate(this.toDate); // subject\n\n      if (strings.hasText(this.item.subject)) {\n        descParts.push({\n          text: strings.encode(this.item.subject),\n          cssClass: 'calendar-component-title'\n        });\n      } // time-range\n\n\n      if (this.fullDay) {// NOP\n      } else if (dates.isSameDay(fromDate, toDate)) {\n        range = this.session.text('ui.FromXToY', this._format(fromDate, 'HH:mm'), this._format(toDate, 'HH:mm'));\n      } else {\n        range = this.session.text('ui.FromXToY', this._format(fromDate, 'EEEE HH:mm '), this._format(toDate, 'EEEE HH:mm'));\n      }\n\n      if (strings.hasText(range)) {\n        descParts.push({\n          text: range,\n          cssClass: 'calendar-component-intro'\n        });\n      } // description\n\n\n      if (strings.hasText(this.item.description)) {\n        descParts.push({\n          text: strings.nl2br(this.item.description)\n        });\n      } // build text\n\n\n      descParts.forEach(function (part) {\n        text += (part.cssClass ? '<span class=\"' + part.cssClass + '\">' + part.text + '</span>' : part.text) + '<br/>';\n      });\n      return text;\n    }\n  }]);\n\n  return CalendarComponent;\n}(Widget);\n\n_defineProperty(CalendarComponent, \"MONTH_COMPACT_THRESHOLD\", 100);\n\nexport { CalendarComponent as default };","map":{"version":3,"sources":["C:/Tools/workspace/nightstalker/nightstalker.ui.html/node_modules/@eclipse-scout/core/src/calendar/CalendarComponent.js"],"names":["dates","Popup","Range","scout","strings","Widget","$","CalendarComponent","selected","fullDay","item","_$parts","model","_syncCoveredDaysRange","coveredDaysRange","parseJsonDate","from","to","forEach","$part","remove","compare","parent","viewRange","partDay","$day","loopDay","_startLoopDay","appointmentToDate","toDate","appointmentFromDate","fromDate","coveredDaysRangeTo","truncToDate","trunc","isSameDay","shiftTime","shift","toJsonDate","lastComponentDay","_isMonth","_findDayInGrid","$topGrid","$grid","appendDiv","addClass","cssClass","data","mousedown","_onMouseDown","bind","on","_onContextMenu","subject","push","width","toggleClass","MONTH_COMPACT_THRESHOLD","alreadyExistingTasks","length","_arrangeTask","partFrom","_getHours","partTo","_partPosition","date","d","getHours","getMinutes","find","filter","i","elem","eq","taskOffset","css","day","hourRange","dateRange","_getDisplayDayPosition","_getHourRange","range","preferredRange","_dayPosition","minRangeSize","Math","round","numberOfHourDivisions","size","y1","y2","compensateBottom","min","r","_renderSelected","setProperty","updateScrollPosition","_selectedComponentChanged","event","delegateTarget","updateSelectedComponent","button","popup","create","$anchor","closeOnAnchorMouseDown","closeOnMouseDownOutside","closeOnOtherPopupOpen","horizontalAlignment","Alignment","LEFT","verticalAlignment","CENTER","trimWidth","trimHeight","horizontalSwitch","verticalSwitch","withArrow","scrollType","location","y","originalEvent","clientY","widget","objectType","htmlEnabled","value","_description","open","stopPropagation","_showContextMenu","pattern","format","session","locale","descParts","text","hasText","encode","_format","description","nl2br","part"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {dates, Popup, Range, scout, strings, Widget} from '../index';\nimport $ from 'jquery';\n\nexport default class CalendarComponent extends Widget {\n\n  constructor() {\n    super();\n\n    /**\n     * Selected is a GUI only property (the model doesn't have it)\n     */\n    this.selected = false;\n    this.fullDay = false;\n    this.item = null;\n    this._$parts = [];\n  }\n\n  /**\n   * If day of a month is smaller than 100px, the components get the class compact\n   */\n  static MONTH_COMPACT_THRESHOLD = 100;\n\n  _init(model) {\n    super._init(model);\n\n    this._syncCoveredDaysRange(this.coveredDaysRange);\n  }\n\n  _syncCoveredDaysRange(coveredDaysRange) {\n    if (coveredDaysRange) {\n      this.coveredDaysRange = new Range(\n        dates.parseJsonDate(coveredDaysRange.from),\n        dates.parseJsonDate(coveredDaysRange.to));\n    }\n  }\n\n  _remove() {\n    // remove $parts because they're not children of this.$container\n    this._$parts.forEach(function($part) {\n      $part.remove();\n    });\n    this._$parts = [];\n    super._remove();\n  }\n\n  _startLoopDay() {\n    // start date is either beginning of the component or beginning of viewRange\n    if (dates.compare(this.coveredDaysRange.from, this.parent.viewRange.from) > 0) {\n      return this.coveredDaysRange.from;\n    }\n    return this.parent.viewRange.from;\n  }\n\n  _render() {\n    var partDay, $day, $part;\n    if (!this.coveredDaysRange) {\n      // coveredDaysRange is not set on current CalendarComponent. Cannot show calendar component without from and to values.\n      return;\n    }\n\n    var loopDay = this._startLoopDay();\n\n    var appointmentToDate = dates.parseJsonDate(this.toDate);\n    var appointmentFromDate = dates.parseJsonDate(this.fromDate);\n    var coveredDaysRangeTo = this.coveredDaysRange.to;\n\n    if (!this.fullDay) {\n      var truncToDate = dates.trunc(appointmentToDate);\n      if (!dates.isSameDay(appointmentFromDate, appointmentToDate) && dates.compare(appointmentToDate, truncToDate) === 0) {\n        appointmentToDate = dates.shiftTime(appointmentToDate, 0, 0, 0, -1);\n        coveredDaysRangeTo = dates.shift(coveredDaysRangeTo, 0, 0, -1);\n      }\n    }\n    appointmentToDate = dates.toJsonDate(appointmentToDate);\n\n    var lastComponentDay = dates.shift(coveredDaysRangeTo, 0, 0, 1);\n\n    if (dates.compare(loopDay, lastComponentDay) > 0) {\n      // start day for the while loop is greater then the exit condition\n      return;\n    }\n\n    while (!dates.isSameDay(loopDay, lastComponentDay)) {\n      partDay = loopDay;\n      loopDay = dates.shift(loopDay, 0, 0, 1); // increase day for loop\n\n      // check if day is in visible view range\n      if (dates.compare(partDay, this.parent.viewRange.to) > 0) {\n        // break condition, partDay is now out of range.\n        break;\n      }\n\n      if (this.fullDay && !this.parent._isMonth()) {\n        $day = this._findDayInGrid(partDay, this.parent.$topGrid);\n      } else {\n        $day = this._findDayInGrid(partDay, this.parent.$grid);\n      }\n      if (!$day) {\n        // next day, partDay not found in grid\n        continue;\n      }\n      $part = $day.appendDiv('calendar-component');\n\n      $part\n        .addClass(this.item.cssClass)\n        .data('component', this)\n        .data('partDay', partDay)\n        .mousedown(this._onMouseDown.bind(this))\n        .on('contextmenu', this._onContextMenu.bind(this));\n      $part.appendDiv('calendar-component-leftcolorborder');\n      $part.appendDiv('content', this.item.subject);\n\n      this._$parts.push($part);\n\n      if (this.parent._isMonth()) {\n        var width = $day.data('new-width') || $day.width(); // prefer width from layoutSize\n        $part.addClass('component-month')\n          .toggleClass('compact', width < CalendarComponent.MONTH_COMPACT_THRESHOLD);\n      } else {\n        if (this.fullDay) {\n          // Full day tasks are rendered in the topGrid\n          var alreadyExistingTasks = $('.component-task', $day).length;\n          // Offset of initial task: 30px for the day-of-month number\n          // Offset of following tasks: 26px * preceding number of tasks. 26px: Task 23px high, 1px border. Spaced by 2px\n          this._arrangeTask(30 + 26 * alreadyExistingTasks);\n          $part.addClass('component-task');\n        } else {\n          var\n            fromDate = dates.parseJsonDate(this.fromDate),\n            toDate = dates.parseJsonDate(appointmentToDate),\n            partFrom = this._getHours(this.fromDate),\n            partTo = this._getHours(appointmentToDate);\n\n          // position and height depending on start and end date\n          $part.addClass('component-day');\n          if (dates.isSameDay(dates.trunc(this.coveredDaysRange.from), dates.trunc(coveredDaysRangeTo))) {\n            this._partPosition($part, partFrom, partTo);\n          } else if (dates.isSameDay(partDay, fromDate)) {\n            this._partPosition($part, partFrom, 25) // 25: indicate that it takes longer than that day\n              .addClass('component-open-bottom');\n          } else if (dates.isSameDay(partDay, toDate)) {\n            // Start at zero: No need to indicate that it starts earlier since indicator needs no extra space\n            this._partPosition($part, 0, partTo)\n              .addClass('component-open-top');\n          } else {\n\n            this._partPosition($part, 0, 25) // 25: indicate that it takes longer than that day\n              .addClass('component-open-top')\n              .addClass('component-open-bottom');\n          }\n        }\n      }\n    }\n  }\n\n  _getHours(date) {\n    var d = dates.parseJsonDate(date);\n    return d.getHours() + d.getMinutes() / 60;\n  }\n\n  _findDayInGrid(date, $grid) {\n    return $grid.find('.calendar-day').filter(\n      function(i, elem) {\n        return dates.isSameDay($(this).data('date'), date);\n      }).eq(0);\n  }\n\n  _isTask() {\n    return !this.parent._isMonth() && this.fullDay;\n  }\n\n  _arrangeTask(taskOffset) {\n    this._$parts.forEach(function($part) {\n      $part.css('top', taskOffset + 'px');\n    });\n  }\n\n  _isDayPart() {\n    return !this.parent._isMonth() && !this.fullDay;\n  }\n\n  _getHourRange(day) {\n    var hourRange = new Range(this._getHours(this.fromDate), this._getHours(this.toDate));\n    var dateRange = new Range(dates.parseJsonDate(this.fromDate), dates.parseJsonDate(this.toDate));\n\n    if (dates.isSameDay(day, dateRange.from) && dates.isSameDay(day, dateRange.to)) {\n      return new Range(hourRange.from, hourRange.to);\n    } else if (dates.isSameDay(day, dateRange.from)) {\n      return new Range(hourRange.from, 24);\n    } else if (dates.isSameDay(day, dateRange.to)) {\n      return new Range(0, hourRange.to);\n    }\n    return new Range(0, 24);\n  }\n\n  getPartDayPosition(day) {\n    return this._getDisplayDayPosition(this._getHourRange(day));\n  }\n\n  _getDisplayDayPosition(range) {\n    // Doesn't support minutes yet...\n    var preferredRange = new Range(this.parent._dayPosition(range.from, 0), this.parent._dayPosition(range.to, 0));\n    // Fixed number of divisions...\n    var minRangeSize = Math.round(100 * 100 / 24 / this.parent.numberOfHourDivisions) / 100; // Round to two digits\n    if (preferredRange.size() < minRangeSize) {\n      return new Range(preferredRange.from, preferredRange.from + minRangeSize);\n    }\n    return preferredRange;\n  }\n\n  _partPosition($part, y1, y2) {\n    // Compensate open bottom (height: square of 16px, rotated 45°, approx. 23px = sqrt(16^2 + 16^2)\n    var compensateBottom = y2 === 25 ? 23 : 0;\n    y2 = Math.min(24, y2);\n\n    var range = new Range(y1, y2);\n    var r = this._getDisplayDayPosition(range);\n\n    // Convert to %, rounded to two decimal places\n    compensateBottom = Math.round(100 * (100 / 1920 * compensateBottom)) / 100;\n\n    return $part\n      .css('top', r.from + '%')\n      .css('height', r.to - r.from - compensateBottom + '%');\n  }\n\n  _renderProperties() {\n    super._renderProperties();\n    this._renderSelected();\n  }\n\n  _renderSelected() {\n    this._$parts.forEach(function($part) {\n      $part.toggleClass('comp-selected', this.selected);\n    }, this);\n  }\n\n  setSelected(selected) {\n    this.setProperty('selected', selected);\n  }\n\n  updateSelectedComponent($part, updateScrollPosition) {\n    this.parent._selectedComponentChanged(this, $part.data('partDay'), updateScrollPosition);\n  }\n\n  _onMouseDown(event) {\n    var $part = $(event.delegateTarget);\n    this.updateSelectedComponent($part, false);\n\n    if (event.button === 0) {\n      var popup = scout.create('WidgetPopup', {\n        parent: this.parent,\n        $anchor: $part,\n        closeOnAnchorMouseDown: true,\n        closeOnMouseDownOutside: true,\n        closeOnOtherPopupOpen: true,\n        horizontalAlignment: Popup.Alignment.LEFT,\n        verticalAlignment: Popup.Alignment.CENTER,\n        trimWidth: false,\n        trimHeight: false,\n        horizontalSwitch: true,\n        verticalSwitch: true,\n        withArrow: true,\n        cssClass: 'tooltip',\n        scrollType: 'remove',\n        location: {\n          y: event.originalEvent.clientY\n        },\n        widget: {\n          objectType: 'Label',\n          htmlEnabled: true,\n          cssClass: 'tooltip-content',\n          value: this._description()\n        }\n      });\n      popup.open();\n    }\n\n    // stop propagation to avoid fire mouse-down event on calendar-day (Calendar#_onDayMouseDown)\n    event.stopPropagation();\n  }\n\n  _onContextMenu(event) {\n    this.parent._showContextMenu(event, 'Calendar.CalendarComponent');\n  }\n\n  _format(date, pattern) {\n    return dates.format(date, this.session.locale, pattern);\n  }\n\n  _description() {\n    var descParts = [],\n      range = null,\n      text = '',\n      fromDate = dates.parseJsonDate(this.fromDate),\n      toDate = dates.parseJsonDate(this.toDate);\n\n    // subject\n    if (strings.hasText(this.item.subject)) {\n      descParts.push({\n        text: strings.encode(this.item.subject),\n        cssClass: 'calendar-component-title'\n      });\n    }\n\n    // time-range\n    if (this.fullDay) {\n      // NOP\n    } else if (dates.isSameDay(fromDate, toDate)) {\n      range = this.session.text('ui.FromXToY', this._format(fromDate, 'HH:mm'), this._format(toDate, 'HH:mm'));\n    } else {\n      range = this.session.text('ui.FromXToY', this._format(fromDate, 'EEEE HH:mm '), this._format(toDate, 'EEEE HH:mm'));\n    }\n\n    if (strings.hasText(range)) {\n      descParts.push({\n        text: range,\n        cssClass: 'calendar-component-intro'\n      });\n    }\n\n    // description\n    if (strings.hasText(this.item.description)) {\n      descParts.push({\n        text: strings.nl2br(this.item.description)\n      });\n    }\n\n    // build text\n    descParts.forEach(function(part) {\n      text += (part.cssClass ? '<span class=\"' + part.cssClass + '\">' + part.text + '</span>' : part.text) + '<br/>';\n    });\n\n    return text;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}